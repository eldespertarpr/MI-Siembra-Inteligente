<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mi Siembra Inteligente</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#22c55e" />
  <style>
    :root {
      color-scheme: dark;
      --bg: #020617;
      --bg-elevated: #02081f;
      --card: #02081f;
      --card-soft: #030919;
      --accent: #22c55e;
      --accent-soft: rgba(34,197,94,0.12);
      --accent-strong: rgba(34,197,94,0.4);
      --text-main: #f9fafb;
      --text-soft: #9ca3af;
      --border-subtle: rgba(148,163,184,0.4);
      --chip-bg: rgba(15,23,42,0.9);
      --chip-border: rgba(148,163,184,0.7);
      --danger: #fb7185;
      --shadow-soft: 0 18px 45px rgba(15,23,42,0.85);
      --radius-xl: 20px;
      --radius-2xl: 26px;
      --transition-fast: 0.18s ease-out;
    }
    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      font-size: 16px;
      background: radial-gradient(circle at top left, #0f172a 0, #020617 50%, #000 100%);
      color: var(--text-main);
      min-height: 100%;
    }
    body {
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    .app-shell {
      min-height: 100vh;
      max-width: 960px;
      margin: 0 auto;
      padding: 16px 12px 24px;
    }

    header.app-header {
      position: sticky;
      top: 0;
      z-index: 20;
      padding: 4px 4px 10px;
      backdrop-filter: blur(26px);
      -webkit-backdrop-filter: blur(26px);
    }
    .header-inner {
      border-radius: 999px;
      padding: 10px 16px;
      background: radial-gradient(circle at top left, rgba(34,197,94,0.15) 0, rgba(15,23,42,0.9) 45%, rgba(15,23,42,0.96) 100%);
      box-shadow: 0 20px 60px rgba(15,23,42,0.9);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }
    .brand-icon {
      width: 32px;
      height: 32px;
      border-radius: 14px;
      background: radial-gradient(circle at 30% 0, #bbf7d0 0, #22c55e 30%, #15803d 70%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 1px rgba(34,197,94,0.9), 0 12px 30px rgba(34,197,94,0.55);
    }
    .brand-icon span { font-size: 18px; }
    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }
    .brand-title {
      font-weight: 650;
      letter-spacing: 0.01em;
      font-size: 17px;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }
    .brand-sub {
      font-size: 11px;
      color: var(--text-soft);
    }

    .pill-nav {
      display: flex;
      gap: 6px;
      padding: 2px;
      border-radius: 999px;
      background: rgba(15,23,42,0.85);
      border: 1px solid rgba(148,163,184,0.55);
    }
    .pill-nav button {
      border: none;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      background: transparent;
      color: var(--text-soft);
      display: flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
    }
    .pill-nav button span.emoji { font-size: 13px; }
    .pill-nav button.active {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      font-weight: 600;
      box-shadow: 0 8px 20px rgba(34,197,94,0.6);
      transform: translateY(-0.5px);
    }

    main { padding: 8px 2px 24px; }
    section.view {
      display: none;
      animation: fadeIn 0.2s ease-out;
    }
    section.view.active { display: block; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .section-card {
      background: radial-gradient(circle at top left, rgba(148,163,184,0.14) 0, var(--card-soft) 42%, #020617 100%);
      border-radius: var(--radius-2xl);
      padding: 18px 18px 18px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(51,65,85,0.9);
      margin-bottom: 18px;
    }
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .section-title {
      font-size: 21px;
      font-weight: 650;
    }
    .section-subtitle {
      font-size: 13px;
      color: var(--text-soft);
      margin-top: 4px;
    }
    .badge {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(34,197,94,0.18);
      border: 1px solid rgba(34,197,94,0.6);
      color: #bbf7d0;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .badge span.emoji { font-size: 12px; }

    .grid-cards {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 8px;
    }
    .home-card {
      background: radial-gradient(circle at 0 0, rgba(34,197,94,0.38) 0, rgba(15,23,42,0.98) 45%, rgba(15,23,42,1) 100%);
      border-radius: 20px;
      padding: 12px 12px 13px;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(34,197,94,0.62);
      box-shadow: 0 12px 32px rgba(22,163,74,0.7);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 5px;
      min-height: 90px;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
    }
    .home-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 18px 40px rgba(22,163,74,0.85);
      border-color: rgba(190,242,100,0.95);
    }
    .home-card-title {
      font-size: 15px;
      font-weight: 650;
    }
    .home-card-desc {
      font-size: 12px;
      color: #d1fae5;
      max-width: 85%;
    }
    .home-card-icon {
      position: absolute;
      right: -6px;
      bottom: -4px;
      font-size: 46px;
      opacity: 0.18;
      transform: rotate(-8deg);
    }

    .chips-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }
    .chip {
      font-size: 11px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.7);
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
    }
    .chip span.emoji { font-size: 12px; }
    .chip.active {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      border-color: rgba(190,242,100,0.95);
      box-shadow: 0 10px 28px rgba(34,197,94,0.85);
    }

    .search-input {
      flex: 1;
      min-width: 0;
      border-radius: 999px;
      border: 1px solid var(--chip-border);
      background: var(--chip-bg);
      color: var(--text-main);
      font-size: 13px;
      padding: 6px 10px;
      outline: none;
    }
    .search-input::placeholder {
      color: var(--text-soft);
    }

    .month-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 6px;
      margin-top: 8px;
      margin-bottom: 10px;
    }
    .month-btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: var(--chip-bg);
      color: var(--text-soft);
      font-size: 12px;
      padding: 6px 4px;
      text-align: center;
      cursor: pointer;
      transition: background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast);
    }
    .month-btn.active {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      font-weight: 600;
      border-color: rgba(190,242,100,0.95);
      box-shadow: 0 10px 28px rgba(34,197,94,0.85);
      transform: translateY(-1px);
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 4px;
    }
    .list-item {
      border-radius: 18px;
      padding: 10px 11px;
      background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,1));
      border: 1px solid rgba(51,65,85,0.95);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .list-main {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .list-title {
      font-size: 14px;
      font-weight: 600;
    }
    .list-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      font-size: 11px;
    }
    .meta-pill {
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.7);
      color: var(--text-soft);
    }

    .small-btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.9);
      background: rgba(15,23,42,0.95);
      color: var(--text-main);
      padding: 5px 8px;
      font-size: 11px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .small-btn span.emoji { font-size: 13px; }

    .catalog-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      margin-top: 10px;
    }
    .crop-card {
      border-radius: 22px;
      overflow: hidden;
      background: radial-gradient(circle at top, rgba(22,163,74,0.3) 0, #020617 55%);
      border: 1px solid rgba(51,65,85,0.95);
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      min-height: 190px;
      cursor: pointer;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
    }
    .crop-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 18px 40px rgba(22,163,74,0.85);
      border-color: rgba(190,242,100,0.95);
    }
    .crop-photo {
      height: 90px;
      position: relative;
      overflow: hidden;
      background: radial-gradient(circle at 20% 0, #bbf7d0 0, #22c55e 35%, #15803d 70%, #166534 100%);
    }
    .crop-photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      opacity: 0.88;
    }
    .crop-photo::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom, rgba(0,0,0,0.05), rgba(2,6,23,0.82));
    }
    .crop-body {
      padding: 9px 10px 11px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }
    .crop-name {
      font-size: 14px;
      font-weight: 600;
    }
    .crop-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 4px;
    }
    .crop-tag {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(15,23,42,0.96);
      border: 1px solid rgba(148,163,184,0.7);
      color: var(--text-soft);
    }

    .empty-state {
      padding: 26px 18px;
      border-radius: var(--radius-2xl);
      border: 1px dashed rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.8);
      text-align: center;
      font-size: 13px;
      color: var(--text-soft);
    }
    .empty-state span.emoji {
      display: block;
      font-size: 28px;
      margin-bottom: 6px;
    }

    .garden-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 6px;
      margin-top: 10px;
    }
    .garden-cell {
      border-radius: 14px;
      border: 1px solid rgba(51,65,85,0.9);
      background: radial-gradient(circle at top, rgba(34,197,94,0.25) 0, rgba(15,23,42,1) 60%);
      aspect-ratio: 1/1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: var(--text-soft);
      cursor: pointer;
      text-align: center;
      padding: 4px;
    }
    .garden-cell-label {
      font-weight: 600;
      color: var(--text-main);
      font-size: 11px;
    }
    .garden-cell-plant {
      font-size: 10px;
      margin-top: 2px;
    }

    .dialog-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .dialog-backdrop.active { display: flex; }
    .dialog {
      width: min(380px, 100% - 32px);
      border-radius: 22px;
      padding: 16px 16px 14px;
      background: radial-gradient(circle at top left, rgba(34,197,94,0.2) 0, #020617 50%);
      border: 1px solid rgba(148,163,184,0.9);
      box-shadow: 0 24px 70px rgba(0,0,0,0.95);
    }
    .dialog h3 {
      margin: 0 0 8px;
      font-size: 16px;
    }
    .dialog label {
      font-size: 12px;
      color: var(--text-soft);
      display: block;
      margin-bottom: 5px;
    }
    .dialog select,
    .dialog input,
    .dialog textarea {
      width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.8);
      background: rgba(15,23,42,0.9);
      color: var(--text-main);
      font-size: 13px;
      padding: 7px 9px;
      margin-bottom: 10px;
      font-family: inherit;
      resize: vertical;
    }
    .dialog textarea { min-height: 60px; }
    .dialog-footer {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 6px;
    }
    .btn {
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid rgba(148,163,184,0.9);
      background: rgba(15,23,42,0.95);
      color: var(--text-main);
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      border-color: rgba(190,242,100,0.95);
      color: #022c22;
      font-weight: 600;
      box-shadow: 0 12px 32px rgba(34,197,94,0.8);
    }
    .btn-ghost { background: transparent; }

    .diary-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 2px;
    }
    .diary-entry {
      border-radius: 16px;
      padding: 8px 10px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(51,65,85,0.95);
      font-size: 12px;
      display: flex;
      flex-direction: column;
      gap: 3px;
      cursor: pointer;
    }
    .diary-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .diary-type { font-weight: 600; }
    .diary-date {
      font-size: 11px;
      color: var(--text-soft);
    }
    .diary-notes {
      color: var(--text-soft);
      font-size: 12px;
    }

    .dialog.dialog-crop {
      width: min(430px, 100% - 24px);
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      padding-bottom: 10px;
    }
    .crop-dialog-img-wrap {
      border-radius: 18px;
      overflow: hidden;
      margin-bottom: 10px;
      background: radial-gradient(circle at 20% 0, #bbf7d0 0, #22c55e 35%, #15803d 70%, #166534 100%);
      max-height: 260px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .crop-dialog-img-wrap img {
      width: 100%;
      height: auto;
      object-fit: contain;
      display: block;
    }
    .crop-dialog-header-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
    }
    .crop-dialog-name {
      font-size: 17px;
      font-weight: 650;
    }
    .crop-dialog-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }
    .crop-dialog-tag {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.96);
      border: 1px solid rgba(148,163,184,0.7);
      color: var(--text-soft);
    }
    .crop-dialog-body {
      font-size: 13px;
      color: var(--text-soft);
      overflow-y: auto;
      padding-right: 2px;
      margin-bottom: 6px;
    }
    .crop-dialog-body p {
      margin: 4px 0 6px;
    }
    .crop-dialog-body strong {
      color: var(--text-main);
      font-weight: 600;
    }

    footer {
      margin-top: 8px;
      padding: 6px 4px 2px;
      font-size: 10px;
      color: var(--text-soft);
      text-align: center;
    }
    footer a {
      color: var(--accent);
      text-decoration: none;
    }

    @media (min-width: 768px) {
      .app-shell {
        padding: 18px 8px 28px;
      }
      .section-card {
        padding: 20px 20px 20px;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="header-inner">
        <div class="brand">
          <div class="brand-icon"><span>üå±</span></div>
          <div class="brand-text">
            <div class="brand-title">Mi Siembra Inteligente</div>
            <div class="brand-sub">Planifica, registra y cuida tu huerto paso a paso.</div>
          </div>
        </div>
        <nav class="pill-nav" aria-label="Secciones principales">
          <button class="nav-btn active" data-view="homeView"><span class="emoji">üè†</span><span>Inicio</span></button>
          <button class="nav-btn" data-view="calendarView"><span class="emoji">üìÖ</span><span>Calendario</span></button>
          <button class="nav-btn" data-view="catalogView"><span class="emoji">üåø</span><span>Cat√°logo</span></button>
          <button class="nav-btn" data-view="moreView"><span class="emoji">‚ãØ</span><span>M√°s</span></button>
        </nav>
      </div>
    </header>

    <main>
      <!-- INICIO -->
      <section id="homeView" class="view active">
        <div class="section-card">
          <div class="section-header">
            <div>
              <div class="section-title">Inicio</div>
              <div class="section-subtitle">Elige qu√© quieres hacer hoy en tu siembra.</div>
            </div>
            <div class="badge"><span class="emoji">‚ö°</span><span>Modo r√°pido</span></div>
          </div>
          <div class="grid-cards">
            <article class="home-card" data-view-target="calendarView">
              <div class="home-card-title">Qu√© sembrar este mes</div>
              <div class="home-card-desc">Calendario por mes con cultivos recomendados y tiempo de cosecha.</div>
              <div class="home-card-icon">üìÖ</div>
            </article>
            <article class="home-card" data-view-target="catalogView">
              <div class="home-card-title">Cat√°logo de cultivos</div>
              <div class="home-card-desc">Explora fichas visuales con fotos, tipo de cultivo y sol recomendado.</div>
              <div class="home-card-icon">üåø</div>
            </article>
            <article class="home-card" data-view-target="gardenView">
              <div class="home-card-title">Mi huerto</div>
              <div class="home-card-desc">Dise√±a un plano 4√ó4 y marca qu√© hay sembrado.</div>
              <div class="home-card-icon">üß©</div>
            </article>
            <article class="home-card" data-view-target="diaryView">
              <div class="home-card-title">Diario de siembra</div>
              <div class="home-card-desc">Registra siembras, riegos, abonos y cosechas.</div>
              <div class="home-card-icon">üìì</div>
            </article>
            <article class="home-card" data-view-target="pestsView">
              <div class="home-card-title">Plagas y cuidados</div>
              <div class="home-card-desc">Problemas comunes y qu√© hacer.</div>
              <div class="home-card-icon">ü™≤</div>
            </article>
            <article class="home-card" data-view-target="fertView">
              <div class="home-card-title">Abonos y fertilizantes</div>
              <div class="home-card-desc">Ideas de compost y cu√°ndo aplicarlos.</div>
              <div class="home-card-icon">üß™</div>
            </article>
          </div>
          <div class="chips-row">
            <span class="chip"><span class="emoji">üì±</span><span>PWA offline</span></span>
            <span class="chip"><span class="emoji">‚òï</span><span>Hecho para planificar tranquilo</span></span>
            <span class="chip"><span class="emoji">üåç</span><span>Clima tropical/subtropical</span></span>
          </div>
        </div>
      </section>

      <!-- CALENDARIO -->
      <section id="calendarView" class="view">
        <div class="section-card">
          <div class="section-header">
            <div>
              <div class="section-title">¬øQu√© puedo sembrar este mes?</div>
              <div class="section-subtitle">Toca un mes para ver cultivos recomendados.</div>
            </div>
            <button class="small-btn" data-view-target="homeView"><span class="emoji">‚¨ÖÔ∏è</span><span>Volver</span></button>
          </div>
          <div class="month-grid" id="monthButtons"></div>
          <div class="list" id="monthResults"></div>
        </div>
      </section>

      <!-- CAT√ÅLOGO -->
      <section id="catalogView" class="view">
        <div class="section-card">
          <div class="section-header">
            <div>
              <div class="section-title">Cat√°logo visual de cultivos</div>
              <div class="section-subtitle">Busca por nombre, tipo o cantidad de sol.</div>
            </div>
            <button class="small-btn" data-view-target="homeView"><span class="emoji">‚¨ÖÔ∏è</span><span>Volver</span></button>
          </div>

          <div class="chips-row">
            <input
              id="catalogSearch"
              class="search-input"
              type="search"
              placeholder="Buscar por nombre (ej. tomate, lechuga, cilantro‚Ä¶)">
          </div>

          <div class="chips-row" id="catalogTypeFilters"></div>
          <div class="chips-row" id="catalogSunFilters"></div>

          <div class="catalog-grid" id="catalogGrid"></div>
        </div>
      </section>

      <!-- MI HUERTO -->
      <section id="gardenView" class="view">
        <div class="section-card">
          <div class="section-header">
            <div>
              <div class="section-title">Mi huerto</div>
              <div class="section-subtitle">Toca un cuadro para asignar qu√© est√°s sembrando.</div>
            </div>
            <button class="small-btn" id="resetGarden"><span class="emoji">üßπ</span><span>Limpiar</span></button>
          </div>
          <div class="garden-grid" id="gardenGrid"></div>
          <div class="section-subtitle" style="margin-top:10px;">
            Sugerencia: puedes usar el plano como referencia de tu cama de siembra real o de tiestos.
          </div>
        </div>
      </section>

      <!-- DIARIO -->
      <section id="diaryView" class="view">
        <div class="section-card">
          <div class="section-header">
            <div>
              <div class="section-title">Diario de siembra</div>
              <div class="section-subtitle">Registra actividades importantes.</div>
            </div>
            <button class="small-btn" id="addDiaryEntry"><span class="emoji">‚ûï</span><span>Nuevo</span></button>
          </div>
          <div class="diary-list" id="diaryList"></div>
          <div class="empty-state" id="diaryEmpty">
            <span class="emoji">üìù</span>
            A√∫n no has registrado actividades. Empieza a√±adiendo tu pr√≥xima siembra, riego, abono o cosecha.
          </div>
        </div>
      </section>

      <!-- PLAGAS -->
      <section id="pestsView" class="view">
        <div class="section-card">
          <div class="section-header">
            <div>
              <div class="section-title">Plagas y cuidados b√°sicos</div>
              <div class="section-subtitle">Gu√≠a r√°pida para problemas frecuentes.</div>
            </div>
            <button class="small-btn" data-view-target="homeView"><span class="emoji">‚¨ÖÔ∏è</span><span>Volver</span></button>
          </div>
          <div class="list">
            <div class="list-item">
              <div class="list-main">
                <div class="list-title">Pulgones</div>
                <div class="list-meta">
                  <span class="meta-pill">ü™≤ Chupan savia</span>
                  <span class="meta-pill">üåø Brotes tiernos</span>
                </div>
                <div class="section-subtitle">
                  Soluci√≥n simple: agua jabonosa suave cada 2‚Äì3 d√≠as.
                </div>
              </div>
            </div>
            <div class="list-item">
              <div class="list-main">
                <div class="list-title">Hongos en hojas</div>
                <div class="list-meta">
                  <span class="meta-pill">üçÉ Manchas</span>
                  <span class="meta-pill">üíß Exceso de humedad</span>
                </div>
                <div class="section-subtitle">
                  Mejora ventilaci√≥n, evita mojar hojas y retira las muy afectadas.
                </div>
              </div>
            </div>
            <div class="list-item">
              <div class="list-main">
                <div class="list-title">Orugas y gusanos</div>
                <div class="list-meta">
                  <span class="meta-pill">ü™± Hojas comidas</span>
                  <span class="meta-pill">üå± Pl√°ntulas</span>
                </div>
                <div class="section-subtitle">
                  Rev√≠salas a mano (tarde) y ret√≠ralas; puedes usar malla ligera.
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ABONOS -->
      <section id="fertView" class="view">
        <div class="section-card">
          <div class="section-header">
            <div>
              <div class="section-title">Abonos y fertilizantes</div>
              <div class="section-subtitle">Abonos caseros y cu√°ndo aplicarlos.</div>
            </div>
            <button class="small-btn" data-view-target="homeView"><span class="emoji">‚¨ÖÔ∏è</span><span>Volver</span></button>
          </div>
          <div class="list">
            <div class="list-item">
              <div class="list-main">
                <div class="list-title">Compost maduro</div>
                <div class="list-meta">
                  <span class="meta-pill">üóëÔ∏è Restos de cocina</span>
                  <span class="meta-pill">üå± Aporta de todo un poco</span>
                </div>
                <div class="section-subtitle">
                  Ideal para mezclar con la tierra antes de sembrar o mejorar camas.
                </div>
              </div>
            </div>
            <div class="list-item">
              <div class="list-main">
                <div class="list-title">T√© de compost o de humus</div>
                <div class="list-meta">
                  <span class="meta-pill">üíß L√≠quido</span>
                  <span class="meta-pill">üöø Se aplica al riego</span>
                </div>
                <div class="section-subtitle">
                  √ötil para dar un empuj√≥n extra a plantas en crecimiento.
                </div>
              </div>
            </div>
            <div class="list-item">
              <div class="list-main">
                <div class="list-title">Abonos l√≠quidos concentrados</div>
                <div class="list-meta">
                  <span class="meta-pill">‚ö†Ô∏è Leer etiqueta</span>
                </div>
                <div class="section-subtitle">
                  Mejor poca cantidad y m√°s frecuente que pasarse.
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- M√ÅS -->
      <section id="moreView" class="view">
        <div class="section-card">
          <div class="section-header">
            <div>
              <div class="section-title">M√°s opciones</div>
              <div class="section-subtitle">Atajos y respaldo de datos.</div>
            </div>
          </div>
          <div class="grid-cards">
            <article class="home-card" data-view-target="gardenView">
              <div class="home-card-title">Mi huerto</div>
              <div class="home-card-desc">Plano r√°pido 4√ó4 para visualizar tu siembra.</div>
              <div class="home-card-icon">üß©</div>
            </article>
            <article class="home-card" data-view-target="diaryView">
              <div class="home-card-title">Diario</div>
              <div class="home-card-desc">Historial de tareas y cosechas.</div>
              <div class="home-card-icon">üìì</div>
            </article>
            <article class="home-card" data-view-target="pestsView">
              <div class="home-card-title">Plagas</div>
              <div class="home-card-desc">Problemas frecuentes y soluciones b√°sicas.</div>
              <div class="home-card-icon">ü™≤</div>
            </article>
            <article class="home-card" data-view-target="fertView">
              <div class="home-card-title">Abonos</div>
              <div class="home-card-desc">Cu√°ndo y c√≥mo abonar sin excesos.</div>
              <div class="home-card-icon">üß™</div>
            </article>
            <!-- NUEVO: respaldo de datos -->
            <article class="home-card" id="backupCard">
              <div class="home-card-title">Respaldo de datos</div>
              <div class="home-card-desc">Descarga un archivo con tu huerto y diario.</div>
              <div class="home-card-icon">üíæ</div>
            </article>
          </div>
        </div>
      </section>
    </main>

    <footer>
      Mi Siembra Inteligente ¬∑ Guarda datos solo en este dispositivo ¬∑ Puedes instalarla como app desde el navegador.
    </footer>
  </div>

  <!-- DI√ÅLOGO HUERTO -->
  <div class="dialog-backdrop" id="gardenDialog">
    <div class="dialog">
      <h3>Asignar cultivo</h3>
      <div id="gardenDialogPosition" class="section-subtitle" style="margin-bottom:8px;"></div>
      <label for="gardenCropSelect">Cultivo</label>
      <select id="gardenCropSelect"></select>
      <div class="dialog-footer">
        <button class="btn btn-ghost" type="button" data-dialog-close>Cancelar</button>
        <button class="btn btn-primary" type="button" id="gardenSave">Guardar</button>
      </div>
    </div>
  </div>

  <!-- DI√ÅLOGO DIARIO -->
  <div class="dialog-backdrop" id="diaryDialog">
    <div class="dialog">
      <h3>Nueva entrada</h3>
      <label for="diaryType">Tipo de actividad</label>
      <select id="diaryType">
        <option value="Siembra">Siembra</option>
        <option value="Riego">Riego</option>
        <option value="Abono">Abono</option>
        <option value="Cosecha">Cosecha</option>
        <option value="Otro">Otro</option>
      </select>
      <label for="diaryDate">Fecha</label>
      <input id="diaryDate" type="date" />
      <label for="diaryNotes">Notas</label>
      <textarea id="diaryNotes" placeholder="Ej. Sembr√© 4 plantas de tomate en tiestos de 5 galones."></textarea>
      <div class="dialog-footer">
        <button class="btn btn-ghost" type="button" data-dialog-close>Cancelar</button>
        <button class="btn btn-primary" type="button" id="diarySave">Guardar</button>
      </div>
    </div>
  </div>

  <!-- DI√ÅLOGO FICHA DEL CULTIVO -->
  <div class="dialog-backdrop" id="cropDialog">
    <div class="dialog dialog-crop">
      <div class="crop-dialog-img-wrap">
        <img id="cropDialogImg" src="" alt="Cultivo" />
      </div>
      <div class="crop-dialog-header-line">
        <div class="crop-dialog-name" id="cropDialogName">Cultivo</div>
        <button class="btn btn-ghost" type="button" data-dialog-close>‚úï</button>
      </div>
      <div class="crop-dialog-tags">
        <span class="crop-dialog-tag" id="cropDialogTipo"></span>
        <span class="crop-dialog-tag" id="cropDialogDias"></span>
        <span class="crop-dialog-tag" id="cropDialogSol"></span>
      </div>
      <div class="crop-dialog-body">
        <p><strong>Siembra:</strong> <span id="cropDialogSiembra"></span></p>
        <p><strong>Mejores meses de siembra:</strong> <span id="cropDialogMeses"></span></p>
        <p><strong>Distancia entre plantas:</strong> <span id="cropDialogDistancia"></span></p>
        <p><strong>Profundidad de siembra:</strong> <span id="cropDialogProfundidad"></span></p>
        <p><strong>Tiesto recomendado:</strong> <span id="cropDialogTiesto"></span></p>
      </div>
      <div class="dialog-footer">
        <button class="btn btn-primary" type="button" data-dialog-close>Cerrar</button>
      </div>
    </div>
  </div>

  <!-- DI√ÅLOGO DE CONFIRMACI√ìN GEN√âRICO -->
  <div class="dialog-backdrop" id="confirmDialog">
    <div class="dialog">
      <h3>Confirmar</h3>
      <p id="confirmMessage" class="section-subtitle" style="margin-bottom: 12px;"></p>
      <div class="dialog-footer">
        <button class="btn btn-ghost" type="button" id="confirmCancel">Cancelar</button>
        <button class="btn btn-primary" type="button" id="confirmOk">Aceptar</button>
      </div>
    </div>
  </div>

  <script>
    // --- Datos de cultivos ---
    const cultivos = [
      { id: 'acelga', nombre: 'Acelga', tipo: 'Hortaliza de hoja', imagen: 'img/acelga.jpg', diasCosecha: '50‚Äì60 d√≠as', sol: 'Sol suave o media sombra', siembra: 'Siembra directa o semilleros', distancia: '25‚Äì30 cm', profundidad: '0.5‚Äì1 cm', tiesto: '8‚Äì10 L' },
      { id: 'acerola', nombre: 'Acerola', tipo: 'Frutal', imagen: 'img/acerola.jpg', diasCosecha: '8‚Äì12 meses', sol: 'Pleno sol', siembra: 'Pl√°ntulas o injertos', distancia: '3‚Äì4 m', profundidad: 'Cubrir ra√≠ces', tiesto: 'Suelo directo' },
      { id: 'aguacate', nombre: 'Aguacate', tipo: 'Frutal', imagen: 'img/aguacate.jpg', diasCosecha: '2‚Äì4 a√±os', sol: 'Pleno sol', siembra: 'Injertos o pl√°ntulas', distancia: '4‚Äì6 m', profundidad: 'Cubrir ra√≠ces', tiesto: 'Suelo directo' },
      { id: 'aji', nombre: 'Aj√≠', tipo: 'Fruto', imagen: 'img/aji.jpg', diasCosecha: '90‚Äì110 d√≠as', sol: 'Pleno sol', siembra: 'Semilleros y trasplante', distancia: '40‚Äì50 cm', profundidad: '0.5‚Äì1 cm', tiesto: '10‚Äì15 L' },
      { id: 'ajo', nombre: 'Ajo', tipo: 'Bulbo', imagen: 'img/ajo.jpg', diasCosecha: '90‚Äì120 d√≠as', sol: 'Pleno sol', siembra: 'Dientes directos', distancia: '10‚Äì15 cm', profundidad: '3‚Äì4 cm', tiesto: '15‚Äì20 L' },
      { id: 'albahaca', nombre: 'Albahaca', tipo: 'Hierba arom√°tica', imagen: 'img/albahaca.jpg', diasCosecha: '40‚Äì60 d√≠as', sol: 'Sol suave', siembra: 'Semilleros o directa', distancia: '25‚Äì30 cm', profundidad: '0.5‚Äì1 cm', tiesto: '5‚Äì8 L' },
      { id: 'apio', nombre: 'Apio', tipo: 'Hortaliza de tallo', imagen: 'img/apio.jpg', diasCosecha: '90‚Äì120 d√≠as', sol: 'Sol suave', siembra: 'Semilleros', distancia: '25‚Äì30 cm', profundidad: '0.5‚Äì1 cm', tiesto: '10‚Äì15 L' },
      { id: 'arugula', nombre: 'Ar√∫gula', tipo: 'Hortaliza de hoja', imagen: 'img/arugula.jpg', diasCosecha: '30‚Äì40 d√≠as', sol: 'Sol suave', siembra: 'Siembra directa', distancia: '15‚Äì20 cm', profundidad: '0.5 cm', tiesto: '5‚Äì8 L' },
      { id: 'batata', nombre: 'Batata', tipo: 'Ra√≠z/tub√©rculo', imagen: 'img/batata.jpg', diasCosecha: '90‚Äì120 d√≠as', sol: 'Pleno sol', siembra: 'Estacas o gu√≠as', distancia: '40‚Äì60 cm', profundidad: '5‚Äì8 cm', tiesto: '25‚Äì30 L' },
      { id: 'berenjena', nombre: 'Berenjena', tipo: 'Fruto', imagen: 'img/berenjena.jpg', diasCosecha: '100‚Äì120 d√≠as', sol: 'Pleno sol', siembra: 'Semilleros y trasplante', distancia: '50‚Äì60 cm', profundidad: '1‚Äì2 cm', tiesto: '20‚Äì30 L' },
      { id: 'berro', nombre: 'Berro', tipo: 'Hortaliza de hoja', imagen: 'img/berro.jpg', diasCosecha: '45‚Äì60 d√≠as', sol: 'Sol suave', siembra: 'Siembra directa', distancia: '10‚Äì15 cm', profundidad: '0.5‚Äì1 cm', tiesto: '8‚Äì10 L' },
      { id: 'broccoli', nombre: 'Br√≥coli', tipo: 'Hortaliza de flor', imagen: 'img/broccoli.jpg', diasCosecha: '80‚Äì100 d√≠as', sol: 'Pleno sol', siembra: 'Semilleros y trasplante', distancia: '40‚Äì60 cm', profundidad: '1‚Äì2 cm', tiesto: '20‚Äì25 L' },
      { id: 'calabaza', nombre: 'Calabaza', tipo: 'Fruto', imagen: 'img/calabaza.jpg', diasCosecha: '90‚Äì120 d√≠as', sol: 'Pleno sol', siembra: 'Siembra directa', distancia: '1‚Äì2 m', profundidad: '3‚Äì4 cm', tiesto: 'Suelo directo o 50 L' },
      { id: 'cantalope', nombre: 'Cantalope', tipo: 'Fruto', imagen: 'img/cantalope.jpg', diasCosecha: '80‚Äì100 d√≠as', sol: 'Pleno sol', siembra: 'Siembra directa', distancia: '80‚Äì100 cm', profundidad: '2‚Äì3 cm', tiesto: '30‚Äì40 L' },
      { id: 'carambola', nombre: 'Carambola', tipo: 'Frutal', imagen: 'img/carambola.jpg', diasCosecha: '1‚Äì2 a√±os', sol: 'Pleno sol', siembra: 'Pl√°ntulas o injertos', distancia: '3‚Äì4 m', profundidad: 'Cubrir ra√≠ces', tiesto: 'Suelo directo' },
      { id: 'cebolla', nombre: 'Cebolla', tipo: 'Bulbo', imagen: 'img/cebolla.jpg', diasCosecha: '90‚Äì120 d√≠as', sol: 'Pleno sol', siembra: 'Pl√°ntulas o bulbitos', distancia: '10‚Äì15 cm', profundidad: '2‚Äì3 cm', tiesto: '15‚Äì20 L' },
      { id: 'china', nombre: 'China (naranja)', tipo: 'Frutal c√≠trico', imagen: 'img/china.jpg', diasCosecha: '8‚Äì12 meses', sol: 'Pleno sol', siembra: 'Pl√°ntulas o injertos', distancia: '3‚Äì4 m', profundidad: 'Cubrir ra√≠ces', tiesto: 'Suelo directo' },
      { id: 'cilantro', nombre: 'Cilantro', tipo: 'Hierba/arom√°tica', imagen: 'img/cilantro.jpg', diasCosecha: '30‚Äì45 d√≠as', sol: 'Sol suave', siembra: 'Siembra directa', distancia: '5‚Äì10 cm', profundidad: '0.5‚Äì1 cm', tiesto: '4‚Äì6 L' },
      { id: 'col_risada', nombre: 'Col risada (kale rizado)', tipo: 'Hortaliza de hoja', imagen: 'img/col_risada.jpg', diasCosecha: '60‚Äì80 d√≠as', sol: 'Sol suave', siembra: 'Semilleros y trasplante', distancia: '35‚Äì45 cm', profundidad: '1 cm', tiesto: '15‚Äì20 L' },
      { id: 'col_roja', nombre: 'Col roja', tipo: 'Hortaliza de hoja', imagen: 'img/col_roja.jpg', diasCosecha: '80‚Äì100 d√≠as', sol: 'Sol suave', siembra: 'Semilleros y trasplante', distancia: '35‚Äì45 cm', profundidad: '1 cm', tiesto: '15‚Äì20 L' },
      { id: 'coliflor', nombre: 'Coliflor', tipo: 'Hortaliza de flor', imagen: 'img/coliflor.jpg', diasCosecha: '80‚Äì100 d√≠as', sol: 'Sol suave', siembra: 'Semilleros y trasplante', distancia: '40‚Äì60 cm', profundidad: '1‚Äì2 cm', tiesto: '20‚Äì25 L' },
      { id: 'escarolas', nombre: 'Escarolas', tipo: 'Hortaliza de hoja', imagen: 'img/escarolas.jpg', diasCosecha: '60‚Äì70 d√≠as', sol: 'Sol suave', siembra: 'Semilleros y trasplante', distancia: '25‚Äì30 cm', profundidad: '0.5‚Äì1 cm', tiesto: '10‚Äì15 L' },
      { id: 'espinaca', nombre: 'Espinaca', tipo: 'Hortaliza de hoja', imagen: 'img/espinaca.jpg', diasCosecha: '40‚Äì50 d√≠as', sol: 'Sol suave', siembra: 'Siembra directa', distancia: '10‚Äì15 cm', profundidad: '0.5‚Äì1 cm', tiesto: '8‚Äì10 L' },
      { id: 'fresas', nombre: 'Fresas', tipo: 'Frutal peque√±o', imagen: 'img/fresas.jpg', diasCosecha: '4‚Äì5 meses', sol: 'Sol suave', siembra: 'Pl√°ntulas', distancia: '25‚Äì30 cm', profundidad: 'Cubrir ra√≠ces', tiesto: '15‚Äì20 L' },
      { id: 'gandules', nombre: 'Gandules', tipo: 'Leguminosa', imagen: 'img/gandules.jpg', diasCosecha: '4‚Äì6 meses', sol: 'Pleno sol', siembra: 'Siembra directa', distancia: '50‚Äì80 cm', profundidad: '2‚Äì3 cm', tiesto: '30‚Äì40 L' },
      { id: 'guayaba', nombre: 'Guayaba', tipo: 'Frutal', imagen: 'img/guayaba.jpg', diasCosecha: '1‚Äì2 a√±os', sol: 'Pleno sol', siembra: 'Pl√°ntulas o injertos', distancia: '3‚Äì4 m', profundidad: 'Cubrir ra√≠ces', tiesto: 'Suelo directo' },
      { id: 'guineo', nombre: 'Guineo', tipo: 'Frutal', imagen: 'img/guineo.jpg', diasCosecha: '8‚Äì12 meses', sol: 'Pleno sol', siembra: 'Hijuelos (reto√±os)', distancia: '2‚Äì3 m', profundidad: 'Cubrir ra√≠ces', tiesto: 'Suelo directo' },
      { id: 'habichuelas', nombre: 'Habichuelas', tipo: 'Leguminosa', imagen: 'img/habichuelas.jpg', diasCosecha: '60‚Äì70 d√≠as', sol: 'Pleno sol', siembra: 'Siembra directa', distancia: '25‚Äì30 cm', profundidad: '2‚Äì3 cm', tiesto: '15‚Äì20 L' },
      { id: 'kale', nombre: 'Kale', tipo: 'Hortaliza de hoja', imagen: 'img/kale.jpg', diasCosecha: '60‚Äì80 d√≠as', sol: 'Sol suave', siembra: 'Semilleros y trasplante', distancia: '30‚Äì40 cm', profundidad: '1 cm', tiesto: '15‚Äì20 L' },
      { id: 'lechuga', nombre: 'Lechuga', tipo: 'Hortaliza de hoja', imagen: 'img/lechuga.jpg', diasCosecha: '40‚Äì60 d√≠as', sol: 'Sol suave', siembra: 'Semilleros o directa', distancia: '25‚Äì30 cm', profundidad: '0.5‚Äì1 cm', tiesto: '8‚Äì10 L' },
      { id: 'limon', nombre: 'Lim√≥n', tipo: 'Frutal c√≠trico', imagen: 'img/limon.jpg', diasCosecha: '8‚Äì12 meses', sol: 'Pleno sol', siembra: 'Pl√°ntulas o injertos', distancia: '3‚Äì4 m', profundidad: 'Cubrir ra√≠ces', tiesto: 'Suelo directo' },
      { id: 'maiz', nombre: 'Ma√≠z', tipo: 'Cereal', imagen: 'img/maiz.jpg', diasCosecha: '90‚Äì120 d√≠as', sol: 'Pleno sol', siembra: 'Siembra directa', distancia: '20‚Äì30 cm', profundidad: '3‚Äì4 cm', tiesto: 'Suelo directo' },
      { id: 'malanga', nombre: 'Malanga', tipo: 'Ra√≠z/tub√©rculo', imagen: 'img/malanga.jpg', diasCosecha: '8‚Äì10 meses', sol: 'Sol suave', siembra: 'Cormos o pedazos de cormos', distancia: '60‚Äì80 cm', profundidad: '8‚Äì10 cm', tiesto: '40‚Äì50 L' },
      { id: 'mandarina', nombre: 'Mandarina', tipo: 'Frutal c√≠trico', imagen: 'img/mandarina.jpg', diasCosecha: '8‚Äì12 meses', sol: 'Pleno sol', siembra: 'Pl√°ntulas o injertos', distancia: '3‚Äì4 m', profundidad: 'Cubrir ra√≠ces', tiesto: 'Suelo directo' },
      { id: 'mango', nombre: 'Mango', tipo: 'Frutal', imagen: 'img/mango.jpg', diasCosecha: '3‚Äì5 a√±os', sol: 'Pleno sol', siembra: 'Injertos o pl√°ntulas', distancia: '6‚Äì8 m', profundidad: 'Cubrir ra√≠ces', tiesto: 'Suelo directo' },
      { id: 'melon', nombre: 'Mel√≥n', tipo: 'Fruto', imagen: 'img/melon.jpg', diasCosecha: '80‚Äì100 d√≠as', sol: 'Pleno sol', siembra: 'Siembra directa', distancia: '80‚Äì100 cm', profundidad: '2‚Äì3 cm', tiesto: '30‚Äì40 L' },
      { id: 'menta', nombre: 'Menta', tipo: 'Hierba arom√°tica', imagen: 'img/menta.jpg', diasCosecha: '30‚Äì60 d√≠as', sol: 'Sol suave o media sombra', siembra: 'Esquejes o siembra directa', distancia: '20‚Äì25 cm', profundidad: '0.5‚Äì1 cm', tiesto: '8‚Äì10 L' },
      { id: 'nabo', nombre: 'Nabo', tipo: 'Ra√≠z', imagen: 'img/nabo.jpg', diasCosecha: '40‚Äì60 d√≠as', sol: 'Sol suave', siembra: 'Siembra directa', distancia: '10‚Äì15 cm', profundidad: '1‚Äì2 cm', tiesto: '10‚Äì12 L' },
      { id: 'naranja', nombre: 'Naranja', tipo: 'Frutal c√≠trico', imagen: 'img/naranja.jpg', diasCosecha: '8‚Äì12 meses', sol: 'Pleno sol', siembra: 'Pl√°ntulas o injertos', distancia: '3‚Äì4 m', profundidad: 'Cubrir ra√≠ces', tiesto: 'Suelo directo' },
      { id: 'oregano', nombre: 'Or√©gano', tipo: 'Hierba arom√°tica', imagen: 'img/oregano.jpg', diasCosecha: '40‚Äì60 d√≠as', sol: 'Sol suave', siembra: 'Esquejes o siembra directa', distancia: '20‚Äì25 cm', profundidad: '0.5‚Äì1 cm', tiesto: '8‚Äì10 L' },
      { id: 'oregano_brujo', nombre: 'Or√©gano brujo', tipo: 'Hierba arom√°tica', imagen: 'img/oregano_brujo.jpg', diasCosecha: '40‚Äì60 d√≠as', sol: 'Sol suave', siembra: 'Esquejes', distancia: '25‚Äì30 cm', profundidad: '0.5‚Äì1 cm', tiesto: '8‚Äì10 L' },
      { id: 'papa', nombre: 'Papa', tipo: 'Ra√≠z/tub√©rculo', imagen: 'img/papa.jpg', diasCosecha: '90‚Äì120 d√≠as', sol: 'Pleno sol', siembra: 'Trozos de tub√©rculo', distancia: '30‚Äì40 cm', profundidad: '5‚Äì8 cm', tiesto: '25‚Äì30 L' },
      { id: 'papaya', nombre: 'Papaya', tipo: 'Frutal', imagen: 'img/papaya.jpg', diasCosecha: '8‚Äì12 meses', sol: 'Pleno sol', siembra: 'Semillas o pl√°ntulas', distancia: '2‚Äì3 m', profundidad: 'Cubrir ra√≠ces', tiesto: 'Suelo directo' },
      { id: 'parcha', nombre: 'Parcha (maracuy√°)', tipo: 'Frutal trepador', imagen: 'img/parcha.jpg', diasCosecha: '8‚Äì12 meses', sol: 'Pleno sol', siembra: 'Semillas o pl√°ntulas', distancia: '2‚Äì3 m', profundidad: '2‚Äì3 cm', tiesto: 'Suelo directo con soporte' },
      { id: 'pepinillo', nombre: 'Pepinillo', tipo: 'Fruto', imagen: 'img/pepinillo.jpg', diasCosecha: '50‚Äì70 d√≠as', sol: 'Pleno sol', siembra: 'Siembra directa', distancia: '40‚Äì60 cm', profundidad: '2‚Äì3 cm', tiesto: '20‚Äì25 L' },
      { id: 'pimiento', nombre: 'Pimiento', tipo: 'Fruto', imagen: 'img/pimiento.jpg', diasCosecha: '90‚Äì120 d√≠as', sol: 'Pleno sol', siembra: 'Semilleros y trasplante', distancia: '40‚Äì50 cm', profundidad: '0.5‚Äì1 cm', tiesto: '15‚Äì20 L' },
      { id: 'pimiento_morron', nombre: 'Pimiento morr√≥n', tipo: 'Fruto', imagen: 'img/pimiento_morron.jpg', diasCosecha: '90‚Äì120 d√≠as', sol: 'Pleno sol', siembra: 'Semilleros y trasplante', distancia: '40‚Äì50 cm', profundidad: '0.5‚Äì1 cm', tiesto: '15‚Äì20 L' },
      { id: 'platano', nombre: 'Pl√°tano', tipo: 'Frutal', imagen: 'img/platano.jpg', diasCosecha: '8‚Äì12 meses', sol: 'Pleno sol', siembra: 'Hijos o cormos', distancia: '2‚Äì3 m', profundidad: 'Cubrir ra√≠ces', tiesto: 'Suelo directo' },
      { id: 'quimbombo', nombre: 'Quimbomb√≥', tipo: 'Fruto', imagen: 'img/quimbombo.jpg', diasCosecha: '60‚Äì80 d√≠as', sol: 'Pleno sol', siembra: 'Siembra directa', distancia: '40‚Äì60 cm', profundidad: '2‚Äì3 cm', tiesto: '20‚Äì25 L' },
      { id: 'rabano', nombre: 'R√°bano', tipo: 'Ra√≠z', imagen: 'img/rabano.jpg', diasCosecha: '30‚Äì40 d√≠as', sol: 'Sol suave', siembra: 'Siembra directa', distancia: '5‚Äì10 cm', profundidad: '1‚Äì2 cm', tiesto: '8‚Äì10 L' },
      { id: 'recao', nombre: 'Recao', tipo: 'Hierba arom√°tica', imagen: 'img/recao.jpg', diasCosecha: '60‚Äì90 d√≠as', sol: 'Media sombra', siembra: 'Divisi√≥n de matas o semilla', distancia: '20‚Äì30 cm', profundidad: 'Cubrir ra√≠ces', tiesto: '10‚Äì15 L' },
      { id: 'remolacha', nombre: 'Remolacha', tipo: 'Ra√≠z', imagen: 'img/remolacha.jpg', diasCosecha: '60‚Äì70 d√≠as', sol: 'Sol suave', siembra: 'Siembra directa', distancia: '10‚Äì15 cm', profundidad: '1‚Äì2 cm', tiesto: '10‚Äì12 L' },
      { id: 'remolacha_blanca', nombre: 'Remolacha blanca', tipo: 'Ra√≠z', imagen: 'img/remolacha_blanca.jpg', diasCosecha: '60‚Äì70 d√≠as', sol: 'Sol suave', siembra: 'Siembra directa', distancia: '10‚Äì15 cm', profundidad: '1‚Äì2 cm', tiesto: '10‚Äì12 L' },
      { id: 'repollo', nombre: 'Repollo', tipo: 'Hortaliza de hoja', imagen: 'img/repollo.jpg', diasCosecha: '80‚Äì100 d√≠as', sol: 'Sol suave', siembra: 'Semilleros y trasplante', distancia: '40‚Äì60 cm', profundidad: '1‚Äì2 cm', tiesto: '20‚Äì25 L' },
      { id: 'tamarindo', nombre: 'Tamarindo', tipo: 'Frutal', imagen: 'img/tamarindo.jpg', diasCosecha: '3‚Äì5 a√±os', sol: 'Pleno sol', siembra: 'Pl√°ntulas', distancia: '6‚Äì8 m', profundidad: 'Cubrir ra√≠ces', tiesto: 'Suelo directo' },
      { id: 'tomate', nombre: 'Tomate', tipo: 'Fruto', imagen: 'img/tomate.jpg', diasCosecha: '90‚Äì110 d√≠as', sol: 'Pleno sol', siembra: 'Semilleros y trasplante', distancia: '40‚Äì60 cm', profundidad: '0.5‚Äì1 cm', tiesto: '20‚Äì25 L' },
      { id: 'toronja', nombre: 'Toronja', tipo: 'Frutal c√≠trico', imagen: 'img/toronja.jpg', diasCosecha: '8‚Äì12 meses', sol: 'Pleno sol', siembra: 'Pl√°ntulas o injertos', distancia: '3‚Äì4 m', profundidad: 'Cubrir ra√≠ces', tiesto: 'Suelo directo' },
      { id: 'yautia', nombre: 'Yaut√≠a', tipo: 'Ra√≠z/tub√©rculo', imagen: 'img/yautia.jpg', diasCosecha: '8‚Äì10 meses', sol: 'Sol suave', siembra: 'Cormos', distancia: '60‚Äì80 cm', profundidad: '8‚Äì10 cm', tiesto: '40‚Äì50 L' },
      { id: 'yuca', nombre: 'Yuca', tipo: 'Ra√≠z/tub√©rculo', imagen: 'img/yuca.jpg', diasCosecha: '8‚Äì12 meses', sol: 'Pleno sol', siembra: 'Estacas de tallo', distancia: '80‚Äì100 cm', profundidad: '10‚Äì15 cm', tiesto: 'Suelo directo' },
      { id: 'zanahoria', nombre: 'Zanahoria', tipo: 'Ra√≠z', imagen: 'img/zanahoria.jpg', diasCosecha: '70‚Äì90 d√≠as', sol: 'Sol suave', siembra: 'Siembra directa', distancia: '5‚Äì8 cm', profundidad: '1‚Äì2 cm', tiesto: '10‚Äì12 L' }
    ];

    // Meses y recomendaciones
    const mesesInfo = [
      { id: 1, nombre: 'Ene' },
      { id: 2, nombre: 'Feb' },
      { id: 3, nombre: 'Mar' },
      { id: 4, nombre: 'Abr' },
      { id: 5, nombre: 'May' },
      { id: 6, nombre: 'Jun' },
      { id: 7, nombre: 'Jul' },
      { id: 8, nombre: 'Ago' },
      { id: 9, nombre: 'Sep' },
      { id: 10, nombre: 'Oct' },
      { id: 11, nombre: 'Nov' },
      { id: 12, nombre: 'Dic' }
    ];

    const siembrasPorMes = {
      1: ['lechuga','espinaca','acelga','cilantro','recao','kale','col_risada','repollo','zanahoria','rabano','remolacha','remolacha_blanca','berro','apio'],
      2: ['lechuga','espinaca','acelga','cilantro','kale','col_risada','col_roja','repollo','broccoli','coliflor','zanahoria','rabano','remolacha','remolacha_blanca','cebolla'],
      3: ['tomate','pimiento','pimiento_morron','aji','berenjena','pepinillo','calabaza','cantalope','melon','habichuelas','maiz','quimbombo','lechuga','espinaca','cilantro','albahaca','menta'],
      4: ['tomate','pimiento','pimiento_morron','aji','berenjena','pepinillo','calabaza','cantalope','melon','habichuelas','maiz','quimbombo','gandules','batata','yuca','yautia','papa'],
      5: ['calabaza','cantalope','melon','maiz','quimbombo','gandules','habichuelas','batata','yuca','yautia','papa','malanga','platano','guineo','papaya','parcha'],
      6: ['batata','yuca','yautia','malanga','platano','guineo','papaya','parcha','gandules','calabaza','quimbombo','maiz'],
      7: ['tomate','pimiento','pimiento_morron','berenjena','quimbombo','gandules','habichuelas','batata','yuca','yautia','albahaca','menta','oregano','oregano_brujo'],
      8: ['tomate','pimiento','berenjena','habichuelas','gandules','lechuga','espinaca','cilantro','recao','albahaca','menta','oregano','oregano_brujo'],
      9: ['lechuga','espinaca','acelga','cilantro','recao','kale','col_risada','col_roja','repollo','broccoli','coliflor','zanahoria','rabano','remolacha','remolacha_blanca','apio','escarolas'],
      10: ['lechuga','espinaca','acelga','cilantro','recao','kale','col_risada','col_roja','repollo','broccoli','coliflor','zanahoria','rabano','remolacha','remolacha_blanca','apio','berro'],
      11: ['lechuga','espinaca','acelga','cilantro','recao','kale','col_risada','repollo','zanahoria','rabano','remolacha','remolacha_blanca','habichuelas','apio'],
      12: ['lechuga','espinaca','acelga','cilantro','recao','berro','kale','col_risada','repollo','zanahoria','rabano','remolacha']
    };

    const cultivoMeses = {};
    Object.entries(siembrasPorMes).forEach(([mesStr, lista]) => {
      const mesNum = parseInt(mesStr, 10);
      lista.forEach(id => {
        if (!cultivoMeses[id]) cultivoMeses[id] = [];
        if (!cultivoMeses[id].includes(mesNum)) cultivoMeses[id].push(mesNum);
      });
    });
    Object.values(cultivoMeses).forEach(arr => arr.sort((a, b) => a - b));

    function obtenerCategoriaSol(solStr) {
      const s = (solStr || '').toLowerCase();
      if (s.includes('media sombra')) return 'Media sombra';
      if (s.includes('sol suave')) return 'Sol suave';
      return 'Pleno sol';
    }

    document.addEventListener('DOMContentLoaded', () => {
      // --- Navegaci√≥n ---
      const views = document.querySelectorAll('section.view');
      const pillButtons = document.querySelectorAll('.pill-nav .nav-btn');
      const allViewButtons = document.querySelectorAll('.nav-btn,[data-view-target]');

      function setView(viewId) {
        views.forEach(v => v.classList.toggle('active', v.id === viewId));
      }

      function setActivePill(viewId) {
        pillButtons.forEach(b => {
          const v = b.dataset.view;
          b.classList.toggle('active', v === viewId);
        });
      }

      allViewButtons.forEach(btn => {
        const target = btn.dataset.viewTarget || btn.dataset.view;
        if (!target) return;
        btn.addEventListener('click', () => {
          setView(target);
          setActivePill(target);
        });
      });

      // --- Calendario ---
      const monthButtonsContainer = document.getElementById('monthButtons');
      const monthResults = document.getElementById('monthResults');

      mesesInfo.forEach(m => {
        const btn = document.createElement('button');
        btn.className = 'month-btn';
        btn.textContent = m.nombre;
        btn.dataset.mesId = String(m.id);
        btn.addEventListener('click', () => {
          document.querySelectorAll('.month-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          mostrarSiembrasDeMes(m.id);
        });
        monthButtonsContainer.appendChild(btn);
      });

      function mostrarSiembrasDeMes(mesId) {
        monthResults.innerHTML = '';
        const ids = siembrasPorMes[mesId] || [];
        if (!ids.length) {
          monthResults.innerHTML = `
            <div class="empty-state">
              <span class="emoji">üåßÔ∏è</span>
              A√∫n no hay cultivos recomendados para este mes.
            </div>`;
          return;
        }
        ids.forEach(id => {
          const cultivo = cultivos.find(c => c.id === id);
          if (!cultivo) return;
          const item = document.createElement('div');
          item.className = 'list-item';
          item.innerHTML = `
            <div class="list-main">
              <div class="list-title">${cultivo.nombre}</div>
              <div class="list-meta">
                <span class="meta-pill">${cultivo.tipo}</span>
                <span class="meta-pill">‚è±Ô∏è ${cultivo.diasCosecha}</span>
                <span class="meta-pill">‚òÄÔ∏è ${cultivo.sol}</span>
              </div>
            </div>
            <button class="small-btn" type="button" data-crop-id="${cultivo.id}">
              <span class="emoji">‚ÑπÔ∏è</span><span>Ver ficha</span>
            </button>
          `;
          monthResults.appendChild(item);
        });
      }

      const hoy = new Date();
      const mesActual = hoy.getMonth() + 1;
      const btnMesActual =
        monthButtonsContainer.querySelector(`.month-btn[data-mes-id="${mesActual}"]`) ||
        monthButtonsContainer.querySelector('.month-btn');
      if (btnMesActual) {
        btnMesActual.classList.add('active');
        mostrarSiembrasDeMes(parseInt(btnMesActual.dataset.mesId, 10));
      }

      // --- Cat√°logo ---
      const catalogSearch = document.getElementById('catalogSearch');
      const catalogTypeFilters = document.getElementById('catalogTypeFilters');
      const catalogSunFilters = document.getElementById('catalogSunFilters');
      const catalogGrid = document.getElementById('catalogGrid');

      let filtroTipoActual = 'Todos';
      let filtroSolActual = 'Todos';
      let textoBusqueda = '';

      const tiposUnicos = Array.from(new Set(cultivos.map(c => c.tipo))).sort();
      const solSet = new Set();
      cultivos.forEach(c => solSet.add(obtenerCategoriaSol(c.sol)));
      const solesUnicos = Array.from(solSet).sort();

      const tiposFiltro = ['Todos', ...tiposUnicos];
      tiposFiltro.forEach(tipo => {
        const chip = document.createElement('button');
        chip.type = 'button';
        chip.className = 'chip';
        chip.dataset.tipo = tipo;
        chip.textContent = tipo === 'Todos' ? 'Todos los tipos' : tipo;
        chip.addEventListener('click', () => {
          document.querySelectorAll('#catalogTypeFilters .chip').forEach(c => c.classList.remove('active'));
          chip.classList.add('active');
          filtroTipoActual = tipo;
          renderCatalog();
        });
        catalogTypeFilters.appendChild(chip);
      });
      const primerChipTipo = catalogTypeFilters.querySelector('.chip');
      if (primerChipTipo) primerChipTipo.classList.add('active');

      const solesFiltro = ['Todos', ...solesUnicos];
      solesFiltro.forEach(cat => {
        const chip = document.createElement('button');
        chip.type = 'button';
        chip.className = 'chip';
        chip.dataset.sol = cat;
        chip.textContent = cat === 'Todos' ? 'Todo tipo de sol' : `‚òÄÔ∏è ${cat}`;
        chip.addEventListener('click', () => {
          document.querySelectorAll('#catalogSunFilters .chip').forEach(c => c.classList.remove('active'));
          chip.classList.add('active');
          filtroSolActual = cat;
          renderCatalog();
        });
        catalogSunFilters.appendChild(chip);
      });
      const primerChipSol = catalogSunFilters.querySelector('.chip');
      if (primerChipSol) primerChipSol.classList.add('active');

      catalogSearch.addEventListener('input', () => {
        textoBusqueda = (catalogSearch.value || '').toLowerCase();
        renderCatalog();
      });

      function renderCatalog() {
        catalogGrid.innerHTML = '';
        const texto = textoBusqueda.trim();

        const listaFiltrada = cultivos.filter(c => {
          const coincideTipo = filtroTipoActual === 'Todos' || c.tipo === filtroTipoActual;
          const catSol = obtenerCategoriaSol(c.sol);
          const coincideSol = filtroSolActual === 'Todos' || catSol === filtroSolActual;
          const coincideBusqueda =
            !texto ||
            c.nombre.toLowerCase().includes(texto) ||
            c.id.toLowerCase().includes(texto);
          return coincideTipo && coincideSol && coincideBusqueda;
        });

        if (!listaFiltrada.length) {
          catalogGrid.innerHTML = `
            <div class="empty-state">
              <span class="emoji">üîç</span>
              No se encontraron cultivos con estos filtros.
            </div>`;
          return;
        }

        listaFiltrada.forEach(cultivo => {
          const card = document.createElement('article');
          card.className = 'crop-card';
          card.innerHTML = `
            <div class="crop-photo">
              <img src="${cultivo.imagen}" alt="${cultivo.nombre}">
            </div>
            <div class="crop-body">
              <div class="crop-name">${cultivo.nombre}</div>
              <div class="crop-tags">
                <span class="crop-tag">${cultivo.tipo}</span>
                <span class="crop-tag">‚è±Ô∏è ${cultivo.diasCosecha}</span>
                <span class="crop-tag">‚òÄÔ∏è ${cultivo.sol}</span>
              </div>
            </div>
          `;
          card.addEventListener('click', () => abrirFichaCultivo(cultivo));
          catalogGrid.appendChild(card);
        });
      }
      renderCatalog();

      // --- Cierre de di√°logos por fondo / bot√≥n gen√©rico ---
      const dialogBackdrops = document.querySelectorAll('.dialog-backdrop');
      dialogBackdrops.forEach(backdrop => {
        backdrop.addEventListener('click', (e) => {
          if (e.target === backdrop) backdrop.classList.remove('active');
        });
      });
      document.querySelectorAll('[data-dialog-close]').forEach(btn => {
        btn.addEventListener('click', () => {
          const backdrop = btn.closest('.dialog-backdrop');
          if (backdrop) backdrop.classList.remove('active');
        });
      });

      // --- Ficha de cultivo ---
      const cropDialog = document.getElementById('cropDialog');
      const cropDialogImg = document.getElementById('cropDialogImg');
      const cropDialogName = document.getElementById('cropDialogName');
      const cropDialogTipo = document.getElementById('cropDialogTipo');
      const cropDialogDias = document.getElementById('cropDialogDias');
      const cropDialogSol = document.getElementById('cropDialogSol');
      const cropDialogSiembra = document.getElementById('cropDialogSiembra');
      const cropDialogMeses = document.getElementById('cropDialogMeses');
      const cropDialogDistancia = document.getElementById('cropDialogDistancia');
      const cropDialogProfundidad = document.getElementById('cropDialogProfundidad');
      const cropDialogTiesto = document.getElementById('cropDialogTiesto');

      function abrirFichaCultivo(c) {
        cropDialogImg.src = c.imagen;
        cropDialogImg.alt = c.nombre;
        cropDialogName.textContent = c.nombre;
        cropDialogTipo.textContent = c.tipo;
        cropDialogDias.textContent = `‚è±Ô∏è ${c.diasCosecha}`;
        cropDialogSol.textContent = `‚òÄÔ∏è ${c.sol}`;
        cropDialogSiembra.textContent = c.siembra;

        const mesesCultivo = cultivoMeses[c.id] || [];
        if (mesesCultivo.length) {
          const nombresMeses = mesesCultivo
            .map(num => {
              const m = mesesInfo.find(mm => mm.id === num);
              return m ? m.nombre : '';
            })
            .filter(Boolean);
          cropDialogMeses.textContent = nombresMeses.join(', ');
        } else {
          cropDialogMeses.textContent = 'Todo el a√±o (seg√∫n clima y manejo)';
        }

        cropDialogDistancia.textContent = c.distancia;
        cropDialogProfundidad.textContent = c.profundidad;
        cropDialogTiesto.textContent = c.tiesto;
        cropDialog.classList.add('active');
      }

      monthResults.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-crop-id]');
        if (!btn) return;
        const id = btn.dataset.cropId;
        const cultivo = cultivos.find(c => c.id === id);
        if (cultivo) abrirFichaCultivo(cultivo);
      });

      // --- Mi huerto (4x4) ---
      const gardenGrid = document.getElementById('gardenGrid');
      const gardenDialogEl = document.getElementById('gardenDialog');
      const gardenDialogPosition = document.getElementById('gardenDialogPosition');
      const gardenCropSelect = document.getElementById('gardenCropSelect');
      const gardenSave = document.getElementById('gardenSave');
      const resetGardenBtn = document.getElementById('resetGarden');
      const GARDEN_KEY = 'mi_siembra_huerto_v1';
      const gardenSize = 4;
      let gardenState = [];

      function cargarGarden() {
        try {
          const stored = JSON.parse(localStorage.getItem(GARDEN_KEY) || 'null');
          if (Array.isArray(stored) && stored.length === gardenSize * gardenSize) {
            gardenState = stored;
          } else {
            gardenState = Array(gardenSize * gardenSize).fill(null);
          }
        } catch {
          gardenState = Array(gardenSize * gardenSize).fill(null);
        }
      }

      function guardarGarden() {
        localStorage.setItem(GARDEN_KEY, JSON.stringify(gardenState));
      }

      function renderGarden() {
        gardenGrid.innerHTML = '';
        gardenState.forEach((cultivoId, index) => {
          const cell = document.createElement('button');
          cell.type = 'button';
          cell.className = 'garden-cell';
          cell.dataset.index = String(index);
          const label = document.createElement('div');
          label.className = 'garden-cell-label';
          label.textContent = `#${index + 1}`;
          const plant = document.createElement('div');
          plant.className = 'garden-cell-plant';
          if (cultivoId) {
            const cultivo = cultivos.find(c => c.id === cultivoId);
            plant.textContent = cultivo ? cultivo.nombre : cultivoId;
          } else {
            plant.textContent = 'Vac√≠o';
          }
          cell.appendChild(label);
          cell.appendChild(plant);
          gardenGrid.appendChild(cell);
        });
      }

      gardenGrid.addEventListener('click', (e) => {
        const cell = e.target.closest('.garden-cell');
        if (!cell) return;
        const index = parseInt(cell.dataset.index, 10);
        abrirDialogoHuerto(index);
      });

      function abrirDialogoHuerto(index) {
        gardenDialogEl.dataset.index = String(index);
        gardenDialogPosition.textContent =
          `Cuadro #${index + 1} (fila ${Math.floor(index / gardenSize) + 1}, columna ${(index % gardenSize) + 1})`;
        gardenCropSelect.innerHTML = '<option value="">Vac√≠o</option>';
        cultivos.forEach(c => {
          const opt = document.createElement('option');
          opt.value = c.id;
          opt.textContent = c.nombre;
          gardenCropSelect.appendChild(opt);
        });
        const actual = gardenState[index];
        gardenCropSelect.value = actual || '';
        gardenDialogEl.classList.add('active');
      }

      gardenSave.addEventListener('click', () => {
        const index = parseInt(gardenDialogEl.dataset.index || '0', 10);
        const val = gardenCropSelect.value || null;
        gardenState[index] = val;
        guardarGarden();
        renderGarden();
        gardenDialogEl.classList.remove('active');
      });

      // --- Confirmaci√≥n gen√©rica ---
      const confirmDialogEl = document.getElementById('confirmDialog');
      const confirmMessageEl = document.getElementById('confirmMessage');
      const confirmCancelBtn = document.getElementById('confirmCancel');
      const confirmOkBtn = document.getElementById('confirmOk');
      let confirmOkHandler = null;

      function openConfirm(message, onOk) {
        confirmMessageEl.textContent = message;
        confirmOkHandler = onOk;
        confirmDialogEl.classList.add('active');
      }

      confirmCancelBtn.addEventListener('click', () => {
        confirmDialogEl.classList.remove('active');
        confirmOkHandler = null;
      });

      confirmOkBtn.addEventListener('click', () => {
        if (typeof confirmOkHandler === 'function') {
          const fn = confirmOkHandler;
          confirmOkHandler = null;
          confirmDialogEl.classList.remove('active');
          fn();
        } else {
          confirmDialogEl.classList.remove('active');
        }
      });

      resetGardenBtn.addEventListener('click', () => {
        openConfirm('¬øSeguro que quieres limpiar todo el plano del huerto?', () => {
          gardenState = Array(gardenSize * gardenSize).fill(null);
          guardarGarden();
          renderGarden();
        });
      });

      cargarGarden();
      renderGarden();

      // --- Diario ---
      const diaryList = document.getElementById('diaryList');
      const diaryEmpty = document.getElementById('diaryEmpty');
      const addDiaryEntryBtn = document.getElementById('addDiaryEntry');
      const diaryDialogEl = document.getElementById('diaryDialog');
      const diaryType = document.getElementById('diaryType');
      const diaryDate = document.getElementById('diaryDate');
      const diaryNotes = document.getElementById('diaryNotes');
      const diarySave = document.getElementById('diarySave');
      const DIARY_KEY = 'mi_siembra_diario_v1';
      let diaryEntries = [];

      function cargarDiario() {
        try {
          const stored = JSON.parse(localStorage.getItem(DIARY_KEY) || 'null');
          diaryEntries = Array.isArray(stored) ? stored : [];
        } catch {
          diaryEntries = [];
        }
      }

      function guardarDiario() {
        localStorage.setItem(DIARY_KEY, JSON.stringify(diaryEntries));
      }

      function renderDiario() {
        diaryList.innerHTML = '';
        if (!diaryEntries.length) {
          diaryEmpty.style.display = 'block';
          return;
        }
        diaryEmpty.style.display = 'none';

        const items = diaryEntries
          .map((entry, index) => ({ entry, index }))
          .slice()
          .sort((a, b) => (b.entry.fecha || '').localeCompare(a.entry.fecha || ''));

        items.forEach(({ entry, index }) => {
          const div = document.createElement('div');
          div.className = 'diary-entry';
          div.dataset.index = String(index);
          div.innerHTML = `
            <div class="diary-meta">
              <div class="diary-type">${entry.tipo || 'Actividad'}</div>
              <div class="diary-date">${entry.fecha || ''}</div>
            </div>
            <div class="diary-notes">${entry.notas || ''}</div>
          `;
          diaryList.appendChild(div);
        });
      }

      addDiaryEntryBtn.addEventListener('click', () => {
        const hoyISO = new Date().toISOString().slice(0, 10);
        diaryDate.value = hoyISO;
        diaryNotes.value = '';
        diaryType.value = 'Siembra';
        diaryDialogEl.classList.add('active');
      });

      diarySave.addEventListener('click', () => {
        const entrada = {
          tipo: diaryType.value || 'Actividad',
          fecha: diaryDate.value || new Date().toISOString().slice(0, 10),
          notas: diaryNotes.value.trim()
        };
        diaryEntries.push(entrada);
        guardarDiario();
        renderDiario();
        diaryDialogEl.classList.remove('active');
      });

      diaryList.addEventListener('click', (event) => {
        const item = event.target.closest('.diary-entry');
        if (!item) return;

        const idxStr = item.dataset.index;
        if (typeof idxStr === 'undefined') return;
        const index = parseInt(idxStr, 10);
        if (Number.isNaN(index) || index < 0 || index >= diaryEntries.length) return;

        const entrada = diaryEntries[index];
        const textoConfirm = entrada && entrada.tipo
          ? `¬øBorrar la entrada "${entrada.tipo}" del diario?`
          : '¬øBorrar esta entrada del diario?';

        openConfirm(textoConfirm, () => {
          diaryEntries.splice(index, 1);
          guardarDiario();
          renderDiario();
        });
      });

      cargarDiario();
      renderDiario();

      // --- Respaldo de datos ---
      const backupCard = document.getElementById('backupCard');
      if (backupCard) {
        backupCard.addEventListener('click', () => {
          const backup = {
            version: '1.0',
            fecha: new Date().toISOString(),
            huerto: gardenState,
            diario: diaryEntries
          };
          try {
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mi-siembra-respaldo.json';
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
          } catch (err) {
            console.warn('No se pudo crear el respaldo', err);
            alert('No se pudo crear el archivo de respaldo. Intenta nuevamente.');
          }
        });
      }

      // --- Service Worker ---
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js').catch(err => {
          console.warn('SW error', err);
        });
      }
    });
  </script>

  <footer style="margin-top: 2rem; padding: 1rem; text-align: center; font-size: 0.8rem; color: #9ca3af;">
    <div>Mi Siembra Inteligente ‚Äî versi√≥n 1.0 (PWA)</div>
    <div>Desarrollado por Ricardo D√≠az</div>
  </footer>
</body>
  </html>
