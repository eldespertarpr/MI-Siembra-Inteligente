<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mi Siembra Inteligente (v17)</title>

  <!-- PWA (opcional, si tienes esos archivos) -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#22c55e" />

  <style>
    :root{
      color-scheme: dark;
      --bg:#020617;
      --bg-elev:#02081f;
      --card:#050b1f;
      --card2:#08122f;
      --text:#f9fafb;
      --muted:#9ca3af;
      --accent:#22c55e;
      --accent2:rgba(34,197,94,.18);
      --border:rgba(255,255,255,.10);
      --shadow: 0 18px 60px rgba(0,0,0,.50);
      --radius: 18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 50% -200px, rgba(34,197,94,.25), transparent 60%), var(--bg);
      color:var(--text);
    }

    .app-shell{ max-width: 980px; margin: 0 auto; padding: 18px; }

    /* Header */
    .hero{
      background: radial-gradient(900px 400px at 30% 10%, rgba(34,197,94,.35), transparent 60%),
                  linear-gradient(135deg, rgba(34,197,94,.25), rgba(0,0,0,.20));
      border: 1px solid var(--border);
      border-radius: 28px;
      padding: 18px;
      box-shadow: var(--shadow);
    }
    .hero-row{ display:flex; gap:14px; align-items:center; }
    .logo{
      width:56px; height:56px; border-radius: 18px;
      background: radial-gradient(circle at 30% 30%, rgba(34,197,94,.9), rgba(6,20,16,.35));
      border: 1px solid rgba(255,255,255,.14);
      display:grid; place-items:center;
      font-size: 28px;
    }
    .hero-title{ font-weight:800; font-size: 26px; line-height:1.1; }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      border:1px solid var(--border);
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.25);
      color: var(--text);
      font-size: 12px;
    }
    .hero-sub{ color: var(--muted); margin-top: 8px; }

    /* Menu grid */
    .menu{
      margin-top: 16px;
      border:1px solid var(--border);
      border-radius: 26px;
      padding: 14px;
      background: linear-gradient(180deg, rgba(2,6,23,.35), rgba(2,6,23,.75));
      box-shadow: var(--shadow);
    }
    .menu-grid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 14px;
    }
    .menu-btn{
      border:1px solid var(--border);
      background: rgba(0,0,0,.30);
      color: var(--text);
      border-radius: 22px;
      padding: 14px 12px;
      text-align:center;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, border-color .15s ease;
    }
    .menu-btn:active{ transform: scale(.99); }
    .menu-btn.active{
      border-color: rgba(34,197,94,.55);
      box-shadow: 0 0 0 4px rgba(34,197,94,.10);
    }
    .menu-ico{ font-size: 22px; display:block; }
    .menu-lbl{ font-size: 12px; margin-top: 6px; color: var(--muted); }
    @media (max-width: 520px){
      .menu-grid{ grid-template-columns: repeat(3, 1fr); }
    }

    /* Sections */
    section{ display:none; margin-top: 16px; }
    section.active{ display:block; }
    .section-title{
      display:flex; align-items:center; gap:10px;
      font-weight:800; font-size: 22px;
      margin: 8px 0 10px;
    }
    .section-sub{ color: var(--muted); margin: 0 0 12px; }

    .card{
      border:1px solid var(--border);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(8,18,47,.55), rgba(5,11,31,.80));
      box-shadow: var(--shadow);
      padding: 14px;
    }

    .field{ margin-top: 10px; }
    label{ display:block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    input[type="text"]{
      width:100%;
      border:1px solid var(--border);
      border-radius: 999px;
      padding: 12px 14px;
      background: rgba(0,0,0,.30);
      color: var(--text);
      outline:none;
    }
    input[type="text"]:focus{
      border-color: rgba(34,197,94,.55);
      box-shadow: 0 0 0 4px rgba(34,197,94,.12);
    }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .btn{
      border:1px solid var(--border);
      background: rgba(0,0,0,.25);
      color: var(--text);
      border-radius: 999px;
      padding: 10px 14px;
      cursor:pointer;
      user-select:none;
      display:inline-flex; gap:8px; align-items:center;
    }
    .btn:active{ transform: scale(.99); }
    .btn.primary{
      border-color: rgba(34,197,94,.55);
      background: rgba(34,197,94,.15);
    }

    /* Cat√°logo list */
    .cultivos-list{ margin-top: 12px; display:flex; flex-direction:column; gap: 10px; }
    .cultivo{
      border:1px solid var(--border);
      border-radius: 18px;
      padding: 12px;
      background: rgba(0,0,0,.22);
      display:flex; gap:12px; align-items:flex-start;
    }
    .cultivo-img{
      width:66px; height:66px; border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: radial-gradient(circle at 30% 30%, rgba(34,197,94,.65), rgba(0,0,0,.40));
      display:grid; place-items:center;
      font-size: 24px;
      flex: 0 0 auto;
    }
    .cultivo-main{ flex:1; min-width: 0; }
    .cultivo-title{ font-weight:800; font-size: 18px; }
    .cultivo-meta{ color: var(--muted); font-size: 13px; margin-top: 6px; line-height:1.35; }
    .tag{
      border:1px solid var(--border);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--text);
      background: rgba(0,0,0,.25);
      white-space: nowrap;
      flex: 0 0 auto;
    }

    /* Sheet Categor√≠as */
    .sheet-backdrop{
      position: fixed; inset: 0;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(2px);
      z-index: 999;
    }
    .sheet{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 18px;
      width: min(940px, calc(100vw - 18px));
      max-height: 75vh;
      overflow:auto;
      border:1px solid var(--border);
      border-radius: 26px;
      background: linear-gradient(180deg, rgba(8,18,47,.92), rgba(2,6,23,.92));
      box-shadow: var(--shadow);
      z-index: 1000;
    }
    .sheet-header{
      position: sticky; top: 0;
      display:flex; align-items:center; justify-content: space-between;
      padding: 12px 14px;
      border-bottom:1px solid var(--border);
      background: rgba(2,6,23,.75);
      border-top-left-radius: 26px;
      border-top-right-radius: 26px;
    }
    .sheet-title{ font-weight:900; }
    .sheet-list{
      padding: 12px 14px 16px;
      display:flex; flex-wrap:wrap; gap:10px;
    }
    .sheet-chip{
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.05);
      padding: 10px 12px;
      border-radius: 999px;
      cursor:pointer;
      user-select:none;
      display:inline-flex; align-items:center; gap:8px;
      font-size: 14px;
    }
    .sheet-chip.active{
      border-color: rgba(34,197,94,.55);
      background: rgba(34,197,94,.16);
    }

    /* Tiny footer hint */
    .muted{ color: var(--muted); font-size: 13px; }
  </style>
</head>

<body>
  <div class="app-shell">

    <!-- HERO -->
    <div class="hero">
      <div class="hero-row">
        <div class="logo">üå±</div>
        <div style="min-width:0">
          <div class="hero-title">Mi Siembra Inteligente</div>
          <div style="margin-top:8px; display:flex; gap:10px; flex-wrap:wrap;">
            <span class="pill">v17 ¬∑ PWA</span>
            <span class="pill">Huerto ‚ÄúMi huerto‚Äù</span>
            <span class="pill">clima tropical</span>
            <span class="pill">hemisferio norte</span>
          </div>
          <div class="hero-sub">Resumen r√°pido y acceso a las funciones principales.</div>
        </div>
      </div>
    </div>

    <!-- MENU -->
    <div class="menu">
      <div class="menu-grid" id="menuGrid">
        <button class="menu-btn active" data-target="inicio"><span class="menu-ico">üè†</span><span class="menu-lbl">Inicio</span></button>
        <button class="menu-btn" data-target="calendario"><span class="menu-ico">üìÖ</span><span class="menu-lbl">Calendario</span></button>
        <button class="menu-btn" data-target="catalogo"><span class="menu-ico">üå±</span><span class="menu-lbl">Cat√°logo</span></button>
        <button class="menu-btn" data-target="mihuerto"><span class="menu-ico">üåø</span><span class="menu-lbl">Mi huerto</span></button>
        <button class="menu-btn" data-target="diario"><span class="menu-ico">üìì</span><span class="menu-lbl">Diario</span></button>
        <button class="menu-btn" data-target="plagas"><span class="menu-ico">üêõ</span><span class="menu-lbl">Plagas</span></button>
        <button class="menu-btn" data-target="pesticidas"><span class="menu-ico">üíß</span><span class="menu-lbl">Pesticidas</span></button>
        <button class="menu-btn" data-target="opciones"><span class="menu-ico">‚öôÔ∏è</span><span class="menu-lbl">Opciones</span></button>
        <button class="menu-btn" data-target="guias"><span class="menu-ico">üìö</span><span class="menu-lbl">Gu√≠as</span></button>
      </div>
    </div>

    <!-- SECTIONS -->
    <section id="section-inicio" class="active">
      <div class="section-title">üè† Inicio</div>
      <p class="section-sub">Resumen r√°pido de tu huerto.</p>
      <div class="card">
        <div class="row" style="justify-content:space-between;">
          <div>
            <div style="font-weight:800;">Cultivos registrados</div>
            <div class="muted">0</div>
          </div>
          <div class="tag">Clima tropical</div>
        </div>
        <p class="muted" style="margin-top:10px;">Aqu√≠ puedes poner tus tarjetas/estad√≠sticas reales luego.</p>
      </div>
    </section>

    <section id="section-calendario">
      <div class="section-title">üìÖ Calendario</div>
      <p class="section-sub">Eventos y recordatorios (placeholder).</p>
      <div class="card"><span class="muted">Pendiente de integrar tu calendario real.</span></div>
    </section>

    <section id="section-catalogo">
      <div class="section-title">üå± Cat√°logo de cultivos</div>
      <p class="section-sub">Lista con informaci√≥n r√°pida y gu√≠a de germinaci√≥n / reproducci√≥n.</p>

      <div class="card">
        <div class="field">
          <label for="catalogoBusqueda">Buscar</label>
          <input id="catalogoBusqueda" type="text" placeholder="Escribe: albahaca, tomate..." />
        </div>

        <div class="row" style="margin-top:12px;">
          <button type="button" class="btn primary" id="btnCategorias">üå± Categor√≠as</button>
          <button type="button" class="btn" id="btnResetFiltros">üßπ Limpiar filtros</button>
          <span class="muted" id="filtroActual"></span>
        </div>

        <div class="cultivos-list" id="cultivosList"></div>
      </div>
    </section>

    <section id="section-mihuerto">
      <div class="section-title">üåø Mi huerto</div>
      <p class="section-sub">Tus cultivos registrados (placeholder).</p>
      <div class="card"><span class="muted">Pendiente de integrar tu data real (localStorage, etc.).</span></div>
    </section>

    <section id="section-diario">
      <div class="section-title">üìì Diario</div>
      <p class="section-sub">Entradas (placeholder).</p>
      <div class="card"><span class="muted">Pendiente de integrar diario real.</span></div>
    </section>

    <section id="section-plagas">
      <div class="section-title">üêõ Plagas</div>
      <p class="section-sub">Gu√≠a r√°pida (placeholder).</p>
      <div class="card"><span class="muted">Pendiente.</span></div>
    </section>

    <section id="section-pesticidas">
      <div class="section-title">üíß Pesticidas</div>
      <p class="section-sub">Listado (placeholder).</p>
      <div class="card"><span class="muted">Pendiente.</span></div>
    </section>

    <section id="section-opciones">
      <div class="section-title">‚öôÔ∏è Opciones</div>
      <p class="section-sub">Configuraci√≥n (placeholder).</p>
      <div class="card"><span class="muted">Pendiente.</span></div>
    </section>

    <section id="section-guias">
      <div class="section-title">üìö Gu√≠as</div>
      <p class="section-sub">Contenido (placeholder).</p>
      <div class="card"><span class="muted">Pendiente.</span></div>
    </section>

  </div><!-- /app-shell -->

  <!-- Sheet Categor√≠as (FUERA de app-shell y ANTES del script) -->
  <div id="catSheetBackdrop" class="sheet-backdrop" hidden></div>

  <div id="catSheet" class="sheet" hidden>
    <div class="sheet-header">
      <div class="sheet-title">Categor√≠as</div>
      <button type="button" class="btn" id="btnCerrarCatSheet">Cerrar</button>
    </div>
    <div id="catSheetList" class="sheet-list"></div>
  </div>

  <script>
    /***********************
     * DATA DEMO (c√°mbialo luego por el tuyo)
     ***********************/
    const CULTIVOS = [
      { id:"alb", nombre:"Albahaca", categoria:"Arom√°tica", diasCosecha:"40‚Äì60", luz:"Sol directo suave", riego:"Suelo ligeramente h√∫medo" },
      { id:"tom", nombre:"Tomate", categoria:"Frutal", diasCosecha:"70‚Äì90", luz:"Sol pleno", riego:"Regular, sin encharcar" },
      { id:"cil", nombre:"Cilantro", categoria:"Arom√°tica", diasCosecha:"30‚Äì45", luz:"Sol / semi-sombra", riego:"Ligero" },
      { id:"lec", nombre:"Lechuga", categoria:"Hoja", diasCosecha:"30‚Äì55", luz:"Semi-sombra", riego:"Constante" },
      { id:"aji", nombre:"Aj√≠ dulce", categoria:"Frutal", diasCosecha:"80‚Äì120", luz:"Sol pleno", riego:"Moderado" }
    ];

    let filtroCategoria = null;

    /***********************
     * NAV
     ***********************/
    function goToSection(key){
      document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
      const el = document.getElementById("section-" + key);
      if (el) el.classList.add("active");

      document.querySelectorAll(".menu-btn").forEach(b => b.classList.remove("active"));
      const btn = document.querySelector(`.menu-btn[data-target="${key}"]`);
      if (btn) btn.classList.add("active");
    }

    function setupNavigation(){
      document.getElementById("menuGrid")?.addEventListener("click", (e) => {
        const b = e.target.closest(".menu-btn");
        if (!b) return;
        goToSection(b.dataset.target);
      });
    }

    /***********************
     * CAT√ÅLOGO
     ***********************/
    function renderCatalogo(){
      const list = document.getElementById("cultivosList");
      const q = (document.getElementById("catalogoBusqueda")?.value || "").trim().toLowerCase();

      const filtrados = CULTIVOS.filter(c => {
        const matchQ = !q || c.nombre.toLowerCase().includes(q) || c.categoria.toLowerCase().includes(q);
        const matchCat = !filtroCategoria || c.categoria === filtroCategoria;
        return matchQ && matchCat;
      });

      const filtroTxt = document.getElementById("filtroActual");
      if (filtroTxt){
        filtroTxt.textContent = filtroCategoria ? ("Filtro: " + filtroCategoria) : "";
      }

      if (!list) return;

      if (filtrados.length === 0){
        list.innerHTML = `<div class="cultivo"><div class="cultivo-main"><div class="cultivo-title">Sin resultados</div><div class="cultivo-meta">Prueba otra b√∫squeda o limpia filtros.</div></div></div>`;
        return;
      }

      list.innerHTML = filtrados.map(c => `
        <div class="cultivo">
          <div class="cultivo-img">üåø</div>
          <div class="cultivo-main">
            <div class="cultivo-title">${escapeHtml(c.nombre)}</div>
            <div class="cultivo-meta">
              <b>D√≠as a cosecha:</b> ${escapeHtml(c.diasCosecha)}<br/>
              <b>Luz:</b> ${escapeHtml(c.luz)}<br/>
              <b>Riego:</b> ${escapeHtml(c.riego)}
            </div>
          </div>
          <div class="tag">${escapeHtml(c.categoria)}</div>
        </div>
      `).join("");
    }

    function setupCatalogo(){
      const input = document.getElementById("catalogoBusqueda");
      input?.addEventListener("input", renderCatalogo);

      document.getElementById("btnCategorias")?.addEventListener("click", openCatSheet);
      document.getElementById("btnCerrarCatSheet")?.addEventListener("click", closeCatSheet);
      document.getElementById("catSheetBackdrop")?.addEventListener("click", closeCatSheet);

      document.getElementById("btnResetFiltros")?.addEventListener("click", () => {
        filtroCategoria = null;
        if (input) input.value = "";
        renderCatalogo();
      });

      renderCatalogo();
      renderCatSheet();
    }

    /***********************
     * SHEET CATEGOR√çAS
     ***********************/
    function openCatSheet(){
      document.getElementById("catSheetBackdrop")?.removeAttribute("hidden");
      document.getElementById("catSheet")?.removeAttribute("hidden");
    }
    function closeCatSheet(){
      document.getElementById("catSheetBackdrop")?.setAttribute("hidden", "");
      document.getElementById("catSheet")?.setAttribute("hidden", "");
    }

    function renderCatSheet(){
      const wrap = document.getElementById("catSheetList");
      if (!wrap) return;

      const categorias = Array.from(new Set(CULTIVOS.map(c => c.categoria))).sort((a,b)=>a.localeCompare(b));
      const chips = [
        { key:null, label:"Todas" },
        ...categorias.map(x => ({ key:x, label:x }))
      ];

      wrap.innerHTML = chips.map(ch => `
        <div class="sheet-chip ${ch.key === filtroCategoria ? "active" : ""}" data-cat="${ch.key ?? ""}">
          ${ch.key === null ? "‚ú®" : "üå±"} ${escapeHtml(ch.label)}
        </div>
      `).join("");

      wrap.addEventListener("click", (e) => {
        const chip = e.target.closest(".sheet-chip");
        if (!chip) return;
        const v = chip.getAttribute("data-cat");
        filtroCategoria = v ? v : null;
        renderCatSheet();
        renderCatalogo();
        closeCatSheet();
      }, { once: true }); // re-se engancha en cada render (simple y seguro)
    }

    /***********************
     * UTIL
     ***********************/
    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    /***********************
     * INIT
     ***********************/
    document.addEventListener("DOMContentLoaded", () => {
      setupNavigation();
      setupCatalogo();
      goToSection("inicio");
    });
  </script>
</body>
  </html>
