<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mi Siembra Inteligente (v17)</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#22c55e" />

  <style>
    :root {
      color-scheme: dark;
      --bg: #020617;
      --bg-elevated: #02081f;
      --card: #02081f;
      --card-soft: #030919;
      --accent: #22c55e;
      --accent-soft: rgba(34,197,94,0.15);
      --accent-strong: rgba(34,197,94,0.45);
      --text-main: #f9fafb;
      --text-soft: #9ca3af;
      --border-subtle: rgba(148,163,184,0.3);
      --danger: #f97373;
      --chip-bg: rgba(15,23,42,0.9);
      --chip-border: rgba(148,163,184,0.4);
      --shadow-soft: 0 18px 45px rgba(15,23,42,0.7);
      --radius-xl: 22px;
      --radius-lg: 18px;
      --radius-full: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Roboto", "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #022c22 0, #020617 55%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .app-shell {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px 12px 28px;
    }

    @media (min-width: 768px) {
      .app-shell {
        padding: 20px 16px 40px;
      }
    }

    /* HEADER */

    .app-header {
      background: radial-gradient(circle at 0 0, #4ade80 0, #16a34a 28%, #052e16 85%);
      border-radius: 28px;
      padding: 18px 18px 16px;
      display: flex;
      align-items: center;
      gap: 14px;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
      margin-bottom: 14px;
    }

    .app-header::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 120% -10%, rgba(34,197,94,0.35) 0, transparent 55%);
      opacity: 0.9;
      pointer-events: none;
    }

    .app-header-icon {
      position: relative;
      z-index: 1;
      width: 52px;
      height: 52px;
      border-radius: 18px;
      background: radial-gradient(circle at 30% 10%, #bbf7d0 0, #16a34a 35%, #052e16 90%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 14px 35px rgba(0,0,0,0.45);
      flex-shrink: 0;
    }

    .app-header-icon span {
      font-size: 32px;
    }

    .app-header-text {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .app-title-row {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .app-title {
      font-size: 1.35rem;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .app-tag {
      font-size: 0.72rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.45);
      border: 1px solid rgba(15,23,42,0.8);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #e5e7eb;
    }

    .app-subtitle {
      font-size: 0.80rem;
      color: #e5e7eb;
      opacity: 0.95;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .app-subtitle span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .app-subtitle-dot {
      width: 3px;
      height: 3px;
      border-radius: 50%;
      background: rgba(226,232,240,0.7);
    }

    /* NAV */

    .nav {
      margin-top: 8px;
      background: linear-gradient(135deg, var(--bg-elevated), #020617);
      border-radius: 26px;
      padding: 10px;
      box-shadow: 0 18px 40px rgba(15,23,42,0.85);
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      position: sticky;
      top: 0;
      z-index: 40;
      backdrop-filter: blur(16px);
      border: 1px solid rgba(15,23,42,0.85);
    }

    @media (min-width: 660px) {
      .nav {
        grid-template-columns: repeat(8, minmax(0,1fr));
      }
    }

    .nav-btn {
      border: none;
      border-radius: 999px;
      padding: 7px 6px 6px;
      font-size: 0.70rem;
      color: var(--text-soft);
      background: transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
      cursor: pointer;
      transition: background 0.18s, color 0.18s, transform 0.12s;
      position: relative;
      min-height: 52px;
    }

    .nav-btn span.nav-icon {
      font-size: 1.1rem;
    }

    .nav-btn span.nav-label {
      line-height: 1.1;
    }

    .nav-btn.nav-btn--active {
      background: radial-gradient(circle at top, var(--accent) 0, var(--accent-soft) 45%, transparent 100%);
      color: #ecfdf5;
      box-shadow: 0 0 0 1px rgba(34,197,94,0.4), 0 14px 30px rgba(22,163,74,0.55);
      transform: translateY(-1px);
    }

    .nav-btn.nav-btn--active::after {
      content: "";
      position: absolute;
      inset: auto auto -3px 50%;
      width: 32%;
      max-width: 42px;
      height: 3px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(34,197,94,0.1), rgba(34,197,94,0.6), rgba(34,197,94,0.1));
      transform: translateX(-50%);
    }

    /* SECTIONS */

    main {
      margin-top: 14px;
    }

    .section {
      display: none;
      animation: fadeIn 0.18s ease-out;
    }

    .section--active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .section > .section-title-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 14px 2px 8px;
    }

    .section-icon-pill {
      width: 26px;
      height: 26px;
      border-radius: 13px;
      background: radial-gradient(circle at 30% 15%, #fefce8 0, #fef9c3 25%, #0f172a 90%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }

    .section-title-row h2 {
      font-size: 1.05rem;
      margin: 0;
    }

    .section-subtitle {
      font-size: 0.82rem;
      color: var(--text-soft);
      margin: 2px 2px 10px;
    }

    .app-card {
      background: radial-gradient(circle at top left, #020617 0, #020617 40%, #02081f 100%);
      border-radius: var(--radius-xl);
      padding: 14px 16px 14px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      margin-bottom: 14px;
    }

    .app-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .app-card-title {
      font-size: 0.96rem;
      font-weight: 600;
    }

    .chip {
      border-radius: var(--radius-full);
      padding: 4px 10px;
      font-size: 0.74rem;
      border: 1px solid var(--chip-border);
      background: var(--chip-bg);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .chip.badge {
      background: rgba(34,197,94,0.12);
      border-color: rgba(34,197,94,0.6);
      color: #bbf7d0;
    }

    .chip-danger {
      border-color: rgba(239,68,68,0.7);
      color: #fecaca;
      background: rgba(127,29,29,0.5);
    }

    .context-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 4px 0 10px;
      font-size: 0.76rem;
      color: var(--text-soft);
    }

    .divider-soft {
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(148,163,184,0.4), transparent);
      margin: 8px -2px 10px;
    }

    .muted {
      color: var(--text-soft);
      font-size: 0.80rem;
    }

    .pill-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 8px -1px 4px;
    }

    .pill {
      border-radius: 999px;
      padding: 5px 12px;
      font-size: 0.78rem;
      border: 1px solid rgba(148,163,184,0.55);
      background: rgba(15,23,42,0.9);
      cursor: pointer;
    }

    .pill--active {
      background: var(--accent-soft);
      border-color: rgba(34,197,94,0.85);
      color: #bbf7d0;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 9px 14px;
      font-size: 0.82rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: linear-gradient(135deg, #16a34a, #22c55e);
      color: #022c22;
      box-shadow: 0 12px 30px rgba(22,163,74,0.55);
      transition: transform 0.12s, box-shadow 0.12s, filter 0.12s;
    }

    .btn span {
      font-size: 1rem;
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 7px 18px rgba(22,163,74,0.55);
      filter: brightness(0.96);
    }

    .btn-secondary {
      background: rgba(15,23,42,0.9);
      color: var(--text-main);
      border: 1px solid var(--border-subtle);
      box-shadow: none;
    }

    .btn-full {
      width: 100%;
      justify-content: center;
    }

    .btn-danger {
      background: linear-gradient(135deg, #b91c1c, #ef4444);
      color: #fee2e2;
      box-shadow: 0 10px 26px rgba(248,113,113,0.45);
    }

    .grid-two {
      display: grid;
      grid-template-columns: repeat(2,minmax(0,1fr));
      gap: 8px;
    }

    .small-label {
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-bottom: 2px;
    }

    .big-number {
      font-size: 1.3rem;
      font-weight: 600;
    }

    /* FORMS */

    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin: 8px 0 4px;
    }

    @media (min-width: 660px) {
      .form-grid--2 {
        grid-template-columns: repeat(2, minmax(0,1fr));
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field label {
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    input[type="text"],
    input[type="date"],
    select,
    textarea {
      background: rgba(15,23,42,0.95);
      border-radius: 14px;
      border: 1px solid rgba(51,65,85,0.9);
      padding: 8px 10px;
      color: var(--text-main);
      font-size: 0.83rem;
      font-family: inherit;
      width: 100%;
      max-width: 100%;
      outline: none;
      transition: border 0.12s, box-shadow 0.12s, background 0.12s;
    }

    select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      padding-right: 26px;
      background-image: linear-gradient(45deg, transparent 50%, #9ca3af 50%),
                        linear-gradient(135deg, #9ca3af 50%, transparent 50%);
      background-position: calc(100% - 15px) 10px, calc(100% - 11px) 10px;
      background-size: 6px 6px, 6px 6px;
      background-repeat: no-repeat;
    }

    textarea {
      min-height: 72px;
      resize: vertical;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: rgba(34,197,94,0.9);
      box-shadow: 0 0 0 1px rgba(34,197,94,0.5);
      background: rgba(15,23,42,0.98);
    }
/* Cat√°logo con imagen */
.catalogo-card-main {
  display: flex;
  gap: 10px;
  align-items: flex-start;
}

.catalogo-thumb {
  flex-shrink: 0;
}

.catalogo-thumb img {
  width: 70px;
  height: 70px;
  border-radius: 16px;
  object-fit: cover;
  border: 1px solid var(--border-subtle);
  box-shadow: 0 8px 20px rgba(15,23,42,0.7);
}

@media (max-width: 480px) {
  .catalogo-card-main {
    flex-direction: row;
  }
}
    /* Mi huerto ‚Äì tarjetas de cultivos */

    .cultivos-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 4px;
    }

    .cultivo-card {
      border-radius: var(--radius-lg);
      padding: 10px 11px;
      background: radial-gradient(circle at top left, var(--card-soft) 0, #020617 60%);
      border: 1px solid rgba(75,85,99,0.9);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .cultivo-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .cultivo-title {
      font-size: 0.9rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
  /* Miniatura de imagen del cat√°logo */
.cultivo-thumb {
  width: 64px;
  height: 64px;
  border-radius: 18px;
  object-fit: cover;
  flex-shrink: 0;
}

/* Si el nombre es largo, que salte de l√≠nea sin salirse */
.cultivo-title span {
  word-break: break-word;
}
    
    }

    .cultivo-body {
      font-size: 0.78rem;
      color: var(--text-soft);
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 4px 10px;
      margin-top: 4px;
    }

    @media (max-width: 480px) {
      .cultivo-body {
        grid-template-columns: 1fr;
      }
    }

    .cultivo-notas {
      margin-top: 4px;
      font-size: 0.78rem;
      color: #e5e7eb;
    }

    .cultivo-actions {
      margin-top: 6px;
      display: flex;
      justify-content: flex-end;
      gap: 6px;
      flex-wrap: wrap;
    }

    .link-like {
      font-size: 0.78rem;
      color: #4ade80;
      text-decoration: underline;
      cursor: pointer;
    }

    /* Calendario de siembra */

    .calendar-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
    }

    .calendar-item {
      border-radius: 16px;
      padding: 9px 10px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(55,65,81,0.9);
      font-size: 0.8rem;
    }

    .calendar-item-title {
      font-weight: 600;
      margin-bottom: 2px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .calendar-empty {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-top: 8px;
    }

    /* Diario */

    .diario-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 6px;
      font-size: 0.8rem;
    }

    .diario-item {
      border-radius: 14px;
      padding: 8px 10px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(55,65,81,0.9);
  }

    .diario-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 2px;
    }

    /* Plagas / Gu√≠as */

    .media-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 6px;
    }

    .media-item-title {
      font-size: 0.86rem;
      font-weight: 600;
    }

    .media-item-body {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-top: 2px;
    }

    ul {
      margin: 4px 0 4px 18px;
      padding: 0;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    /* FOOTER */

    footer {
      margin-top: 6px;
      font-size: 0.76rem;
      color: var(--text-soft);
      text-align: center;
      padding-bottom: 6px;
    }

    footer span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /* Install button */

    #installBanner {
      position: fixed;
      left: 50%;
      bottom: 16px;
      transform: translateX(-50%);
      background: rgba(15,23,42,0.97);
      border-radius: 999px;
      padding: 7px 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid rgba(148,163,184,0.75);
      box-shadow: 0 16px 40px rgba(15,23,42,0.85);
      font-size: 0.78rem;
      z-index: 80;
    }

    #installBanner.hidden {
      display: none;
    }

    #installBanner button {
      font-size: 0.78rem;
      padding: 6px 10px;
    }
  </style>
</head>

<body>
  <div class="app-shell">
    <!-- HEADER -->
    <header class="app-header">
      <div class="app-header-icon">
        <span>üå±</span>
      </div>
      <div class="app-header-text">
        <div class="app-title-row">
          <div class="app-title">Mi Siembra Inteligente</div>
          <div class="app-tag">v17 ¬∑ PWA</div>
        </div>
        <div class="app-subtitle" id="appSubtitle">
          <!-- Se rellena desde JS -->
        </div>
      </div>
    </header>

    <!-- NAV -->
    <nav class="nav">
      <button class="nav-btn nav-btn--active" data-section="inicio">
        <span class="nav-icon">üè†</span>
        <span class="nav-label">Inicio</span>
      </button>
      <button class="nav-btn" data-section="calendario">
        <span class="nav-icon">üìÖ</span>
        <span class="nav-label">Calendario</span>
      </button>
      <button class="nav-btn" data-section="catalogo">
        <span class="nav-icon">üå±</span>
        <span class="nav-label">Cat√°logo</span>
      </button>
      <button class="nav-btn" data-section="huerto">
        <span class="nav-icon">üåø</span>
        <span class="nav-label">Mi huerto</span>
      </button>
      <button class="nav-btn" data-section="diario">
        <span class="nav-icon">üìì</span>
        <span class="nav-label">Diario</span>
      </button>
      <button class="nav-btn" data-section="plagas">
        <span class="nav-icon">üêõ</span>
        <span class="nav-label">Plagas</span>
      </button>
      <button class="nav-btn" data-section="pesticidas">
        <span class="nav-icon">üíß</span>
        <span class="nav-label">Pesticidas</span>
      </button>
      <button class="nav-btn" data-section="opciones">
        <span class="nav-icon">‚öôÔ∏è</span>
        <span class="nav-label">Opciones</span>
      </button>
      <button class="nav-btn" data-section="guias">
        <span class="nav-icon">üìö</span>
        <span class="nav-label">Gu√≠as</span>
      </button>
    </nav>

    <main>
      <!-- INICIO -->
      <section id="section-inicio" class="section section--active">
        <div class="section-title-row">
          <div class="section-icon-pill">üè†</div>
          <h2>Inicio</h2>
        </div>
        <p class="section-subtitle">
          Resumen r√°pido de tu huerto y acceso a las funciones principales.
        </p>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Estado r√°pido</div>
            <div class="chip badge" id="estadoClimaChip">Clima tropical</div>
          </div>
          <div class="context-chips settings-context"></div>
          <div class="grid-two">
            <div>
              <div class="small-label">Cultivos registrados</div>
              <div class="big-number" id="estadoCultivosCount">0</div>
            </div>
            <div>
              <div class="small-label">Entradas hoy en el diario</div>
              <div class="big-number" id="estadoEntradasCount">0</div>
            </div>
          </div>
          <div class="divider-soft"></div>
          <p class="muted" id="estadoResumen">
            A√∫n no has registrado cultivos. Usa "Mi huerto" para a√±adir tu primera siembra.
          </p>
          <div class="pill-group">
            <button class="btn-secondary btn" id="btnIrMiHuerto">
              <span>üåø</span> Ir a "Mi huerto"
            </button>
            <button class="btn-secondary btn" id="btnIrDiario">
              <span>‚úèÔ∏è</span> Escribir en el diario
            </button>
            <button class="btn-secondary btn" id="btnIrClima">
              <span>‚öôÔ∏è</span> Ajustar clima
            </button>
          </div>
        </div>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Hoy en el calendario</div>
            <div class="chip" id="calendarioClimaChip">Clima tropical</div>
          </div>
          <p class="muted" id="calendarioHoyTexto">
            Usa el calendario de siembra para ver qu√© es recomendable sembrar este mes.
          </p>
          <button class="btn btn-full" id="btnVerCalendario">
            <span>üìÖ</span> Ver calendario de siembra
          </button>
        </div>
      </section>

      <!-- CALENDARIO -->
      <section id="section-calendario" class="section">
        <div class="section-title-row">
          <div class="section-icon-pill">üìÖ</div>
          <h2>Calendario de siembra</h2>
        </div>
        <p class="section-subtitle">
          Selecciona un mes para ver sugerencias de cultivos seg√∫n tu clima actual.
          Son recomendaciones generales; aj√∫stalas a tu experiencia local.
        </p>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Meses del a√±o</div>
            <div class="chip" id="calendarioClimaChip2">Clima tropical</div>
          </div>
          <div class="context-chips settings-context"></div>

          <div class="pill-group" id="mesesPills">
            <button class="pill" data-mes="0">Ene</button>
            <button class="pill" data-mes="1">Feb</button>
            <button class="pill" data-mes="2">Mar</button>
            <button class="pill" data-mes="3">Abr</button>
            <button class="pill" data-mes="4">May</button>
            <button class="pill pill--active" data-mes="5">Jun</button>
            <button class="pill" data-mes="6">Jul</button>
            <button class="pill" data-mes="7">Ago</button>
            <button class="pill" data-mes="8">Sep</button>
            <button class="pill" data-mes="9">Oct</button>
            <button class="pill" data-mes="10">Nov</button>
            <button class="pill" data-mes="11">Dic</button>
          </div>

          <div class="calendar-list" id="calendarList"></div>
          <div class="calendar-empty" id="calendarEmpty" style="display:none;">
            Por ahora no tenemos recomendaciones espec√≠ficas para este mes y clima.
            Puedes usar tu experiencia local o guiarte por cultivos similares.
          </div>
        </div>
      </section>

      <!-- CATALOGO -->
      <section id="section-catalogo" class="section">
        <div class="section-title-row">
          <div class="section-icon-pill">üå±</div>
          <h2>Cat√°logo de cultivos</h2>
        </div>
        <p class="section-subtitle">
          Lista de cultivos con informaci√≥n r√°pida de luz, riego, tiempo de cosecha,
          tama√±o de tiesto y plagas m√°s frecuentes.
        </p>

        <div class="app-card">
          <div class="field">
            <label for="catalogoBusqueda">Buscar cultivo</label>
            <input
              type="text"
              id="catalogoBusqueda"
              placeholder="Ej. tomate, lechuga, pl√°tano..."
            />
          </div>
          <div class="cultivos-list" id="catalogoList"></div>
        </div>
      </section>

      <!-- MI HUERTO -->
      <section id="section-huerto" class="section">
        <div class="section-title-row">
          <div class="section-icon-pill">üåø</div>
          <h2>Mi huerto</h2>
        </div>
        <p class="section-subtitle">
          Registra tus cultivos y consulta los detalles de cada planta.
        </p>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Nuevo cultivo</div>
            <div class="chip badge">Registro r√°pido</div>
          </div>
          <div class="context-chips settings-context"></div>

          <div class="form-grid form-grid--2">
            <div class="field">
              <label for="cultivoNombre">Nombre del cultivo *</label>
              <input type="text" id="cultivoNombre" placeholder="Ej. Tomate, lechuga, pl√°tano" />
            </div>
            <div class="field">
              <label for="cultivoVariedad">Variedad (opcional)</label>
              <input type="text" id="cultivoVariedad" placeholder="Ej. Cherry, romana, etc." />
            </div>
          </div>

          <div class="form-grid form-grid--2">
            <div class="field">
              <label for="cultivoTipo">Tipo</label>
              <select id="cultivoTipo">
                <option value="hoja">Hoja</option>
                <option value="fruto">Fruto</option>
                <option value="raiz">Ra√≠z</option>
                <option value="tuberculo">Tub√©rculo</option>
                <option value="aromaticas">Arom√°ticas</option>
                <option value="otro">Otro</option>
              </select>
            </div>
            <div class="field">
              <label for="cultivoFecha">Fecha de siembra</label>
              <input type="date" id="cultivoFecha" />
            </div>
          </div>

          <div class="field">
            <label for="cultivoNotas">Notas (lugar, cama, maceta, etc.)</label>
            <textarea id="cultivoNotas" placeholder="Ej. Cama 1, fila 2. Semilla directa en suelo."></textarea>
          </div>

          <button class="btn btn-full" id="btnAgregarCultivo">
            <span>‚ûï</span> Guardar cultivo
          </button>
          <p class="muted" style="margin-top:6px;">
            * Solo el nombre es obligatorio. Puedes editar o eliminar los cultivos luego.
          </p>
        </div>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Cultivos registrados</div>
            <div class="chip" id="cultivosCountChip">0 cultivos</div>
          </div>
          <div class="cultivos-list" id="cultivosList"></div>
        </div>
      </section>

      <!-- DIARIO -->
      <section id="section-diario" class="section">
        <div class="section-title-row">
          <div class="section-icon-pill">üìì</div>
          <h2>Diario de huerto</h2>
        </div>
        <p class="section-subtitle">
          Anota riegos, abonados, podas o cualquier evento importante de tu huerto.
        </p>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Nueva entrada</div>
            <div class="chip badge">Hoy</div>
          </div>
          <div class="field">
            <label for="diarioTexto">¬øQu√© hiciste hoy?</label>
            <textarea id="diarioTexto" placeholder="Ej. Regu√© tomates y lechugas. Apliqu√© compost a las arom√°ticas."></textarea>
          </div>
          <button class="btn btn-full" id="btnGuardarDiario">
            <span>üíæ</span> Guardar en el diario
          </button>
        </div>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Entradas recientes</div>
            <div class="chip" id="diarioCountChip">0 entradas</div>
          </div>
          <div class="diario-list" id="diarioList"></div>
        </div>
      </section>

      <!-- PLAGAS -->
      <section id="section-plagas" class="section">
        <div class="section-title-row">
          <div class="section-icon-pill">üêõ</div>
          <h2>Plagas comunes</h2>
        </div>
        <p class="section-subtitle">
          Referencia r√°pida de plagas frecuentes en huertos caseros y c√≥mo manejarlas
          de forma responsable.
        </p>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Cat√°logo b√°sico de plagas</div>
            <div class="chip">Referencia</div>
          </div>
          <div class="media-list" id="plagasList"></div>
        </div>
      </section>

      <!-- PESTICIDAS -->
      <section id="section-pesticidas" class="section">
        <div class="section-title-row">
          <div class="section-icon-pill">üíß</div>
          <h2>Pesticidas y preparados</h2>
        </div>
        <p class="section-subtitle">
          Opciones suaves y de bajo impacto para manejar plagas en un huerto casero.
          Siempre respeta las indicaciones de seguridad.
        </p>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Preparados sugeridos</div>
            <div class="chip">Uso responsable</div>
          </div>
          <div class="media-list" id="pesticidasList"></div>
        </div>
      </section>

      <!-- OPCIONES -->
      <section id="section-opciones" class="section">
        <div class="section-title-row">
          <div class="section-icon-pill">‚öôÔ∏è</div>
          <h2>Opciones</h2>
        </div>
        <p class="section-subtitle">
          Ajusta el nombre de tu huerto, el clima y el hemisferio. Estos datos
          actualizan el calendario y los textos de la aplicaci√≥n.
        </p>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Datos generales</div>
          </div>
          <div class="context-chips settings-context"></div>

          <div class="form-grid">
            <div class="field">
              <label for="nombreHuerto">Nombre de huerto</label>
              <input type="text" id="nombreHuerto" placeholder="Ej. Huerto RDG, Mi huerto, etc." />
            </div>
          </div>

          <div class="form-grid form-grid--2">
            <div class="field">
              <label for="climaSelect">Clima principal</label>
              <select id="climaSelect">
                <option value="tropical">Tropical (Caribe, PR, etc.)</option>
                <option value="subtropical">Subtropical / templado suave</option>
                <option value="templado">Templado / fr√≠o</option>
              </select>
            </div>
            <div class="field">
              <label for="hemisferioSelect">Hemisferio</label>
              <select id="hemisferioSelect">
                <option value="norte">Hemisferio norte</option>
                <option value="sur">Hemisferio sur</option>
              </select>
            </div>
          </div>

          <button class="btn btn-full" id="btnGuardarConfig">
            <span>üíæ</span> Guardar configuraci√≥n
          </button>

          <div class="divider-soft"></div>
          <p class="muted">
            Toda la informaci√≥n se guarda <strong>solo en tu dispositivo</strong> usando almacenamiento local.
            Puedes exportar los datos como texto para tener una copia de seguridad.
          </p>

          <div class="pill-group">
            <button class="btn-secondary btn" id="btnExportar">
              <span>üì§</span> Exportar datos (texto)
            </button>
            <button class="btn-secondary btn" id="btnImportar">
              <span>üì•</span> Importar datos (texto)
            </button>
            <button class="btn-danger btn" id="btnBorrarTodo">
              <span>üßπ</span> Borrar todo
            </button>
          </div>
        </div>
      </section>

      <!-- GUIAS -->
      <section id="section-guias" class="section">
        <div class="section-title-row">
          <div class="section-icon-pill">üìö</div>
          <h2>Gu√≠as r√°pidas</h2>
        </div>
        <p class="section-subtitle">
          Consejos b√°sicos para sacar m√°s provecho a tu huerto, sin reemplazar la
          experiencia de campo ni el consejo de especialistas.
        </p>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Antes de sembrar</div>
            <div class="chip">Paso 1</div>
          </div>
          <div class="media-list">
            <div>
              <div class="media-item-title">Preparar el suelo</div>
              <div class="media-item-body">
                Retira piedras y ra√≠ces gruesas, agrega materia org√°nica (compost, esti√©rcol bien
                descompuesto) y afloja la tierra sin voltearla en exceso para cuidar la vida
                del suelo.
              </div>
            </div>
            <div>
              <div class="media-item-title">Elegir el lugar</div>
              <div class="media-item-body">
                La mayor√≠a de los cultivos necesitan al menos 4‚Äì6 horas de sol directo. Observa
                tu patio o balc√≥n un d√≠a completo y elige las zonas con mejor iluminaci√≥n.
              </div>
            </div>
          </div>
        </div>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Riego inteligente</div>
            <div class="chip">Paso 2</div>
          </div>
          <div class="media-list">
            <div>
              <div class="media-item-title">Revisar la humedad</div>
              <div class="media-item-body">
                Antes de regar, introduce un dedo en el sustrato hasta 2‚Äì3&nbsp;cm. Si est√° h√∫medo,
                espera. Si est√° seco, riega de forma lenta y profunda.
              </div>
            </div>
            <div>
              <div class="media-item-title">Horario recomendado</div>
              <div class="media-item-body">
                En climas c√°lidos suele ser mejor regar temprano en la ma√±ana o al final de la
                tarde para reducir evaporaci√≥n y estr√©s en las plantas.
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <span>Mi Siembra Inteligente ¬∑ Datos guardados localmente en tu dispositivo üåø</span>
    </footer>
  </div>

  <!-- Banner instalar PWA -->
  <div id="installBanner" class="hidden">
    <span>Instala <strong>Mi Siembra Inteligente</strong> en tu dispositivo</span>
    <button class="btn btn-secondary" id="btnInstalarPwa">
      <span>üì≤</span> Instalar
    </button>
  </div>

  <script>
    /*********************
     * Datos y utilidades
     *********************/
    const STORAGE_KEYS = {
      settings: "msi-settings",
      cultivos: "msi-cultivos",
      diario: "msi-diario"
    };

    const DEFAULT_SETTINGS = {
      nombreHuerto: "Mi huerto",
      clima: "tropical", // tropical | subtropical | templado
      hemisferio: "norte" // norte | sur
    };

    const CLIMA_LABEL = {
      tropical: "tropical",
      subtropical: "subtropical/templado",
      templado: "templado/fr√≠o"
    };

    const HEMISFERIO_LABEL = {
      norte: "hemisferio norte",
      sur: "hemisferio sur"
    };

    function loadSettings() {
      try {
        const raw = localStorage.getItem(STORAGE_KEYS.settings);
        if (!raw) return { ...DEFAULT_SETTINGS };
        const parsed = JSON.parse(raw);
        return { ...DEFAULT_SETTINGS, ...parsed };
      } catch {
        return { ...DEFAULT_SETTINGS };
      }
    }

    function saveSettings(settings) {
      localStorage.setItem(STORAGE_KEYS.settings, JSON.stringify(settings));
    }

    function loadCultivos() {
      try {
        const raw = localStorage.getItem(STORAGE_KEYS.cultivos);
        if (!raw) return [];
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      } catch {
        return [];
      }
    }

    function saveCultivos(list) {
      localStorage.setItem(STORAGE_KEYS.cultivos, JSON.stringify(list));
    }

    function loadDiario() {
      try {
        const raw = localStorage.getItem(STORAGE_KEYS.diario);
        if (!raw) return [];
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      } catch {
        return [];
      }
    }

    function saveDiario(list) {
      localStorage.setItem(STORAGE_KEYS.diario, JSON.stringify(list));
    }

    function formatDate(dateStr) {
      if (!dateStr) return "Sin fecha";
      const d = new Date(dateStr + "T00:00:00");
      if (Number.isNaN(d.getTime())) return dateStr;
      const meses = [
        "ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"
      ];
      return `${d.getDate().toString().padStart(2, "0")} ${
        meses[d.getMonth()]
      } ${d.getFullYear()}`;
    }

    function todayISO() {
      const d = new Date();
      return d.toISOString().slice(0, 10);
    }

    /*********************
     * Calendario de siembra
     *********************/
    const CALENDARIO_SIEMBRA = {
      tropical: {
        5: [
          {
            titulo: "Re-siembra de lechugas",
            tipo: "Hoja",
            detalle:
              "Siembra escalonada cada 2‚Äì3 semanas para cosechas continuas."
          },
          {
            titulo: "R√°banos",
            tipo: "Ra√≠z",
            detalle:
              "Cosecha r√°pida (20‚Äì30 d√≠as). Perfectos para ocupar huecos libres."
          }
        ],
        6: [
          {
            titulo: "Berenjena",
            tipo: "Fruto",
            detalle:
              "Le gustan las noches c√°lidas. Ideal para verano tropical."
          },
          {
            titulo: "Aj√≠es y pimientos",
            tipo: "Fruto",
            detalle:
              "Sembrar en lugar soleado y con buen drenaje."
          }
        ]
      },
      subtropical: {
        5: [
          {
            titulo: "Tomates de media estaci√≥n",
            tipo: "Fruto",
            detalle: "Elige variedades adaptadas a tu regi√≥n."
          }
        ]
      },
      templado: {
        2: [
          {
            titulo: "Lechugas de primavera",
            tipo: "Hoja",
            detalle:
              "Siembra temprana bajo protecci√≥n ligera si hay riesgo de heladas."
          }
        ]
      }
    };

    function getCalendarData(settings, monthIndex) {
  const climaKey = settings.clima || "tropical";
  let mes = monthIndex;

  // En climas templado/subtropical del hemisferio sur, invertimos estaci√≥n
  if (settings.hemisferio === "sur" && (climaKey === "templado" || climaKey === "subtropical")) {
    mes = (monthIndex + 6) % 12;
  }

  const base = CALENDARIO_SIEMBRA[climaKey] || {};
  return base[mes] || [];
    }

    /*********************
     * Cat√°logo de cultivos
     *********************/
    const CATALOGO_CULTIVOS = [
  // 1. Tomate
  {
    id: "tomate",
    nombre: "Tomate",
    categoria: "Fruto",
    dias: "70‚Äì90 d√≠as",
    luz: "Sol directo (6‚Äì8 h)",
    riego: "Regular, sin encharcar",
    tiesto: "Macetas profundas de 5+ galones",
    profundidad: "0.5‚Äì1 cm",
    plagas: ["Pulgones", "Mosca blanca", "Orugas"],
    meses: [0, 1, 2, 3, 4, 5, 6, 7],
    imagen: "img/tomate.jpg"
  },

  // 2. Lechuga
  {
    id: "lechuga",
    nombre: "Lechuga",
    categoria: "Hoja",
    dias: "45‚Äì60 d√≠as",
    luz: "Sol suave o sombra parcial",
    riego: "Suelo siempre ligeramente h√∫medo",
    tiesto: "Macetas anchas de 3+ galones",
    profundidad: "0.5 cm",
    plagas: ["Babosas", "Caracoles", "Pulgones"],
    meses: [0, 1, 2, 3, 8, 9, 10, 11],
    imagen: "img/lechuga.jpg"
  },

  // 3. Pepinillo / Pepino
  {
    id: "pepinillo",
    nombre: "Pepinillo / Pepino",
    categoria: "Fruto",
    dias: "60‚Äì90 d√≠as",
    luz: "Sol directo",
    riego: "Abundante y constante",
    tiesto: "Macetas profundas de 5+ galones con tutor",
    profundidad: "1‚Äì2 cm",
    plagas: ["Mosca blanca", "√Åcaros", "Hongos"],
    meses: [3, 4, 5, 6, 7, 8],
    imagen: "img/pepinillo.jpg"
  },

  // 4. Pl√°tano
  {
    id: "platano",
    nombre: "Pl√°tano",
    categoria: "Fruto perenne",
    dias: "Cosecha a partir de 9‚Äì12 meses",
    luz: "Sol directo",
    riego: "Regular, le gusta la humedad",
    tiesto: "Suelo directo, espacio amplio",
    profundidad: "Cormo enterrado firmemente",
    plagas: ["Picudo del pl√°tano", "Sigatoka"],
    meses: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    imagen: "img/platano.jpg"
  },

  // 5. Pimiento morron
  {
    id: "pimiento_morron",
    nombre: "Pimiento morron",
    categoria: "Fruto",
    dias: "80‚Äì100 d√≠as",
    luz: "Sol directo (6‚Äì8 h)",
    riego: "Regular, evitando encharcamientos",
    tiesto: "Macetas de 4‚Äì5 galones",
    profundidad: "0.5 cm",
    plagas: ["Pulgones", "Trips", "Ara√±a roja"],
    meses: [2, 3, 4, 5, 6, 7],
    imagen: "img/pimiento_morron.jpg"
  },

  // 6. Aj√≠
  {
    id: "aji",
    nombre: "Aj√≠",
    categoria: "Fruto",
    dias: "90‚Äì110 d√≠as",
    luz: "Sol directo",
    riego: "Moderado, prefiere suelos bien drenados",
    tiesto: "Macetas de 4‚Äì5 galones",
    profundidad: "0.5 cm",
    plagas: ["Pulgones", "Mosca blanca"],
    meses: [2, 3, 4, 5, 6, 7],
    imagen: "img/aji.jpg"
  },

  // 7. Berenjena
  {
    id: "berenjena",
    nombre: "Berenjena",
    categoria: "Fruto",
    dias: "80‚Äì100 d√≠as",
    luz: "Sol directo",
    riego: "Constante, sin encharcar",
    tiesto: "Macetas de 5+ galones",
    profundidad: "0.5‚Äì1 cm",
    plagas: ["Escarabajos", "Pulgones", "Ara√±a roja"],
    meses: [3, 4, 5, 6, 7, 8],
    imagen: "img/berenjena.jpg"
  },

  // 8. Cebolla
  {
    id: "cebolla",
    nombre: "Cebolla",
    categoria: "Bulbo",
    dias: "100‚Äì150 d√≠as",
    luz: "Sol directo",
    riego: "Moderado, reducir antes de cosechar",
    tiesto: "Macetas profundas o suelo directo",
    profundidad: "1‚Äì2 cm",
    plagas: ["Trips", "Mosca de la cebolla"],
    meses: [0, 1, 2, 6, 7, 8, 9, 10],
    imagen: "img/cebolla.jpg"
  },

  // 9. Cebolleta / ceboll√≠n
  {
    id: "cebollin",
    nombre: "Ceboll√≠n / Cebolleta",
    categoria: "Bulbo",
    dias: "60‚Äì90 d√≠as",
    luz: "Sol directo o media sombra",
    riego: "Regular, sin encharcar",
    tiesto: "Macetas de 3+ galones",
    profundidad: "1 cm",
    plagas: ["Trips"],
    meses: [0, 1, 2, 3, 4, 8, 9, 10, 11],
    imagen: "img/cebollin.jpg"
  },

  // 10. Zanahoria
  {
    id: "zanahoria",
    nombre: "Zanahoria",
    categoria: "Ra√≠z",
    dias: "70‚Äì100 d√≠as",
    luz: "Sol directo",
    riego: "Suelo siempre ligeramente h√∫medo",
    tiesto: "Macetas profundas (30+ cm)",
    profundidad: "0.5‚Äì1 cm",
    plagas: ["Mosca de la zanahoria", "Hongos"],
    meses: [0, 1, 2, 3, 8, 9, 10, 11],
    imagen: "img/zanahoria.jpg"
  },

  // 11. R√°bano
  {
    id: "rabano",
    nombre: "R√°bano",
    categoria: "Ra√≠z",
    dias: "25‚Äì35 d√≠as",
    luz: "Sol directo o media sombra",
    riego: "Suelo constantemente h√∫medo",
    tiesto: "Macetas de 3+ galones, algo profundas",
    profundidad: "1 cm",
    plagas: ["Pulguillas", "Babosas"],
    meses: [0, 1, 2, 3, 8, 9, 10, 11],
    imagen: "img/rabano.jpg"
  },

  // 12. Remolacha
  {
    id: "remolacha",
    nombre: "Remolacha",
    categoria: "Ra√≠z",
    dias: "60‚Äì80 d√≠as",
    luz: "Sol directo",
    riego: "Regular, sin encharcar",
    tiesto: "Macetas profundas (25+ cm)",
    profundidad: "1‚Äì2 cm",
    plagas: ["Pulgones"],
    meses: [0, 1, 2, 3, 8, 9, 10, 11],
    imagen: "img/remolacha.jpg"
  },

  // 13. Papa
  {
    id: "papa",
    nombre: "Papa",
    categoria: "Tub√©rculo",
    dias: "90‚Äì120 d√≠as",
    luz: "Sol directo",
    riego: "Regular, sin encharcar",
    tiesto: "Sacos o macetas profundas de 10+ galones",
    profundidad: "Tub√©rculo cubierto con 5‚Äì10 cm de sustrato",
    plagas: ["Escarabajo de la papa", "Hongos"],
    meses: [0, 1, 2, 7, 8, 9],
    imagen: "img/papa.jpg"
  },

  // 14. Batata
  {
    id: "batata",
    nombre: "Batata",
    categoria: "Tub√©rculo",
    dias: "120‚Äì150 d√≠as",
    luz: "Sol directo",
    riego: "Moderado, tolera algo de sequ√≠a",
    tiesto: "Suelo directo o macetas grandes",
    profundidad: "Estacas enterradas 5‚Äì10 cm",
    plagas: ["Gusanos de suelo", "Hongos"],
    meses: [2, 3, 4, 5, 6, 7, 8],
    imagen: "img/batata.jpg"
  },

  // 15. Yuca
  {
    id: "yuca",
    nombre: "Yuca",
    categoria: "Tub√©rculo perenne",
    dias: "8‚Äì12 meses",
    luz: "Sol directo",
    riego: "Poca exigencia, suelo bien drenado",
    tiesto: "Mejor en suelo directo",
    profundidad: "Estacas enterradas 15‚Äì20 cm",
    plagas: ["Mosca blanca", "√Åcaros"],
    meses: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    imagen: "img/yuca.jpg"
  },

  // 16. Ma√≠z
  {
    id: "maiz",
    nombre: "Ma√≠z",
    categoria: "Grano",
    dias: "80‚Äì100 d√≠as",
    luz: "Sol directo",
    riego: "Regular, m√°s constante en floraci√≥n",
    tiesto: "Parterres o contenedores grandes y profundos",
    profundidad: "2‚Äì3 cm",
    plagas: ["Gusanos del ma√≠z", "Pulgones"],
    meses: [2, 3, 4, 5, 6, 7],
    imagen: "img/maiz.jpg"
  },

  // 17. Habichuelas
  {
    id: "habichuelas",
    nombre: "Habichuelas",
    categoria: "Leguminosa",
    dias: "60‚Äì80 d√≠as",
    luz: "Sol directo",
    riego: "Regular, sin encharcar",
    tiesto: "Macetas de 5+ galones con tutor",
    profundidad: "2‚Äì3 cm",
    plagas: ["Pulgones", "Trips"],
    meses: [2, 3, 4, 5, 6, 7],
    imagen: "img/habichuelas.jpg"
  },

  // 18. Habichuela arbustiva
  {
    id: "habichuela_arbustiva",
    nombre: "Habichuela arbustiva",
    categoria: "Leguminosa",
    dias: "55‚Äì70 d√≠as",
    luz: "Sol directo",
    riego: "Regular",
    tiesto: "Macetas de 4‚Äì5 galones",
    profundidad: "2‚Äì3 cm",
    plagas: ["Pulgones", "Trips"],
    meses: [2, 3, 4, 5, 6, 7],
    imagen: "img/habichuela_arbustiva.jpg"
  },

  // 19. Gandules
  {
    id: "gandules",
    nombre: "Gandules",
    categoria: "Leguminosa perenne",
    dias: "4‚Äì6 meses para la primera cosecha",
    luz: "Sol directo",
    riego: "Moderado, resistente a sequ√≠a",
    tiesto: "Suelo directo o macetas muy grandes",
    profundidad: "2‚Äì3 cm",
    plagas: ["Gusanos de vaina", "Pulgones"],
    meses: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    imagen: "img/gandules.jpg"
  },

  // 20. Calabaza
  {
    id: "calabaza",
    nombre: "Calabaza",
    categoria: "Fruto rastrero",
    dias: "90‚Äì130 d√≠as",
    luz: "Sol directo",
    riego: "Regular, le gusta suelo f√©rtil",
    tiesto: "Suelo directo o macetas muy grandes",
    profundidad: "2‚Äì3 cm",
    plagas: ["Barrenador de tallo", "Mosca blanca"],
    meses: [2, 3, 4, 5, 6, 7],
    imagen: "img/calabaza.jpg"
  },

  // 21. Calabac√≠n / zucchini
  {
    id: "calabacin_zucchini",
    nombre: "Calabac√≠n / Zucchini",
    categoria: "Fruto",
    dias: "45‚Äì60 d√≠as",
    luz: "Sol directo",
    riego: "Regular, sin encharcar",
    tiesto: "Macetas de 8+ galones",
    profundidad: "2‚Äì3 cm",
    plagas: ["O√≠dio", "Pulgones"],
    meses: [2, 3, 4, 5, 6, 7],
    imagen: "img/calabacin_zucchini.jpg"
  },

  // 22. Mel√≥n
  {
    id: "melon",
    nombre: "Mel√≥n",
    categoria: "Fruto rastrero",
    dias: "90‚Äì120 d√≠as",
    luz: "Sol directo",
    riego: "Regular, reducir al madurar frutos",
    tiesto: "Suelo directo o macetas grandes",
    profundidad: "2‚Äì3 cm",
    plagas: ["Mosca blanca", "O√≠dio"],
    meses: [3, 4, 5, 6, 7],
    imagen: "img/melon.jpg"
  },

  // 23. Sand√≠a
  {
    id: "sandia",
    nombre: "Sand√≠a",
    categoria: "Fruto rastrero",
    dias: "90‚Äì120 d√≠as",
    luz: "Sol directo fuerte",
    riego: "Abundante al inicio, reducir en madurez",
    tiesto: "Suelo directo o contenedores muy grandes",
    profundidad: "2‚Äì3 cm",
    plagas: ["Mosca blanca", "O√≠dio"],
    meses: [3, 4, 5, 6, 7],
    imagen: "img/sandia.jpg"
  },

  // 24. Espinaca
  {
    id: "espinaca",
    nombre: "Espinaca",
    categoria: "Hoja",
    dias: "40‚Äì60 d√≠as",
    luz: "Sol suave o sombra parcial",
    riego: "Suelo fresco y h√∫medo",
    tiesto: "Macetas de 3+ galones",
    profundidad: "0.5‚Äì1 cm",
    plagas: ["Babosas", "Pulgones"],
    meses: [0, 1, 2, 3, 8, 9, 10, 11],
    imagen: "img/espinaca.jpg"
  },

  // 25. Acelga
  {
    id: "acelga",
    nombre: "Acelga",
    categoria: "Hoja",
    dias: "50‚Äì70 d√≠as",
    luz: "Sol suave o sombra parcial",
    riego: "Regular, sin encharcar",
    tiesto: "Macetas de 4‚Äì5 galones",
    profundidad: "1‚Äì2 cm",
    plagas: ["Babosas", "Caracoles"],
    meses: [0, 1, 2, 3, 8, 9, 10, 11],
    imagen: "img/acelga.jpg"
  },

  // 26. Col rizada 
  {
    id: "col_rizada",
    nombre: "Col rizada",
    categoria: "Hoja",
    dias: "60‚Äì90 d√≠as",
    luz: "Sol directo o media sombra",
    riego: "Regular",
    tiesto: "Macetas de 5+ galones",
    profundidad: "1 cm",
    plagas: ["Orugas", "Pulgones"],
    meses: [0, 1, 2, 3, 8, 9, 10, 11],
    imagen: "img/col_rizada.jpg"
  },

  // 27. Cilantro
  {
    id: "cilantro",
    nombre: "Cilantro",
    categoria: "Arom√°tica",
    dias: "30‚Äì50 d√≠as",
    luz: "Sol suave o sombra parcial",
    riego: "Suelo fresco y h√∫medo",
    tiesto: "Macetas de 3+ galones",
    profundidad: "0.5‚Äì1 cm",
    plagas: ["Pulgones"],
    meses: [0, 1, 2, 3, 8, 9, 10, 11],
    imagen: "img/cilantro.jpg"
  },

  // 28. Perejil
  {
    id: "perejil",
    nombre: "Perejil",
    categoria: "Arom√°tica",
    dias: "70‚Äì90 d√≠as",
    luz: "Sol suave o sombra parcial",
    riego: "Regular",
    tiesto: "Macetas de 3+ galones",
    profundidad: "0.5‚Äì1 cm",
    plagas: ["Pulgones"],
    meses: [0, 1, 2, 3, 4, 8, 9, 10, 11],
    imagen: "img/perejil.jpg"
  },

  // 29. Albahaca
  {
    id: "albahaca",
    nombre: "Albahaca",
    categoria: "Arom√°tica",
    dias: "40‚Äì60 d√≠as",
    luz: "Sol directo suave",
    riego: "Suelo ligeramente h√∫medo",
    tiesto: "Macetas de 3+ galones",
    profundidad: "0.5 cm",
    plagas: ["Pulgones", "Mosca blanca"],
    meses: [2, 3, 4, 5, 6, 7, 8],
    imagen: "img/albahaca.jpg"
  },

  // 30. Or√©gano
  {
    id: "oregano",
    nombre: "Or√©gano",
    categoria: "Arom√°tica perenne",
    dias: "Cosecha a partir de 60 d√≠as",
    luz: "Sol directo",
    riego: "Escaso, prefiere suelos secos",
    tiesto: "Macetas de 3+ galones",
    profundidad: "Superficial, esquejes o plantines",
    plagas: ["Muy pocas plagas importantes"],
    meses: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    imagen: "img/oregano.jpg"
  },

  // 31. Menta
  {
    id: "menta",
    nombre: "Menta",
    categoria: "Arom√°tica perenne",
    dias: "Cosecha desde 40‚Äì60 d√≠as",
    luz: "Media sombra o sol suave",
    riego: "Le gusta humedad constante",
    tiesto: "Macetas profundas (mejor aislada, es invasiva)",
    profundidad: "Plantines o esquejes superficiales",
    plagas: ["Pulgones"],
    meses: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    imagen: "img/menta.jpg"
  },

  // 32. Romero
  {
    id: "romero",
    nombre: "Romero",
    categoria: "Arom√°tica perenne",
    dias: "Planta lenta, cosecha continua",
    luz: "Sol directo",
    riego: "Muy poco, prefiere suelos secos",
    tiesto: "Macetas de 5+ galones",
    profundidad: "Esquejes o plantines superficiales",
    plagas: ["Pocas plagas, a veces cochinilla"],
    meses: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    imagen: "img/romero.jpg"
  },

  // 33. Tomillo
  {
    id: "tomillo",
    nombre: "Tomillo",
    categoria: "Arom√°tica perenne",
    dias: "Cosecha desde 60 d√≠as",
    luz: "Sol directo",
    riego: "Escaso",
    tiesto: "Macetas peque√±as o medianas",
    profundidad: "Semilla muy superficial o plantines",
    plagas: ["Muy poco susceptible"],
    meses: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    imagen: "img/tomillo.jpg"
  },

  // 34. Fresa
  {
    id: "fresa",
    nombre: "Fresa",
    categoria: "Fruto",
    dias: "4‚Äì6 meses desde plant√≠n",
    luz: "Sol directo suave",
    riego: "Regular, le gusta el sustrato h√∫medo",
    tiesto: "Jardineras o macetas colgantes",
    profundidad: "Plantines al nivel del cuello",
    plagas: ["Babosas", "Hongos"],
    meses: [0, 1, 2, 3, 8, 9, 10, 11],
    imagen: "img/fresa.jpg"
  },

  // 35. Papaya
  {
    id: "papaya",
    nombre: "Papaya",
    categoria: "Frutal",
    dias: "9‚Äì14 meses hasta la primera cosecha",
    luz: "Sol directo",
    riego: "Regular, suelo bien drenado",
    tiesto: "Mejor en suelo directo",
    profundidad: "Semillas superficiales, luego trasplante",
    plagas: ["Mosca de la fruta", "Hongos"],
    meses: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    imagen: "img/papaya.jpg"
  },

  // 36. Guayaba
  {
    id: "guayaba",
    nombre: "Guayaba",
    categoria: "Frutal perenne",
    dias: "18‚Äì24 meses desde plant√≠n",
    luz: "Sol directo",
    riego: "Moderado, tolera algo de sequ√≠a",
    tiesto: "Mejor suelo directo, puede ir en macet√≥n",
    profundidad: "Plant√≠n al nivel del cuello",
    plagas: ["Mosca de la fruta"],
    meses: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    imagen: "img/guayaba.jpg"
  },

  // 37. Parcha
  {
    id: "parcha",
    nombre: "Parcha",
    categoria: "Frutal trepador",
    dias: "8‚Äì12 meses",
    luz: "Sol directo",
    riego: "Regular, suelo f√©rtil",
    tiesto: "Suelo directo con enredadera",
    profundidad: "Plantines al nivel del cuello",
    plagas: ["Mosca de la fruta", "√Åcaros"],
    meses: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    imagen: "img/parcha.jpg"
  },

  // 38. Mango
  {
    id: "mango",
    nombre: "Mango",
    categoria: "Frutal perenne",
    dias: "Varios a√±os hasta producir (dependiendo del tama√±o del plant√≠n)",
    luz: "Sol directo fuerte",
    riego: "Poco una vez establecido",
    tiesto: "Suelo directo; en macet√≥n solo variedades enanas",
    profundidad: "Plant√≠n al nivel del cuello",
    plagas: ["Mosca de la fruta", "Hongos"],
    meses: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    imagen: "img/mango.jpg"
  },

  // 39. Lim√≥n
  {
    id: "limon",
    nombre: "Lim√≥n",
    categoria: "Frutal c√≠trico",
    dias: "2‚Äì3 a√±os desde plant√≠n",
    luz: "Sol directo",
    riego: "Regular en sequ√≠a",
    tiesto: "Macet√≥n grande o suelo directo",
    profundidad: "Plant√≠n al nivel del cuello",
    plagas: ["Minador de hoja", "Cochinillas"],
    meses: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    imagen: "img/limon.jpg"
  },

  // 40. Caf√©
  {
    id: "cafe",
    nombre: "Caf√©",
    categoria: "Perene",
    dias: "2‚Äì3 a√±os hasta la primera cosecha",
    luz: "Sombra parcial (bajo √°rboles) o sol suave",
    riego: "Regular, no encharcar",
    tiesto: "Macetones profundos o suelo directo",
    profundidad: "Plantines al nivel del cuello",
    plagas: ["Broca del caf√©", "Hongos"],
    meses: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    imagen: "img/cafe.jpg"
  },
  // 41. Ajo
  {
    id: "ajo",
    nombre: "Ajo",
    categoria: "Bulbo",
    dias: "120‚Äì180 d√≠as",
    luz: "Sol directo",
    riego: "Moderado, sin encharcar",
    tiesto: "Macetas profundas o suelo directo",
    profundidad: "2‚Äì3 cm",
    plagas: ["Trips", "Mosca de la cebolla"],
    meses: [0, 1, 2, 6, 7, 8, 9, 10],
    imagen: "img/ajo.jpg"
  },

  // 42. Pimiento (gen√©rico)
  {
    id: "pimiento",
    nombre: "Pimiento",
    categoria: "Fruto",
    dias: "75‚Äì95 d√≠as",
    luz: "Sol directo (6‚Äì8 h)",
    riego: "Regular, evitando encharcamientos",
    tiesto: "Macetas de 4‚Äì5 galones",
    profundidad: "0.5 cm",
    plagas: ["Pulgones", "Trips", "Ara√±a roja"],
    meses: [2, 3, 4, 5, 6, 7],
    imagen: "img/pimiento.jpg"
  },

  // 43. Br√≥coli
  {
    id: "broccoli",
    nombre: "Br√≥coli",
    categoria: "Br√°sica",
    dias: "80‚Äì100 d√≠as",
    luz: "Sol directo suave",
    riego: "Suelo siempre ligeramente h√∫medo",
    tiesto: "Macetas profundas de 5+ galones",
    profundidad: "0.5‚Äì1 cm",
    plagas: ["Orugas", "Pulgones", "Babosas"],
    meses: [0, 1, 2, 3, 8, 9, 10, 11],
    imagen: "img/broccoli.jpg"
  },

  // 44. China (naranja)
  {
    id: "china",
    nombre: "China (naranja)",
    categoria: "Frutal c√≠trico",
    dias: "2‚Äì3 a√±os desde plant√≠n",
    luz: "Sol directo",
    riego: "Regular en √©poca seca",
    tiesto: "Macet√≥n grande o suelo directo",
    profundidad: "Plant√≠n al nivel del cuello",
    plagas: ["Minador de hoja", "Cochinillas", "Mosca de la fruta"],
    meses: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    imagen: "img/china.jpg"
  },

  // 45. Coliflor
  {
    id: "coliflor",
    nombre: "Coliflor",
    categoria: "Br√°sica",
    dias: "80‚Äì110 d√≠as",
    luz: "Sol directo suave o media sombra",
    riego: "Suelo siempre ligeramente h√∫medo",
    tiesto: "Macetas profundas de 5+ galones o suelo directo",
    profundidad: "0.5‚Äì1 cm",
    plagas: ["Pulgones", "Caracoles"],
    meses: [0, 1, 2, 3, 8, 9, 10, 11],
    imagen: "img/coliflor.jpg"
  },

  // 48. Quimbomb√≥ (okra)
  {
    id: "quimbombo",
    nombre: "Quimbomb√≥ / Okra",
    categoria: "Fruto",
    dias: "60‚Äì80 d√≠as",
    luz: "Sol directo fuerte",
    riego: "Moderado, tolera algo de sequ√≠a",
    tiesto: "Macetas de 5+ galones o suelo directo",
    profundidad: "2‚Äì3 cm",
    plagas: ["Pulgones", "Trips", "√Åcaros"],
    meses: [2, 3, 4, 5, 6, 7, 8],
    imagen: "img/quimbombo.jpg"
  }
]
    /*********************
     * Estado global
     *********************/
    let stateSettings = loadSettings();
    let stateCultivos = loadCultivos();
    let stateDiario = loadDiario();

    /*********************
     * Render de UI (header, chips, etc.)
     *********************/
    function updateHeader() {
      const subtitleEl = document.getElementById("appSubtitle");
      const nombre = stateSettings.nombreHuerto || "Mi huerto";
      const clima = CLIMA_LABEL[stateSettings.clima] || CLIMA_LABEL.tropical;
      const hemis = HEMISFERIO_LABEL[stateSettings.hemisferio] || HEMISFERIO_LABEL.norte;

      subtitleEl.innerHTML = `
        <span>Huerto "<strong>${nombre}</strong>"</span>
        <span class="app-subtitle-dot"></span>
        <span>clima ${clima}</span>
        <span class="app-subtitle-dot"></span>
        <span>${hemis}</span>
      `;
    }

    function updateSettingsContexts() {
      const nombre = stateSettings.nombreHuerto || "Mi huerto";
      const clima = CLIMA_LABEL[stateSettings.clima] || CLIMA_LABEL.tropical;
      const hemis = HEMISFERIO_LABEL[stateSettings.hemisferio] || HEMISFERIO_LABEL.norte;

      document.querySelectorAll(".settings-context").forEach(el => {
        el.innerHTML = `
          <span class="chip"><span>üåø</span> Huerto: ${nombre}</span>
          <span class="chip"><span>‚òÅÔ∏è</span> Clima: ${clima}</span>
          <span class="chip"><span>üß≠</span> ${hemis}</span>
        `;
      });

      const climaText = `Clima ${clima}`;
      const estadoClimaChip = document.getElementById("estadoClimaChip");
      if (estadoClimaChip) estadoClimaChip.textContent = climaText;
      const calChip = document.getElementById("calendarioClimaChip");
      if (calChip) calChip.textContent = climaText;
      const calChip2 = document.getElementById("calendarioClimaChip2");
      if (calChip2) calChip2.textContent = climaText;
    }

    function renderInicio() {
      const cultivos = stateCultivos;
      const diario = stateDiario;
      const cultivosCount = cultivos.length;
      const today = todayISO();

      const entradasHoy = diario.filter(e => e.fecha === today).length;

      document.getElementById("estadoCultivosCount").textContent =
        cultivosCount.toString();
      document.getElementById("estadoEntradasCount").textContent =
        entradasHoy.toString();

      const resumen = document.getElementById("estadoResumen");
      const nombre = stateSettings.nombreHuerto || "tu huerto";

      if (!cultivosCount && !entradasHoy) {
        resumen.textContent =
          'Todav√≠a no has registrado cultivos ni entradas en el diario. Empieza a√±adiendo tu primer cultivo en "Mi huerto".';
      } else if (cultivosCount && !entradasHoy) {
        resumen.textContent = `Tienes ${cultivosCount} cultivo(s) registrado(s) en ${nombre}. A√∫n no has escrito nada en el diario hoy.`;
      } else if (cultivosCount && entradasHoy) {
        resumen.textContent = `Llevas ${cultivosCount} cultivo(s) activo(s) y ya registraste ${entradasHoy} nota(s) en el diario hoy. ¬°Buen trabajo!`;
      } else {
        resumen.textContent =
          'Tienes anotaciones en el diario pero a√∫n no has a√±adido cultivos. Usa "Mi huerto" para registrar lo que est√°s sembrando.';
      }

      // Calendario "hoy" (usa mes actual)
      const now = new Date();
      const monthIndex = now.getMonth();
      const data = getCalendarData(stateSettings, monthIndex);
      const calHoyTexto = document.getElementById("calendarioHoyTexto");

      if (data.length === 0) {
        calHoyTexto.textContent = `En ${nombre} no hay recomendaciones espec√≠ficas para este mes con el clima actual, pero puedes consultar los dem√°s meses en el calendario.`;
      } else {
        const nombres = data.map(d => d.titulo).join(", ");
        calHoyTexto.textContent = `Para este mes se sugieren cultivos como: ${nombres}. Revisa el calendario para ver el detalle.`;
      }
    }

    function renderCultivos() {
      const listEl = document.getElementById("cultivosList");
      const chip = document.getElementById("cultivosCountChip");
      if (!listEl) return;

      const count = stateCultivos.length;
      if (chip) chip.textContent = `${count} cultivo${count === 1 ? "" : "s"}`;

      if (!count) {
        listEl.innerHTML =
          '<p class="muted">Todav√≠a no has registrado cultivos. Usa el formulario de arriba para a√±adir tu primera siembra.</p>';
        return;
      }

      listEl.innerHTML = "";
      stateCultivos.forEach(c => {
        const card = document.createElement("div");
        card.className = "cultivo-card";

        const tipoLabelMap = {
          hoja: "Hoja",
          fruto: "Fruto",
          raiz: "Ra√≠z",
          tuberculo: "Tub√©rculo",
          aromaticas: "Arom√°ticas",
          otro: "Otro"
        };
        const tipoLabel = tipoLabelMap[c.tipo] || "Otro";

        card.innerHTML = `
          <div class="cultivo-header">
            <div class="cultivo-title">
              <span>üåø</span>
              <span>${c.nombre}</span>
            </div>
            <span class="chip">${tipoLabel}</span>
          </div>
          <div class="cultivo-body">
            <div><strong>Variedad:</strong> ${c.variedad || "Sin especificar"}</div>
            <div><strong>Fecha de siembra:</strong> ${formatDate(
              c.fechaSiembra
            )}</div>
            <div><strong>Ubicaci√≥n / notas cortas:</strong> ${
              c.notas ? c.notas.slice(0, 140) : "‚Äî"
            }</div>
            <div><strong>Registro creado:</strong> ${formatDate(c.creadoEl)}</div>
          </div>
          ${
            c.notas
              ? `<div class="cultivo-notas"><strong>Notas:</strong> ${c.notas}</div>`
              : ""
          }
          <div class="cultivo-actions">
            <button class="btn-secondary btn" data-id="${c.id}" data-action="nota">‚úèÔ∏è A√±adir nota en diario</button>
            <button class="btn-danger btn" data-id="${c.id}" data-action="borrar">üóë Eliminar</button>
          </div>
        `;

        listEl.appendChild(card);
      });
    }

    /*********************
     * Calendario (con cat√°logo)
     *********************/
    function renderCalendario(monthIndex = 5) {
      const listEl = document.getElementById("calendarList");
      const emptyEl = document.getElementById("calendarEmpty");
      if (!listEl || !emptyEl) return;

      const data = getCalendarData(stateSettings, monthIndex);

      listEl.innerHTML = "";

      // 1) Texto b√°sico de calendario
      if (data.length) {
        emptyEl.style.display = "none";

        data.forEach(item => {
          const div = document.createElement("div");
          div.className = "calendar-item";
          div.innerHTML = `
            <div class="calendar-item-title">
              <span>${item.titulo}</span>
              <span class="chip">${item.tipo}</span>
            </div>
            <div>${item.detalle}</div>
          `;
          listEl.appendChild(div);
        });
      } else {
        emptyEl.style.display = "block";
      }

      // 2) Sugerencias extra desde el cat√°logo
      const sugeridos = CATALOGO_CULTIVOS.filter(
        c => Array.isArray(c.meses) && c.meses.includes(monthIndex)
      );

      if (sugeridos.length) {
        const separador = document.createElement("div");
        separador.className = "divider-soft";
        listEl.appendChild(separador);

        const tituloExtra = document.createElement("p");
        tituloExtra.className = "muted";
        tituloExtra.textContent =
          "Desde el cat√°logo: cultivos recomendados para este mes.";
        listEl.appendChild(tituloExtra);

        sugeridos.forEach(c => {
          const div = document.createElement("div");
          div.className = "calendar-item";
          div.innerHTML = `
            <div class="calendar-item-title">
              <span>${c.nombre}</span>
              <span class="chip">${c.categoria || "Cultivo"}</span>
            </div>
            <div>
              D√≠as a cosecha: ${c.dias}. Luz: ${c.luz}.
              Plagas frecuentes: ${c.plagas.join(", ")}.
            </div>
          `;
          listEl.appendChild(div);
        });
      }
    }

    function renderDiario() {
      const listEl = document.getElementById("diarioList");
      const chip = document.getElementById("diarioCountChip");
      if (!listEl) return;

      const arr = [...stateDiario].sort((a, b) => b.fecha.localeCompare(a.fecha));
      const count = arr.length;
      if (chip) chip.textContent = `${count} entrada${count === 1 ? "" : "s"}`;

      if (!count) {
        listEl.innerHTML =
          '<p class="muted">A√∫n no hay notas en el diario. Empieza escribiendo qu√© hiciste hoy en el huerto.</p>';
        return;
      }

      listEl.innerHTML = "";
      arr.slice(0, 25).forEach(item => {
        const div = document.createElement("div");
        div.className = "diario-item";
        div.innerHTML = `
          <div class="diario-item-header">
            <strong>${formatDate(item.fecha)}</strong>
            <span class="chip">${item.tipo || "General"}</span>
          </div>
          <div>${item.texto}</div>
        `;
        listEl.appendChild(div);
      });
    }

    function renderPlagas() {
      const listEl = document.getElementById("plagasList");
      if (!listEl) return;

      const plagasData = [
        {
          nombre: "Pulgones",
          detalle:
            "Peque√±os insectos que chupan savia y deforman brotes tiernos. Suelen aparecer en colonias.",
          manejo:
            "Rociar con agua y jab√≥n pot√°sico o preparar extracto de ajo/aj√≠. Favorecer mariquitas y crisopas."
        },
        {
          nombre: "Mosca blanca",
          detalle:
            "Insectos blancos que vuelan al mover la planta. Debilitan hojas y favorecen hongos.",
          manejo:
            "Trampas amarillas, jab√≥n pot√°sico y aceites vegetales suaves respetando dosis."
        },
        {
          nombre: "Orugas",
          detalle:
            "Larvas que comen hojas dejando mordidas grandes o agujeros.",
          manejo:
            "Revisi√≥n manual frecuente, retirar orugas a mano. Bacillus thuringiensis en casos necesarios."
        },
        {
          nombre: "Caracoles y babosas",
          detalle:
            "Suelo h√∫medo y restos de baba plateada cerca de las mordidas.",
          manejo:
            "Refugios-trampa, barreras f√≠sicas y recolecci√≥n manual al atardecer."
        }
      ];

      listEl.innerHTML = "";
      plagasData.forEach(p => {
        const div = document.createElement("div");
        div.innerHTML = `
          <div class="media-item-title">üêõ ${p.nombre}</div>
          <div class="media-item-body"><strong>C√≥mo se ve:</strong> ${p.detalle}</div>
          <div class="media-item-body"><strong>Manejo recomendado:</strong> ${p.manejo}</div>
        `;
        listEl.appendChild(div);
      });
    }

    function renderPesticidas() {
      const listEl = document.getElementById("pesticidasList");
      if (!listEl) return;

      const data = [
        {
          nombre: "Jab√≥n pot√°sico",
          detalle:
            "Eficaz contra pulgones y mosca blanca. Aplicar al atardecer y en hojas, evitando flores abiertas."
        },
        {
          nombre: "Aceite de neem (uso hort√≠cola)",
          detalle:
            "Ayuda a cortar ciclos de varias plagas. Usar con moderaci√≥n y siempre siguiendo etiqueta."
        },
        {
          nombre: "Infusi√≥n de ajo y aj√≠",
          detalle:
            "Preparado casero de olor fuerte que puede repeler insectos suaves y algunos hongos."
        }
      ];

      listEl.innerHTML = "";
      data.forEach(p => {
        const div = document.createElement("div");
        div.innerHTML = `
          <div class="media-item-title">üíß ${p.nombre}</div>
          <div class="media-item-body">${p.detalle}</div>
        `;
        listEl.appendChild(div);
      });
    }

    /*********************
     * Cat√°logo: render + b√∫squeda
     *********************/
    function renderCatalogo(filtroTexto = "") {
      const listEl = document.getElementById("catalogoList");
      if (!listEl) return;

      const filtro = filtroTexto.trim().toLowerCase();
      const lista = CATALOGO_CULTIVOS.filter(c => {
        if (!filtro) return true;
        return (
          c.nombre.toLowerCase().includes(filtro) ||
          c.id.toLowerCase().includes(filtro)
        );
      });

      if (!lista.length) {
        listEl.innerHTML = `<p class="muted">No hay cultivos que coincidan con "${filtroTexto}".</p>`;
        return;
      }

      listEl.innerHTML = "";
      lista.forEach(c => {
        // si no hay imagen, usamos el placeholder
        const imgSrc = c.imagen || "img/placeholder.jpg";   // aseg√∫rate de que este archivo exista

        const card = document.createElement("div");
        card.className = "cultivo-card";
        card.innerHTML = `
          <div class="cultivo-header">
            <div class="cultivo-title">
              <img
                src="${imgSrc}"
                alt="${c.nombre}"
                class="cultivo-thumb"
                onerror="this.onerror=null;this.src='img/placeholder.jpg';"
              />
              <span>üå± ${c.nombre}</span>
            </div>
            <span class="chip">${c.categoria}</span>
          </div>
          <div class="cultivo-body">
            <div><strong>D√≠as a cosecha:</strong> ${c.dias}</div>
            <div><strong>Luz:</strong> ${c.luz}</div>
            <div><strong>Riego:</strong> ${c.riego}</div>
            <div><strong>Tiesto / suelo:</strong> ${c.tiesto}</div>
            <div><strong>Profundidad de siembra:</strong> ${c.profundidad}</div>
            <div><strong>Plagas frecuentes:</strong> ${c.plagas.join(", ")}</div>
          </div>
        `;
        listEl.appendChild(card);
      });
    }

    function setupCatalogo() {
      const input = document.getElementById("catalogoBusqueda");
      if (!input) return;

      input.addEventListener("input", () => {
        renderCatalogo(input.value);
      });
    }

    /*********************
     * Eventos y navegaci√≥n
     *********************/
    function setupNavigation() {
      const navButtons = document.querySelectorAll(".nav-btn");
      navButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const section = btn.getAttribute("data-section");
          if (!section) return;
          // botones activos
          navButtons.forEach(b =>
            b.classList.toggle("nav-btn--active", b === btn)
          );
          // secciones
          document.querySelectorAll(".section").forEach(sec => {
            sec.classList.toggle(
              "section--active",
              sec.id === `section-${section}`
            );
          });
        });
      });

      document.getElementById("btnIrMiHuerto").addEventListener("click", () => {
        document.querySelector('.nav-btn[data-section="huerto"]').click();
      });
      document.getElementById("btnIrDiario").addEventListener("click", () => {
        document.querySelector('.nav-btn[data-section="diario"]').click();
      });
      document.getElementById("btnIrClima").addEventListener("click", () => {
        document.querySelector('.nav-btn[data-section="opciones"]').click();
      });
      document.getElementById("btnVerCalendario").addEventListener("click", () => {
        document.querySelector('.nav-btn[data-section="calendario"]').click();
      });
    }

    function setupMesesPills() {
      const pills = document.querySelectorAll("#mesesPills .pill");
      pills.forEach(p => {
        p.addEventListener("click", () => {
          pills.forEach(other =>
            other.classList.toggle("pill--active", other === p)
          );
          const month = parseInt(p.getAttribute("data-mes"), 10);
          renderCalendario(month);
        });
      });

      // seleccionar mes actual por defecto
      const now = new Date();
      const currentMonth = now.getMonth();
      const target = Array.from(pills).find(
        p => parseInt(p.dataset.mes, 10) === currentMonth
      );
      if (target) target.click();
      else renderCalendario(5);
    }

    function setupMiHuertoForm() {
      const btn = document.getElementById("btnAgregarCultivo");
      btn.addEventListener("click", () => {
        const nombre = document.getElementById("cultivoNombre").value.trim();
        const variedad = document.getElementById("cultivoVariedad").value.trim();
        const tipo = document.getElementById("cultivoTipo").value || "otro";
        const fechaSiembra =
          document.getElementById("cultivoFecha").value || todayISO();
        const notas = document.getElementById("cultivoNotas").value.trim();

        if (!nombre) {
          alert("Por favor escribe al menos el nombre del cultivo.");
          return;
        }

        const nuevo = {
          id: Date.now().toString(36),
          nombre,
          variedad,
          tipo,
          fechaSiembra,
          notas,
          creadoEl: todayISO()
        };

        stateCultivos.push(nuevo);
        saveCultivos(stateCultivos);

        document.getElementById("cultivoNombre").value = "";
        document.getElementById("cultivoVariedad").value = "";
        document.getElementById("cultivoFecha").value = "";
        document.getElementById("cultivoNotas").value = "";

        renderCultivos();
        renderInicio();
        alert("Cultivo guardado.");
      });

      // Delegaci√≥n para botones de cada tarjeta
      document
        .getElementById("cultivosList")
        .addEventListener("click", ev => {
          const btn = ev.target.closest("button[data-id]");
          if (!btn) return;
          const id = btn.getAttribute("data-id");
          const action = btn.getAttribute("data-action");
          const cultivo = stateCultivos.find(c => c.id === id);
          if (!cultivo) return;

          if (action === "borrar") {
            if (confirm(`¬øEliminar el cultivo "${cultivo.nombre}"?`)) {
              stateCultivos = stateCultivos.filter(c => c.id !== id);
              saveCultivos(stateCultivos);
              renderCultivos();
              renderInicio();
            }
          } else if (action === "nota") {
            document.querySelector('.nav-btn[data-section="diario"]').click();
            const campo = document.getElementById("diarioTexto");
            campo.value = `Cultivo: ${cultivo.nombre} (${
              cultivo.variedad || "sin variedad"
            }). `;
            campo.focus();
          }
        });
    }

    function setupDiario() {
      document.getElementById("btnGuardarDiario").addEventListener("click", () => {
        const texto = document.getElementById("diarioTexto").value.trim();
        if (!texto) {
          alert("Escribe algo antes de guardar.");
          return;
        }

        const entrada = {
          fecha: todayISO(),
          texto,
          tipo: "General"
        };
        stateDiario.push(entrada);
        saveDiario(stateDiario);
        document.getElementById("diarioTexto").value = "";
        renderDiario();
        renderInicio();
        alert("Entrada guardada en el diario.");
      });
    }

    function setupOpciones() {
      const nombreInput = document.getElementById("nombreHuerto");
      const climaSelect = document.getElementById("climaSelect");
      const hemisSelect = document.getElementById("hemisferioSelect");

      // Inicializar valores
      nombreInput.value = stateSettings.nombreHuerto || "";
      climaSelect.value = stateSettings.clima || "tropical";
      hemisSelect.value = stateSettings.hemisferio || "norte";

      document.getElementById("btnGuardarConfig").addEventListener("click", () => {
        const nuevoNombre = nombreInput.value.trim() || "Mi huerto";
        const nuevoClima = climaSelect.value || "tropical";
        const nuevoHemis = hemisSelect.value || "norte";

        stateSettings = {
          ...stateSettings,
          nombreHuerto: nuevoNombre,
          clima: nuevoClima,
          hemisferio: nuevoHemis
        };
        saveSettings(stateSettings);
        updateHeader();
        updateSettingsContexts();
        renderInicio();
        renderCalendario(new Date().getMonth());
        alert("Configuraci√≥n guardada.");
      });

      // Exportar/importar/borrar
      document.getElementById("btnExportar").addEventListener("click", () => {
        const exportObj = {
          settings: stateSettings,
          cultivos: stateCultivos,
          diario: stateDiario
        };
        const texto = JSON.stringify(exportObj, null, 2);
        prompt("Copia este texto para guardar una copia de seguridad:", texto);
      });

      document.getElementById("btnImportar").addEventListener("click", () => {
        const texto = prompt("Pega aqu√≠ un backup exportado previamente:");
        if (!texto) return;
        try {
          const data = JSON.parse(texto);
          if (data.settings) {
            stateSettings = { ...DEFAULT_SETTINGS, ...data.settings };
            saveSettings(stateSettings);
          }
          if (Array.isArray(data.cultivos)) {
            stateCultivos = data.cultivos;
            saveCultivos(stateCultivos);
          }
          if (Array.isArray(data.diario)) {
            stateDiario = data.diario;
            saveDiario(stateDiario);
          }
          // Re-render
          nombreInput.value = stateSettings.nombreHuerto || "";
          climaSelect.value = stateSettings.clima || "tropical";
          hemisSelect.value = stateSettings.hemisferio || "norte";
          updateHeader();
          updateSettingsContexts();
          renderCultivos();
          renderDiario();
          renderInicio();
          renderCalendario(new Date().getMonth());
          alert("Datos importados correctamente.");
        } catch (e) {
          alert("El texto no parece un backup v√°lido.");
        }
      });

      document.getElementById("btnBorrarTodo").addEventListener("click", () => {
        if (
          !confirm(
            "Esto borrar√° todos los datos del huerto en este dispositivo. ¬øContinuar?"
          )
        )
          return;
        localStorage.removeItem(STORAGE_KEYS.settings);
        localStorage.removeItem(STORAGE_KEYS.cultivos);
        localStorage.removeItem(STORAGE_KEYS.diario);
        stateSettings = { ...DEFAULT_SETTINGS };
        stateCultivos = [];
        stateDiario = [];
        // Re-render completo
        nombreInput.value = stateSettings.nombreHuerto;
        climaSelect.value = stateSettings.clima;
        hemisSelect.value = stateSettings.hemisferio;
        updateHeader();
        updateSettingsContexts();
        renderCultivos();
        renderDiario();
        renderInicio();
        renderCalendario(new Date().getMonth());
        alert("Datos borrados. Empezar√°s de cero.");
      });
    }

    /*********************
     * PWA: service worker + instalar
     *********************/
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("sw.js")
          .catch(err => console.error("Error registrando SW:", err));
      });
    }

    let deferredPrompt = null;
    const installBanner = document.getElementById("installBanner");
    const installBtn = document.getElementById("btnInstalarPwa");

    window.addEventListener("beforeinstallprompt", e => {
      e.preventDefault();
      deferredPrompt = e;
      installBanner.classList.remove("hidden");
    });

    installBtn.addEventListener("click", async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
      installBanner.classList.add("hidden");
    });

    /*********************
     * Inicio de la app
     *********************/
    document.addEventListener("DOMContentLoaded", () => {
      updateHeader();
      updateSettingsContexts();
      renderCultivos();
      renderDiario();
      renderInicio();
      renderCalendario(new Date().getMonth());
      renderPlagas();
      renderPesticidas();
      renderCatalogo();

      setupNavigation();
      setupMesesPills();
      setupMiHuertoForm();
      setupDiario();
      setupOpciones();
      setupCatalogo();
    });
  </script>
</body>
    </html>
