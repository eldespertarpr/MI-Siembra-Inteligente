<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mi Siembra Inteligente (v17)</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#22c55e" />

  <style>
    :root {
      color-scheme: dark;
      --bg: #020617;
      --bg-elevated: #02081f;
      --card: #02081f;
      --card-soft: #030919;
      --accent: #22c55e;
      --accent-soft: rgba(34,197,94,0.15);
      --accent-strong: rgba(34,197,94,0.45);
      --text-main: #f9fafb;
      --text-soft: #9ca3af;
      --border-subtle: rgba(148,163,184,0.3);
      --danger: #f97373;
      --chip-bg: rgba(15,23,42,0.9);
      --chip-border: rgba(148,163,184,0.4);
      --shadow-soft: 0 18px 45px rgba(15,23,42,0.7);
      --radius-xl: 22px;
      --radius-lg: 18px;
      --radius-full: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Roboto", "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #022c22 0, #020617 55%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .app-shell {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px 12px 28px;
    }

    @media (min-width: 768px) {
      .app-shell {
        padding: 20px 16px 40px;
      }
    }

    /* HEADER */

    .app-header {
      background: radial-gradient(circle at 0 0, #4ade80 0, #16a34a 28%, #052e16 85%);
      border-radius: 28px;
      padding: 18px 18px 16px;
      display: flex;
      align-items: center;
      gap: 14px;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
      margin-bottom: 14px;
    }

    .app-header::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 120% -10%, rgba(34,197,94,0.35) 0, transparent 55%);
      opacity: 0.9;
      pointer-events: none;
    }

    .app-header-icon {
      position: relative;
      z-index: 1;
      width: 52px;
      height: 52px;
      border-radius: 18px;
      background: radial-gradient(circle at 30% 10%, #bbf7d0 0, #16a34a 35%, #052e16 90%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 14px 35px rgba(0,0,0,0.45);
      flex-shrink: 0;
    }

    .app-header-icon span {
      font-size: 32px;
    }

    .app-header-text {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .app-title-row {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .app-title {
      font-size: 1.35rem;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .app-tag {
      font-size: 0.72rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.45);
      border: 1px solid rgba(15,23,42,0.8);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #e5e7eb;
    }

    .app-subtitle {
      font-size: 0.80rem;
      color: #e5e7eb;
      opacity: 0.95;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .app-subtitle span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .app-subtitle-dot {
      width: 3px;
      height: 3px;
      border-radius: 50%;
      background: rgba(226,232,240,0.7);
    }

    /* NAV */

    .nav {
      margin-top: 8px;
      background: linear-gradient(135deg, var(--bg-elevated), #020617);
      border-radius: 26px;
      padding: 10px;
      box-shadow: 0 18px 40px rgba(15,23,42,0.85);
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      position: sticky;
      top: 0;
      z-index: 40;
      backdrop-filter: blur(16px);
      border: 1px solid rgba(15,23,42,0.85);
    }

    @media (min-width: 660px) {
      .nav {
        grid-template-columns: repeat(8, minmax(0,1fr));
      }
    }

    .nav-btn {
      border: none;
      border-radius: 999px;
      padding: 7px 6px 6px;
      font-size: 0.70rem;
      color: var(--text-soft);
      background: transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
      cursor: pointer;
      transition: background 0.18s, color 0.18s, transform 0.12s;
      position: relative;
      min-height: 52px;
    }

    .nav-btn span.nav-icon {
      font-size: 1.1rem;
    }

    .nav-btn span.nav-label {
      line-height: 1.1;
    }

    .nav-btn.nav-btn--active {
      background: radial-gradient(circle at top, var(--accent) 0, var(--accent-soft) 45%, transparent 100%);
      color: #ecfdf5;
      box-shadow: 0 0 0 1px rgba(34,197,94,0.4), 0 14px 30px rgba(22,163,74,0.55);
      transform: translateY(-1px);
    }

    .nav-btn.nav-btn--active::after {
      content: "";
      position: absolute;
      inset: auto auto -3px 50%;
      width: 32%;
      max-width: 42px;
      height: 3px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(34,197,94,0.1), rgba(34,197,94,0.6), rgba(34,197,94,0.1));
      transform: translateX(-50%);
    }

    /* SECTIONS */

    main {
      margin-top: 14px;
    }

    .section {
      display: none;
      animation: fadeIn 0.18s ease-out;
    }

    .section--active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .section > .section-title-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 14px 2px 8px;
    }

    .section-icon-pill {
      width: 26px;
      height: 26px;
      border-radius: 13px;
      background: radial-gradient(circle at 30% 15%, #fefce8 0, #fef9c3 25%, #0f172a 90%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }

    .section-title-row h2 {
      font-size: 1.05rem;
      margin: 0;
    }

    .section-subtitle {
      font-size: 0.82rem;
      color: var(--text-soft);
      margin: 2px 2px 10px;
    }

    .app-card {
      background: radial-gradient(circle at top left, #020617 0, #020617 40%, #02081f 100%);
      border-radius: var(--radius-xl);
      padding: 14px 16px 14px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      margin-bottom: 14px;
    }

    .app-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .app-card-title {
      font-size: 0.96rem;
      font-weight: 600;
    }

    .chip {
      border-radius: var(--radius-full);
      padding: 4px 10px;
      font-size: 0.74rem;
      border: 1px solid var(--chip-border);
      background: var(--chip-bg);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .chip.badge {
      background: rgba(34,197,94,0.12);
      border-color: rgba(34,197,94,0.6);
      color: #bbf7d0;
    }

    .chip-danger {
      border-color: rgba(239,68,68,0.7);
      color: #fecaca;
      background: rgba(127,29,29,0.5);
    }

    .context-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 4px 0 10px;
      font-size: 0.76rem;
      color: var(--text-soft);
    }

    .divider-soft {
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(148,163,184,0.4), transparent);
      margin: 8px -2px 10px;
    }

    .muted {
      color: var(--text-soft);
      font-size: 0.80rem;
    }

    .pill-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 8px -1px 4px;
    }

    .pill {
      border-radius: 999px;
      padding: 5px 12px;
      font-size: 0.78rem;
      border: 1px solid rgba(148,163,184,0.55);
      background: rgba(15,23,42,0.9);
      cursor: pointer;
    }

    .pill--active {
      background: var(--accent-soft);
      border-color: rgba(34,197,94,0.85);
      color: #bbf7d0;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 9px 14px;
      font-size: 0.82rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: linear-gradient(135deg, #16a34a, #22c55e);
      color: #022c22;
      box-shadow: 0 12px 30px rgba(22,163,74,0.55);
      transition: transform 0.12s, box-shadow 0.12s, filter 0.12s;
    }

    .btn span {
      font-size: 1rem;
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 7px 18px rgba(22,163,74,0.55);
      filter: brightness(0.96);
    }

    .btn-secondary {
      background: rgba(15,23,42,0.9);
      color: var(--text-main);
      border: 1px solid var(--border-subtle);
      box-shadow: none;
    }

    .btn-full {
      width: 100%;
      justify-content: center;
    }

    .btn-danger {
      background: linear-gradient(135deg, #b91c1c, #ef4444);
      color: #fee2e2;
      box-shadow: 0 10px 26px rgba(248,113,113,0.45);
    }

    .grid-two {
      display: grid;
      grid-template-columns: repeat(2,minmax(0,1fr));
      gap: 8px;
    }

    .small-label {
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-bottom: 2px;
    }

    .big-number {
      font-size: 1.3rem;
      font-weight: 600;
    }

    /* FORMS */

    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin: 8px 0 4px;
    }

    @media (min-width: 660px) {
      .form-grid--2 {
        grid-template-columns: repeat(2, minmax(0,1fr));
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field label {
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    input[type="text"],
    input[type="date"],
    select,
    textarea {
      background: rgba(15,23,42,0.95);
      border-radius: 14px;
      border: 1px solid rgba(51,65,85,0.9);
      padding: 8px 10px;
      color: var(--text-main);
      font-size: 0.83rem;
      font-family: inherit;
      width: 100%;
      max-width: 100%;
      outline: none;
      transition: border 0.12s, box-shadow 0.12s, background 0.12s;
    }

    select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      padding-right: 26px;
      background-image: linear-gradient(45deg, transparent 50%, #9ca3af 50%),
                        linear-gradient(135deg, #9ca3af 50%, transparent 50%);
      background-position: calc(100% - 15px) 10px, calc(100% - 11px) 10px;
      background-size: 6px 6px, 6px 6px;
      background-repeat: no-repeat;
    }

    textarea {
      min-height: 72px;
      resize: vertical;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: rgba(34,197,94,0.9);
      box-shadow: 0 0 0 1px rgba(34,197,94,0.5);
      background: rgba(15,23,42,0.98);
    }

    /* Mi huerto ‚Äì tarjetas de cultivos */

    .cultivos-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 4px;
    }

    .cultivo-card {
      border-radius: var(--radius-lg);
      padding: 10px 11px;
      background: radial-gradient(circle at top left, var(--card-soft) 0, #020617 60%);
      border: 1px solid rgba(75,85,99,0.9);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .cultivo-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .cultivo-title {
      font-size: 0.9rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .cultivo-body {
      font-size: 0.78rem;
      color: var(--text-soft);
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 4px 10px;
      margin-top: 4px;
    }

    @media (max-width: 480px) {
      .cultivo-body {
        grid-template-columns: 1fr;
      }
    }

    .cultivo-notas {
      margin-top: 4px;
      font-size: 0.78rem;
      color: #e5e7eb;
    }

    .cultivo-actions {
      margin-top: 6px;
      display: flex;
      justify-content: flex-end;
      gap: 6px;
      flex-wrap: wrap;
    }

    .link-like {
      font-size: 0.78rem;
      color: #4ade80;
      text-decoration: underline;
      cursor: pointer;
    }

    /* Calendario de siembra */

    .calendar-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
    }

    .calendar-item {
      border-radius: 16px;
      padding: 9px 10px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(55,65,81,0.9);
      font-size: 0.8rem;
    }

    .calendar-item-title {
      font-weight: 600;
      margin-bottom: 2px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .calendar-empty {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-top: 8px;
    }

    /* Diario */

    .diario-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 6px;
      font-size: 0.8rem;
    }

    .diario-item {
      border-radius: 14px;
      padding: 8px 10px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(55,65,81,0.9);
    }

    .diario-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 2px;
    }

    /* Plagas / Gu√≠as */

    .media-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 6px;
    }

    .media-item-title {
      font-size: 0.86rem;
      font-weight: 600;
    }

    .media-item-body {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-top: 2px;
    }

    ul {
      margin: 4px 0 4px 18px;
      padding: 0;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    /* FOOTER */

    footer {
      margin-top: 6px;
      font-size: 0.76rem;
      color: var(--text-soft);
      text-align: center;
      padding-bottom: 6px;
    }

    footer span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /* Install button */

    #installBanner {
      position: fixed;
      left: 50%;
      bottom: 16px;
      transform: translateX(-50%);
      background: rgba(15,23,42,0.97);
      border-radius: 999px;
      padding: 7px 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid rgba(148,163,184,0.75);
      box-shadow: 0 16px 40px rgba(15,23,42,0.85);
      font-size: 0.78rem;
      z-index: 80;
    }

    #installBanner.hidden {
      display: none;
    }

    #installBanner button {
      font-size: 0.78rem;
      padding: 6px 10px;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- HEADER -->
    <header class="app-header">
      <div class="app-header-icon">
        <span>üå±</span>
      </div>
      <div class="app-header-text">
        <div class="app-title-row">
          <div class="app-title">Mi Siembra Inteligente</div>
          <div class="app-tag">v17 ¬∑ PWA</div>
        </div>
        <div class="app-subtitle" id="appSubtitle">
          <!-- Se rellena desde JS con huerto, clima y hemisferio -->
        </div>
      </div>
    </header>

    <!-- NAV -->
    <nav class="nav">
      <button class="nav-btn nav-btn--active" data-section="inicio">
        <span class="nav-icon">üè†</span>
        <span class="nav-label">Inicio</span>
      </button>
      <button class="nav-btn" data-section="calendario">
        <span class="nav-icon">üìÖ</span>
        <span class="nav-label">Calendario</span>
      </button>
      <button class="nav-btn" data-section="huerto">
        <span class="nav-icon">üåø</span>
        <span class="nav-label">Mi huerto</span>
      </button>
      <button class="nav-btn" data-section="diario">
        <span class="nav-icon">üìì</span>
        <span class="nav-label">Diario</span>
      </button>
      <button class="nav-btn" data-section="plagas">
        <span class="nav-icon">üêõ</span>
        <span class="nav-label">Plagas</span>
      </button>
      <button class="nav-btn" data-section="pesticidas">
        <span class="nav-icon">üíß</span>
        <span class="nav-label">Pesticidas</span>
      </button>
      <button class="nav-btn" data-section="opciones">
        <span class="nav-icon">‚öôÔ∏è</span>
        <span class="nav-label">Opciones</span>
      </button>
      <button class="nav-btn" data-section="guias">
        <span class="nav-icon">üìö</span>
        <span class="nav-label">Gu√≠as</span>
      </button>
      <button class="nav-btn" data-section="catalogo">
  <span class="nav-icon">üå±</span>
  <span class="nav-label">Cat√°logo</span>
</button>
    </nav>

    <main>
      <!-- INICIO -->
      <section id="section-inicio" class="section section--active">
        <div class="section-title-row">
          <div class="section-icon-pill">üè†</div>
          <h2>Inicio</h2>
        </div>
        <p class="section-subtitle">
          Resumen r√°pido de tu huerto y acceso a las funciones principales.
        </p>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Estado r√°pido</div>
            <div class="chip badge" id="estadoClimaChip">Clima tropical</div>
          </div>
          <div class="context-chips settings-context"></div>
          <div class="grid-two">
            <div>
              <div class="small-label">Cultivos registrados</div>
              <div class="big-number" id="estadoCultivosCount">0</div>
            </div>
            <div>
              <div class="small-label">Entradas hoy en el diario</div>
              <div class="big-number" id="estadoEntradasCount">0</div>
            </div>
          </div>
          <div class="divider-soft"></div>
          <p class="muted" id="estadoResumen">
            A√∫n no has registrado cultivos. Usa "Mi huerto" para a√±adir tu primera siembra.
          </p>
          <div class="pill-group">
            <button class="btn-secondary btn" id="btnIrMiHuerto">
              <span>üåø</span> Ir a "Mi huerto"
            </button>
            <button class="btn-secondary btn" id="btnIrDiario">
              <span>‚úèÔ∏è</span> Escribir en el diario
            </button>
            <button class="btn-secondary btn" id="btnIrClima">
              <span>‚öôÔ∏è</span> Ajustar clima
            </button>
          </div>
        </div>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Hoy en el calendario</div>
            <div class="chip" id="calendarioClimaChip">Clima tropical</div>
          </div>
          <p class="muted" id="calendarioHoyTexto">
            Usa el calendario de siembra para ver qu√© es recomendable sembrar este mes.
          </p>
          <button class="btn btn-full" id="btnVerCalendario">
            <span>üìÖ</span> Ver calendario de siembra
          </button>
        </div>
      </section>

      <!-- CALENDARIO -->
      <section id="section-calendario" class="section">
        <div class="section-title-row">
          <div class="section-icon-pill">üìÖ</div>
          <h2>Calendario de siembra</h2>
        </div>
        <p class="section-subtitle">
          Selecciona un mes para ver sugerencias de cultivos seg√∫n tu clima actual.
          Son recomendaciones generales; aj√∫stalas a tu experiencia local.
        </p>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Meses del a√±o</div>
            <div class="chip" id="calendarioClimaChip2">Clima tropical</div>
          </div>
          <div class="context-chips settings-context"></div>

          <div class="pill-group" id="mesesPills">
            <button class="pill" data-mes="0">Ene</button>
            <button class="pill" data-mes="1">Feb</button>
            <button class="pill" data-mes="2">Mar</button>
            <button class="pill" data-mes="3">Abr</button>
            <button class="pill" data-mes="4">May</button>
            <button class="pill pill--active" data-mes="5">Jun</button>
            <button class="pill" data-mes="6">Jul</button>
            <button class="pill" data-mes="7">Ago</button>
            <button class="pill" data-mes="8">Sep</button>
            <button class="pill" data-mes="9">Oct</button>
            <button class="pill" data-mes="10">Nov</button>
            <button class="pill" data-mes="11">Dic</button>
          </div>

          <div class="calendar-list" id="calendarList"></div>
          <div class="calendar-empty" id="calendarEmpty" style="display:none;">
            Por ahora no tenemos recomendaciones espec√≠ficas para este mes y clima.
            Puedes usar tu experiencia local o guiarte por cultivos similares.
          </div>
        </div>
      </section>

      <!-- MI HUERTO -->
      <section id="section-huerto" class="section">
        <div class="section-title-row">
          <div class="section-icon-pill">üåø</div>
          <h2>Mi huerto</h2>
        </div>
        <p class="section-subtitle">
          Registra tus cultivos y consulta los detalles de cada planta.
        </p>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Nuevo cultivo</div>
            <div class="chip badge">Registro r√°pido</div>
          </div>
          <div class="context-chips settings-context"></div>

          <div class="form-grid form-grid--2">
            <div class="field">
              <label for="cultivoNombre">Nombre del cultivo *</label>
              <input type="text" id="cultivoNombre" placeholder="Ej. Tomate, lechuga, pl√°tano" />
            </div>
            <div class="field">
              <label for="cultivoVariedad">Variedad (opcional)</label>
              <input type="text" id="cultivoVariedad" placeholder="Ej. Cherry, romana, etc." />
            </div>
          </div>

          <div class="form-grid form-grid--2">
            <div class="field">
              <label for="cultivoTipo">Tipo</label>
              <select id="cultivoTipo">
                <option value="hoja">Hoja</option>
                <option value="fruto">Fruto</option>
                <option value="raiz">Ra√≠z</option>
                <option value="tuberculo">Tub√©rculo</option>
                <option value="aromaticas">Arom√°ticas</option>
                <option value="otro">Otro</option>
              </select>
            </div>
            <div class="field">
              <label for="cultivoFecha">Fecha de siembra</label>
              <input type="date" id="cultivoFecha" />
            </div>
          </div>

          <div class="field">
            <label for="cultivoNotas">Notas (lugar, cama, maceta, etc.)</label>
            <textarea id="cultivoNotas" placeholder="Ej. Cama 1, fila 2. Semilla directa en suelo."></textarea>
          </div>

          <button class="btn btn-full" id="btnAgregarCultivo">
            <span>‚ûï</span> Guardar cultivo
          </button>
          <p class="muted" style="margin-top:6px;">
            * Solo el nombre es obligatorio. Puedes editar o eliminar los cultivos luego.
          </p>
        </div>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Cultivos registrados</div>
            <div class="chip" id="cultivosCountChip">0 cultivos</div>
          </div>
          <div class="cultivos-list" id="cultivosList"></div>
        </div>
      </section>

      <!-- DIARIO -->
      <section id="section-diario" class="section">
        <div class="section-title-row">
          <div class="section-icon-pill">üìì</div>
          <h2>Diario de huerto</h2>
        </div>
        <p class="section-subtitle">
          Anota riegos, abonados, podas o cualquier evento importante de tu huerto.
        </p>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Nueva entrada</div>
            <div class="chip badge">Hoy</div>
          </div>
          <div class="field">
            <label for="diarioTexto">¬øQu√© hiciste hoy?</label>
            <textarea id="diarioTexto" placeholder="Ej. Regu√© tomates y lechugas. Apliqu√© compost a las arom√°ticas."></textarea>
          </div>
          <button class="btn btn-full" id="btnGuardarDiario">
            <span>üíæ</span> Guardar en el diario
          </button>
        </div>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Entradas recientes</div>
            <div class="chip" id="diarioCountChip">0 entradas</div>
          </div>
          <div class="diario-list" id="diarioList"></div>
        </div>
      </section>

      <!-- PLAGAS -->
      <section id="section-plagas" class="section">
        <div class="section-title-row">
          <div class="section-icon-pill">üêõ</div>
          <h2>Plagas comunes</h2>
        </div>
        <p class="section-subtitle">
          Referencia r√°pida de plagas frecuentes en huertos caseros y c√≥mo manejarlas
          de forma responsable.
        </p>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Cat√°logo b√°sico de plagas</div>
            <div class="chip">Referencia</div>
          </div>
          <div class="media-list" id="plagasList"></div>
        </div>
      </section>

      <!-- PESTICIDAS -->
      <section id="section-pesticidas" class="section">
        <div class="section-title-row">
          <div class="section-icon-pill">üíß</div>
          <h2>Pesticidas y preparados</h2>
        </div>
        <p class="section-subtitle">
          Opciones suaves y de bajo impacto para manejar plagas en un huerto casero.
          Siempre respeta las indicaciones de seguridad.
        </p>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Preparados sugeridos</div>
            <div class="chip">Uso responsable</div>
          </div>
          <div class="media-list" id="pesticidasList"></div>
        </div>
      </section>

      <!-- OPCIONES -->
      <section id="section-opciones" class="section">
        <div class="section-title-row">
          <div class="section-icon-pill">‚öôÔ∏è</div>
          <h2>Opciones</h2>
        </div>
        <p class="section-subtitle">
          Ajusta el nombre de tu huerto, el clima y el hemisferio. Estos datos
          actualizan el calendario y los textos de la aplicaci√≥n.
        </p>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Datos generales</div>
          </div>
          <div class="context-chips settings-context"></div>

          <div class="form-grid">
            <div class="field">
              <label for="nombreHuerto">Nombre de huerto</label>
              <input type="text" id="nombreHuerto" placeholder="Ej. Huerto RDG, Mi huerto, etc." />
            </div>
          </div>

          <div class="form-grid form-grid--2">
            <div class="field">
              <label for="climaSelect">Clima principal</label>
              <select id="climaSelect">
                <option value="tropical">Tropical (Caribe, PR, etc.)</option>
                <option value="subtropical">Subtropical / templado suave</option>
                <option value="templado">Templado / fr√≠o</option>
              </select>
            </div>
            <div class="field">
              <label for="hemisferioSelect">Hemisferio</label>
              <select id="hemisferioSelect">
                <option value="norte">Hemisferio norte</option>
                <option value="sur">Hemisferio sur</option>
              </select>
            </div>
          </div>

          <button class="btn btn-full" id="btnGuardarConfig">
            <span>üíæ</span> Guardar configuraci√≥n
          </button>

          <div class="divider-soft"></div>
          <p class="muted">
            Toda la informaci√≥n se guarda <strong>solo en tu dispositivo</strong> usando almacenamiento local.
            Puedes exportar los datos como texto para tener una copia de seguridad.
          </p>

          <div class="pill-group">
            <button class="btn-secondary btn" id="btnExportar">
              <span>üì§</span> Exportar datos (texto)
            </button>
            <button class="btn-secondary btn" id="btnImportar">
              <span>üì•</span> Importar datos (texto)
            </button>
            <button class="btn-danger btn" id="btnBorrarTodo">
              <span>üßπ</span> Borrar todo
            </button>
          </div>
        </div>
      </section>

      <!-- GUIAS -->
      <section id="section-guias" class="section">
        <div class="section-title-row">
          <div class="section-icon-pill">üìö</div>
          <h2>Gu√≠as r√°pidas</h2>
        </div>
        <p class="section-subtitle">
          Consejos b√°sicos para sacar m√°s provecho a tu huerto, sin reemplazar la
          experiencia de campo ni el consejo de especialistas.
        </p>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Antes de sembrar</div>
            <div class="chip">Paso 1</div>
          </div>
          <div class="media-list">
            <div>
              <div class="media-item-title">Preparar el suelo</div>
              <div class="media-item-body">
                Retira piedras y ra√≠ces gruesas, agrega materia org√°nica (compost, esti√©rcol bien
                descompuesto) y afloja la tierra sin voltearla en exceso para cuidar la vida
                del suelo.
              </div>
            </div>
            <div>
              <div class="media-item-title">Elegir el lugar</div>
              <div class="media-item-body">
                La mayor√≠a de los cultivos necesitan al menos 4‚Äì6 horas de sol directo. Observa
                tu patio o balc√≥n un d√≠a completo y elige las zonas con mejor iluminaci√≥n.
              </div>
            </div>
          </div>
        </div>

        <div class="app-card">
          <div class="app-card-header">
            <div class="app-card-title">Riego inteligente</div>
            <div class="chip">Paso 2</div>
          </div>
          <div class="media-list">
            <div>
              <div class="media-item-title">Revisar la humedad</div>
              <div class="media-item-body">
                Antes de regar, introduce un dedo en el sustrato hasta 2‚Äì3&nbsp;cm. Si est√° h√∫medo,
                espera. Si est√° seco, riega de forma lenta y profunda.
              </div>
            </div>
            <div>
              <div class="media-item-title">Horario recomendado</div>
              <div class="media-item-body">
                En climas c√°lidos suele ser mejor regar temprano en la ma√±ana o al final de la
                tarde para reducir evaporaci√≥n y estr√©s en las plantas.
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- CAT√ÅLOGO -->
<section id="section-catalogo" class="section">
  <div class="section-title-row">
    <div class="section-icon-pill">üå±</div>
    <h2>Cat√°logo de cultivos</h2>
  </div>

  <p class="section-subtitle">
    Consulta informaci√≥n r√°pida: sol, distancia, profundidad, meses de siembra y plagas comunes.
  </p>

  <div class="app-card">
    <div class="app-card-header">
      <div class="app-card-title">Listado completo</div>
      <div class="chip">40 cultivos</div>
    </div>

    <div class="media-list" id="catalogoList"></div>
  </div>
</section>
      
</section>
    </main>

    <footer>
      <span>Mi Siembra Inteligente ¬∑ Datos guardados localmente en tu dispositivo üåø</span>
    </footer>
  </div>

  <!-- Banner instalar PWA -->
  <div id="installBanner" class="hidden">
    <span>Instala <strong>Mi Siembra Inteligente</strong> en tu dispositivo</span>
    <button class="btn btn-secondary" id="btnInstalarPwa">
      <span>üì≤</span> Instalar
    </button>
  </div>

  <script>
    /*********************
     * Datos y utilidades
     *********************/
    const STORAGE_KEYS = {
      settings: "msi-settings",
      cultivos: "msi-cultivos",
      diario: "msi-diario"
    };

    const DEFAULT_SETTINGS = {
      nombreHuerto: "Mi huerto",
      clima: "tropical",   // tropical | subtropical | templado
      hemisferio: "norte"  // norte | sur
    };

    const CLIMA_LABEL = {
      tropical: "tropical",
      subtropical: "subtropical/templado",
      templado: "templado/fr√≠o"
    };

    const HEMISFERIO_LABEL = {
      norte: "hemisferio norte",
      sur: "hemisferio sur"
    };

    function loadSettings() {
      try {
        const raw = localStorage.getItem(STORAGE_KEYS.settings);
        if (!raw) return { ...DEFAULT_SETTINGS };
        const parsed = JSON.parse(raw);
        return { ...DEFAULT_SETTINGS, ...parsed };
      } catch {
        return { ...DEFAULT_SETTINGS };
      }
    }

    function saveSettings(settings) {
      localStorage.setItem(STORAGE_KEYS.settings, JSON.stringify(settings));
    }

    function loadCultivos() {
      try {
        const raw = localStorage.getItem(STORAGE_KEYS.cultivos);
        if (!raw) return [];
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      } catch {
        return [];
      }
    }

    function saveCultivos(list) {
      localStorage.setItem(STORAGE_KEYS.cultivos, JSON.stringify(list));
    }

    function loadDiario() {
      try {
        const raw = localStorage.getItem(STORAGE_KEYS.diario);
        if (!raw) return [];
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      } catch {
        return [];
      }
    }

    function saveDiario(list) {
      localStorage.setItem(STORAGE_KEYS.diario, JSON.stringify(list));
    }

    function formatDate(dateStr) {
      if (!dateStr) return "Sin fecha";
      const d = new Date(dateStr + "T00:00:00");
      if (Number.isNaN(d.getTime())) return dateStr;
      const meses = ["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"];
      return `${d.getDate().toString().padStart(2,"0")} ${meses[d.getMonth()]} ${d.getFullYear()}`;
    }

    function todayISO() {
      const d = new Date();
      return d.toISOString().slice(0,10);
    }

    /*********************
     * Calendario de siembra
     *********************/
    // Muy resumido; puedes ampliar m√°s tarde
    const CALENDARIO_SIEMBRA = {
      tropical: {
        5: [
          { titulo: "Re-siembra de lechugas", tipo: "Hoja", detalle: "Siembra escalonada cada 2‚Äì3 semanas para cosechas continuas." },
          { titulo: "R√°banos", tipo: "Ra√≠z", detalle: "Cosecha r√°pida (20‚Äì30 d√≠as). Perfectos para ocupar huecos libres." }
        ],
        6: [
          { titulo: "Berenjena", tipo: "Fruto", detalle: "Le gustan las noches c√°lidas. Ideal para verano tropical." },
          { titulo: "Aj√≠es y pimientos", tipo: "Fruto", detalle: "Sembrar en lugar soleado y con buen drenaje." }
        ]
      },
      subtropical: {
        5: [
          { titulo: "Tomates de media estaci√≥n", tipo: "Fruto", detalle: "Elige variedades adaptadas a tu regi√≥n." }
        ]
      },
      templado: {
        2: [
          { titulo: "Lechugas de primavera", tipo: "Hoja", detalle: "Siembra temprana bajo protecci√≥n ligera si hay riesgo de heladas." }
        ]
      }
    };

    function getCalendarData(settings, monthIndex) {
      const climaKey = settings.clima || "tropical";
      const base = CALENDARIO_SIEMBRA[climaKey] || {};
      return base[monthIndex] || [];
    }

    /*********************
     * Render de UI (header, chips, etc.)
     *********************/
    let stateSettings = loadSettings();
    let stateCultivos = loadCultivos();
    let stateDiario = loadDiario();

    function updateHeader() {
      const subtitleEl = document.getElementById("appSubtitle");
      const nombre = stateSettings.nombreHuerto || "Mi huerto";
      const clima = CLIMA_LABEL[stateSettings.clima] || CLIMA_LABEL.tropical;
      const hemis = HEMISFERIO_LABEL[stateSettings.hemisferio] || HEMISFERIO_LABEL.norte;

      subtitleEl.innerHTML = `
        <span>Huerto "<strong>${nombre}</strong>"</span>
        <span class="app-subtitle-dot"></span>
        <span>clima ${clima}</span>
        <span class="app-subtitle-dot"></span>
        <span>${hemis}</span>
      `;
    }

    function updateSettingsContexts() {
      const nombre = stateSettings.nombreHuerto || "Mi huerto";
      const clima = CLIMA_LABEL[stateSettings.clima] || CLIMA_LABEL.tropical;
      const hemis = HEMISFERIO_LABEL[stateSettings.hemisferio] || HEMISFERIO_LABEL.norte;

      document.querySelectorAll(".settings-context").forEach(el => {
        el.innerHTML = `
          <span class="chip"><span>üåø</span> Huerto: ${nombre}</span>
          <span class="chip"><span>‚òÅÔ∏è</span> Clima: ${clima}</span>
          <span class="chip"><span>üß≠</span> ${hemis}</span>
        `;
      });

      const climaText = `Clima ${clima}`;
      const estadoClimaChip = document.getElementById("estadoClimaChip");
      if (estadoClimaChip) estadoClimaChip.textContent = climaText;
      const calChip = document.getElementById("calendarioClimaChip");
      if (calChip) calChip.textContent = climaText;
      const calChip2 = document.getElementById("calendarioClimaChip2");
      if (calChip2) calChip2.textContent = climaText;
    }

    function renderInicio() {
      const cultivos = stateCultivos;
      const diario = stateDiario;
      const cultivosCount = cultivos.length;
      const today = todayISO();

      const entradasHoy = diario.filter(e => e.fecha === today).length;

      document.getElementById("estadoCultivosCount").textContent = cultivosCount.toString();
      document.getElementById("estadoEntradasCount").textContent = entradasHoy.toString();

      const resumen = document.getElementById("estadoResumen");
      const nombre = stateSettings.nombreHuerto || "tu huerto";

      if (!cultivosCount && !entradasHoy) {
        resumen.textContent = `Todav√≠a no has registrado cultivos ni entradas en el diario. Empieza a√±adiendo tu primer cultivo en "Mi huerto".`;
      } else if (cultivosCount && !entradasHoy) {
        resumen.textContent = `Tienes ${cultivosCount} cultivo(s) registrado(s) en ${nombre}. A√∫n no has escrito nada en el diario hoy.`;
      } else if (cultivosCount && entradasHoy) {
        resumen.textContent = `Llevas ${cultivosCount} cultivo(s) activo(s) y ya registraste ${entradasHoy} nota(s) en el diario hoy. ¬°Buen trabajo!`;
      } else {
        resumen.textContent = `Tienes anotaciones en el diario pero a√∫n no has a√±adido cultivos. Usa "Mi huerto" para registrar lo que est√°s sembrando.`;
      }

      // Calendario "hoy" (usa mes actual)
      const now = new Date();
      const monthIndex = now.getMonth();
      const data = getCalendarData(stateSettings, monthIndex);
      const calHoyTexto = document.getElementById("calendarioHoyTexto");

      if (data.length === 0) {
        calHoyTexto.textContent = `En ${nombre} no hay recomendaciones espec√≠ficas para este mes con el clima actual, pero puedes consultar los dem√°s meses en el calendario.`;
      } else {
        const nombres = data.map(d => d.titulo).join(", ");
        calHoyTexto.textContent = `Para este mes se sugieren cultivos como: ${nombres}. Revisa el calendario para ver el detalle.`;
      }
    }

    function renderCultivos() {
      const listEl = document.getElementById("cultivosList");
      const chip = document.getElementById("cultivosCountChip");
      if (!listEl) return;

      const count = stateCultivos.length;
      if (chip) chip.textContent = `${count} cultivo${count === 1 ? "" : "s"}`;

      if (!count) {
        listEl.innerHTML = `<p class="muted">Todav√≠a no has registrado cultivos. Usa el formulario de arriba para a√±adir tu primera siembra.</p>`;
        return;
      }

      listEl.innerHTML = "";
      stateCultivos.forEach(c => {
        const card = document.createElement("div");
        card.className = "cultivo-card";

        const tipoLabelMap = {
          hoja: "Hoja",
          fruto: "Fruto",
          raiz: "Ra√≠z",
          tuberculo: "Tub√©rculo",
          aromaticas: "Arom√°ticas",
          otro: "Otro"
        };
        const tipoLabel = tipoLabelMap[c.tipo] || "Otro";

        card.innerHTML = `
          <div class="cultivo-header">
            <div class="cultivo-title">
              <span>üåø</span>
              <span>${c.nombre}</span>
            </div>
            <span class="chip">${tipoLabel}</span>
          </div>
          <div class="cultivo-body">
            <div><strong>Variedad:</strong> ${c.variedad || "Sin especificar"}</div>
            <div><strong>Fecha de siembra:</strong> ${formatDate(c.fechaSiembra)}</div>
            <div><strong>Ubicaci√≥n / notas cortas:</strong> ${c.notas ? c.notas.slice(0,140) : "‚Äî"}</div>
            <div><strong>Registro creado:</strong> ${formatDate(c.creadoEl)}</div>
          </div>
          ${c.notas ? `<div class="cultivo-notas"><strong>Notas:</strong> ${c.notas}</div>` : ""}
          <div class="cultivo-actions">
            <button class="btn-secondary btn" data-id="${c.id}" data-action="nota">‚úèÔ∏è A√±adir nota en diario</button>
            <button class="btn-danger btn" data-id="${c.id}" data-action="borrar">üóë Eliminar</button>
          </div>
        `;

        listEl.appendChild(card);
      });
    }

    function renderCalendario(monthIndex = 5) {
      const listEl = document.getElementById("calendarList");
      const emptyEl = document.getElementById("calendarEmpty");
      if (!listEl || !emptyEl) return;

      const data = getCalendarData(stateSettings, monthIndex);

      if (!data.length) {
        listEl.innerHTML = "";
        emptyEl.style.display = "block";
        return;
      }

      emptyEl.style.display = "none";
      listEl.innerHTML = "";

      data.forEach(item => {
        const div = document.createElement("div");
        div.className = "calendar-item";
        div.innerHTML = `
          <div class="calendar-item-title">
            <span>${item.titulo}</span>
            <span class="chip">${item.tipo}</span>
          </div>
          <div>${item.detalle}</div>
        `;
        listEl.appendChild(div);
      });
    }

    function renderDiario() {
      const listEl = document.getElementById("diarioList");
      const chip = document.getElementById("diarioCountChip");
      if (!listEl) return;

      const arr = [...stateDiario].sort((a,b) => b.fecha.localeCompare(a.fecha));
      const count = arr.length;
      if (chip) chip.textContent = `${count} entrada${count === 1 ? "" : "s"}`;

      if (!count) {
        listEl.innerHTML = `<p class="muted">A√∫n no hay notas en el diario. Empieza escribiendo qu√© hiciste hoy en el huerto.</p>`;
        return;
      }

      listEl.innerHTML = "";
      arr.slice(0,25).forEach(item => {
        const div = document.createElement("div");
        div.className = "diario-item";
        div.innerHTML = `
          <div class="diario-item-header">
            <strong>${formatDate(item.fecha)}</strong>
            <span class="chip">${item.tipo || "General"}</span>
          </div>
          <div>${item.texto}</div>
        `;
        listEl.appendChild(div);
      });
    }
/* ---------------------------------------------------------
   BASE DE DATOS ‚Äî IM√ÅGENES Y CULTIVOS
--------------------------------------------------------- */

function cargarImagen(nombre) {
    // Si la imagen existe en /img/, la usa
    // Si no existe, usa placeholder.jpg
    return `img/${nombre}.jpg`;
  /* ============================
   BASE DE DATOS DE CULTIVOS
   ============================ */

const CULTIVOS = [
  {
    nombre: "acelga",
    tipo: "hoja",
    imagen: cargarImagen("acelga"),
    meses: [0,1,2,3,4,5,6,7,8,9,10,11],
    sol: "Sombra parcial",
    profundidad: "0.5 cm",
    distancia: "25 cm",
    plagas: ["pulgones", "babosas"],
    notas: "Crece bien todo el a√±o en climas tropicales."
  },
  {
    nombre: "acerola",
    tipo: "fruto",
    imagen: cargarImagen("acerola"),
    meses: [2,3,4,5,6,7,8],
    sol: "Pleno sol",
    profundidad: "No aplica (√°rbol)",
    distancia: "3 metros",
    plagas: ["mosca de fruta"],
    notas: "Produce varias veces al a√±o en clima tropical."
  },
  {
    nombre: "aguacate",
    tipo: "fruto",
    imagen: cargarImagen("aguacate"),
    meses: [0,1,2,3,4,5,6,7,8,9,10,11],
    sol: "Pleno sol",
    profundidad: "No aplica (√°rbol)",
    distancia: "5 metros",
    plagas: ["√°caros", "mosca de fruta"],
    notas: "Requiere buen drenaje y espacio."
  },
  {
    nombre: "aji",
    tipo: "fruto",
    imagen: cargarImagen("aji"),
    meses: [2,3,4,5,6,7,8,9],
    sol: "Pleno sol",
    profundidad: "0.5 cm",
    distancia: "40 cm",
    plagas: ["pulgones", "mosca blanca"],
    notas: "Excelente para climas calurosos como Puerto Rico."
  },
  {
    nombre: "ajo",
    tipo: "bulbo",
    imagen: cargarImagen("ajo"),
    meses: [9,10,11,0],
    sol: "Pleno sol",
    profundidad: "2‚Äì3 cm",
    distancia: "15 cm",
    plagas: ["hongos del suelo"],
    notas: "Prefiere meses frescos; dif√≠cil en zonas muy h√∫medas."
  },
  {
    nombre: "albahaca",
    tipo: "arom√°tica",
    imagen: cargarImagen("albahaca"),
    meses: [0,1,2,3,4,5,6,7,8,9,10,11],
    sol: "Pleno sol",
    profundidad: "0.5 cm",
    distancia: "25 cm",
    plagas: ["pulgones"],
    notas: "Excelente repelente natural para tomates."
  },
  {
    nombre: "apio",
    tipo: "hoja",
    imagen: cargarImagen("apio"),
    meses: [0,1,2,3,4,5,6,7,8,9,10,11],
    sol: "Sombra parcial",
    profundidad: "0.5 cm",
    distancia: "25 cm",
    plagas: ["babosas", "caracoles"],
    notas: "Mantener humedad constante."
  },
  {
    nombre: "arugula",
    tipo: "hoja",
    imagen: cargarImagen("arugula"),
    meses: [0,1,2,3,4,5,6,7,8,9,10,11],
    sol: "Sombra parcial",
    profundidad: "0.3 cm",
    distancia: "20 cm",
    plagas: ["pulgones"],
    notas: "Cosecha r√°pida (20‚Äì30 d√≠as)."
  },
  {
    nombre: "batata",
    tipo: "tub√©rculo",
    imagen: cargarImagen("batata"),
    meses: [2,3,4,5,6,7,8,9],
    sol: "Pleno sol",
    profundidad: "5 cm",
    distancia: "40 cm",
    plagas: ["gusano de ra√≠z"],
    notas: "Crece muy bien en clima tropical."
  },
  {
    nombre: "berenjena",
    tipo: "fruto",
    imagen: cargarImagen("berenjena"),
    meses: [2,3,4,5,6,7,8,9],
    sol: "Pleno sol",
    profundidad: "1 cm",
    distancia: "50 cm",
    plagas: ["pulgones", "ara√±a roja"],
    notas: "Ama el calor, ideal para verano tropical."
  },
  {
    nombre: "brocoli",
    tipo: "hoja",
    imagen: cargarImagen("brocoli"),
    meses: [8,9,10,11,0,1],
    sol: "Pleno sol",
    profundidad: "1 cm",
    distancia: "40 cm",
    plagas: ["orugas"],
    notas: "Mejor en clima fresco."
  },
  {
    nombre: "calabaza",
    tipo: "fruto",
    imagen: cargarImagen("calabaza"),
    meses: [1,2,3,4,5,6,7],
    sol: "Pleno sol",
    profundidad: "2 cm",
    distancia: "1 metro",
    plagas: ["barrenador", "orugas"],
    notas: "Necesita espacio para expandirse."
  },
  {
    nombre: "cebolla",
    tipo: "bulbo",
    imagen: cargarImagen("cebolla"),
    meses: [8,9,10,11],
    sol: "Pleno sol",
    profundidad: "1 cm",
    distancia: "15 cm",
    plagas: ["nem√°todos"],
    notas: "Prefiere suelo suelto."
  },
  {
    nombre: "cilantro",
    tipo: "arom√°tica",
    imagen: cargarImagen("cilantro"),
    meses: [0,1,2,3,4,5,6,7,8,9,10,11],
    sol: "Sombra parcial",
    profundidad: "0.5 cm",
    distancia: "10 cm",
    plagas: ["pulgones"],
    notas: "Florece r√°pido si hace mucho calor."
  },
  {
    nombre: "habichuela",
    tipo: "fruto",
    imagen: cargarImagen("habichuela"),
    meses: [1,2,3,4,5,6,7,8],
    sol: "Pleno sol",
    profundidad: "2 cm",
    distancia: "30 cm",
    plagas: ["mosca blanca", "roya"],
    notas: "Variedades trepadoras requieren soporte."
  },
  {
    nombre: "lechuga",
    tipo: "hoja",
    imagen: cargarImagen("lechuga"),
    meses: [0,1,2,3,4,5,6,7,8,9,10,11],
    sol: "Sombra parcial",
    profundidad: "0.3 cm",
    distancia: "25 cm",
    plagas: ["babosas"],
    notas: "En PR funciona todo el a√±o en sombra parcial."
  },
  {
    nombre: "maiz",
    tipo: "fruto",
    imagen: cargarImagen("maiz"),
    meses: [1,2,3,4,5,6,7],
    sol: "Pleno sol",
    profundidad: "3 cm",
    distancia: "35 cm",
    plagas: ["orugas"],
    notas: "Sembrar en grupos para buena polinizaci√≥n."
  },
  {
    nombre: "melon",
    tipo: "fruto",
    imagen: cargarImagen("melon"),
    meses: [1,2,3,4,5,6],
    sol: "Pleno sol",
    profundidad: "2 cm",
    distancia: "1 metro",
    plagas: ["mosca de fruta"],
    notas: "Necesita calor y suelos ricos."
  },
  {
    nombre: "oregano",
    tipo: "arom√°tica",
    imagen: cargarImagen("oregano"),
    meses: [0,1,2,3,4,5,6,7,8,9,10,11],
    sol: "Pleno sol",
    profundidad: "0.3 cm",
    distancia: "20 cm",
    plagas: [],
    notas: "Muy resistente en clima tropical."
  },
  {
    nombre: "papa",
    tipo: "tub√©rculo",
    imagen: cargarImagen("papa"),
    meses: [10,11,0,1],
    sol: "Pleno sol",
    profundidad: "10 cm",
    distancia: "40 cm",
    plagas: ["gusano de ra√≠z"],
    notas: "Dif√≠cil en zonas muy calientes."
  },
  {
    nombre: "pimiento",
    tipo: "fruto",
    imagen: cargarImagen("pimiento"),
    meses: [2,3,4,5,6,7,8],
    sol: "Pleno sol",
    profundidad: "0.5 cm",
    distancia: "40 cm",
    plagas: ["pulgones", "mosca blanca"],
    notas: "Excelente rendimiento en clima c√°lido."
  },
  {
    nombre: "pi√±a",
    tipo: "fruto",
    imagen: cargarImagen("pina"),
    meses: [0,1,2,3,4,5,6,7,8,9,10,11],
    sol: "Pleno sol",
    profundidad: "Superficial",
    distancia: "1 metro",
    plagas: ["cochinilla"],
    notas: "Crece muy bien en PR."
  },
  {
    nombre: "platano",
    tipo: "fruto",
    imagen: cargarImagen("platano"),
    meses: [0,1,2,3,4,5,6,7,8,9,10,11],
    sol: "Pleno sol",
    profundidad: "No aplica",
    distancia: "2 metros",
    plagas: ["picudo"],
    notas: "Requiere mucha agua y nutrientes."
  },
  {
    nombre: "repollo",
    tipo: "hoja",
    imagen: cargarImagen("repollo"),
    meses: [8,9,10,11,0,1],
    sol: "Pleno sol",
    profundidad: "1 cm",
    distancia: "40 cm",
    plagas: ["orugas"],
    notas: "Prefiere clima fresco."
  },
  {
    nombre: "tomate",
    tipo: "fruto",
    imagen: cargarImagen("tomate"),
    meses: [1,2,3,4,5,6,7,8],
    sol: "Pleno sol",
    profundidad: "1 cm",
    distancia: "45 cm",
    plagas: ["pulgones", "mosca blanca", "tiz√≥n"],
    notas: "Uno de los cultivos m√°s nobles del huerto."
  },
  {
    nombre: "zanahoria",
    tipo: "raiz",
    imagen: cargarImagen("zanahoria"),
    meses: [0,1,2,3,4,5,6,7,8,9,10,11],
    sol: "Pleno sol",
    profundidad: "1 cm",
    distancia: "5 cm",
    plagas: ["mosca de la zanahoria"],
    notas: "Necesita suelo suelto y profundo."
  }
];
}
    function renderPlagas() {
      const listEl = document.getElementById("plagasList");
      if (!listEl) return;

      const plagasData = [
        {
          nombre: "Pulgones",
          detalle: "Peque√±os insectos que chupan savia y deforman brotes tiernos. Suelen aparecer en colonias.",
          manejo: "Rociar con agua y jab√≥n pot√°sico o preparar extracto de ajo/aj√≠. Favorecer mariquitas y crisopas."
        },
        {
          nombre: "Mosca blanca",
          detalle: "Insectos blancos que vuelan al mover la planta. Debilitan hojas y favorecen hongos.",
          manejo: "Trampas amarillas, jab√≥n pot√°sico y aceites vegetales suaves respetando dosis."
        },
        {
          nombre: "Orugas",
          detalle: "Larvas que comen hojas dejando mordidas grandes o agujeros.",
          manejo: "Revisi√≥n manual frecuente, retirar orugas a mano. Bacillus thuringiensis en casos necesarios."
        },
        {
          nombre: "Caracoles y babosas",
          detalle: "Suelo h√∫medo y restos de baba plateada cerca de las mordidas.",
          manejo: "Refugios-trampa, barreras f√≠sicas y recolecci√≥n manual al atardecer."
        }
      ];

      listEl.innerHTML = "";
      plagasData.forEach(p => {
        const div = document.createElement("div");
        div.innerHTML = `
          <div class="media-item-title">üêõ ${p.nombre}</div>
          <div class="media-item-body"><strong>C√≥mo se ve:</strong> ${p.detalle}</div>
          <div class="media-item-body"><strong>Manejo recomendado:</strong> ${p.manejo}</div>
        `;
        listEl.appendChild(div);
      });
    }

    function renderPesticidas() {
      const listEl = document.getElementById("pesticidasList");
      if (!listEl) return;

      const data = [
        {
          nombre: "Jab√≥n pot√°sico",
          detalle: "Eficaz contra pulgones y mosca blanca. Aplicar al atardecer y en hojas, evitando flores abiertas."
        },
        {
          nombre: "Aceite de neem (uso hort√≠cola)",
          detalle: "Ayuda a cortar ciclos de varias plagas. Usar con moderaci√≥n y siempre siguiendo etiqueta."
        },
        {
          nombre: "Infusi√≥n de ajo y aj√≠",
          detalle: "Preparado casero de olor fuerte que puede repeler insectos suaves y algunos hongos."
        }
      ];

      listEl.innerHTML = "";
      data.forEach(p => {
        const div = document.createElement("div");
        div.innerHTML = `
          <div class="media-item-title">üíß ${p.nombre}</div>
          <div class="media-item-body">${p.detalle}</div>
        `;
        listEl.appendChild(div);
      });
    /********************************************
 * RENDER DEL CAT√ÅLOGO COMPLETO DE CULTIVOS
 ********************************************/

function renderCatalogo() {
  const contenedor = document.getElementById("catalogoList");
  if (!contenedor) return;

  contenedor.innerHTML = "";

  // Crear barra de b√∫squeda
  const buscador = document.createElement("input");
  buscador.type = "text";
  buscador.placeholder = "Buscar cultivo...";
  buscador.style.width = "100%";
  buscador.style.padding = "10px";
  buscador.style.marginBottom = "12px";
  buscador.style.borderRadius = "12px";
  buscador.style.border = "1px solid rgba(148,163,184,0.4)";
  buscador.style.background = "rgba(15,23,42,0.95)";
  buscador.style.color = "white";
  buscador.style.fontSize = "0.9rem";

  contenedor.appendChild(buscador);

  // Crear contenedor de tarjetas
  const lista = document.createElement("div");
  lista.style.display = "flex";
  lista.style.flexDirection = "column";
  lista.style.gap = "14px";
  contenedor.appendChild(lista);

  function dibujarTarjetas(filtro = "") {
    lista.innerHTML = "";

    const data = CULTIVOS.filter(c =>
      c.nombre.toLowerCase().includes(filtro.toLowerCase())
    );

    if (data.length === 0) {
      lista.innerHTML = `<p class="muted">No se encontraron cultivos con ese nombre.</p>`;
      return;
    }

    data.forEach(c => {
      const card = document.createElement("div");
      card.style.border = "1px solid rgba(148,163,184,0.3)";
      card.style.borderRadius = "18px";
      card.style.padding = "14px";
      card.style.background = "rgba(15,23,42,0.9)";
      card.style.display = "flex";
      card.style.flexDirection = "column";
      card.style.gap = "10px";

      // Imagen
      const img = document.createElement("img");
      img.src = c.imagen || "img/placeholder.jpg";
      img.onerror = () => { img.src = "img/placeholder.jpg"; };
      img.style.width = "100%";
      img.style.height = "170px";
      img.style.objectFit = "cover";
      img.style.borderRadius = "14px";
      img.style.border = "1px solid rgba(148,163,184,0.3)";

      // T√≠tulo
      const titulo = document.createElement("h3");
      titulo.textContent = c.nombre.charAt(0).toUpperCase() + c.nombre.slice(1);
      titulo.style.margin = "0";
      titulo.style.fontSize = "1.05rem";

      // Info compacta
      const info = document.createElement("div");
      info.style.fontSize = "0.85rem";
      info.style.color = "#cbd5e1";
      info.innerHTML = `
        <strong>Tipo:</strong> ${c.tipo}<br>
        <strong>Sol:</strong> ${c.sol}<br>
        <strong>Profundidad:</strong> ${c.profundidad}<br>
        <strong>Distancia:</strong> ${c.distancia}<br>
        <strong>Meses recomendados:</strong> ${c.meses.map(m => m+1).join(", ")}
      `;

      // Plagas
      const plagas = document.createElement("div");
      plagas.style.fontSize = "0.82rem";
      plagas.innerHTML = `
        <strong>Plagas comunes:</strong> 
        ${c.plagas.length ? c.plagas.join(", ") : "Ninguna registrada"}
      `;

      // Notas
      const notas = document.createElement("div");
      notas.style.fontSize = "0.82rem";
      notas.innerHTML = `
        <strong>Notas:</strong> ${c.notas}
      `;

      card.appendChild(img);
      card.appendChild(titulo);
      card.appendChild(info);
      card.appendChild(plagas);
      card.appendChild(notas);

      lista.appendChild(card);
    });
  }

  // Inicial
  dibujarTarjetas();

  // Evento de b√∫squeda
  buscador.addEventListener("input", () => {
    dibujarTarjetas(buscador.value);
  });
}
/********************************************
 * RENDER DEL CAT√ÅLOGO COMPLETO DE CULTIVOS
 ********************************************/

function renderCatalogo() {
  const contenedor = document.getElementById("catalogoList");
  if (!contenedor) return;

  contenedor.innerHTML = "";

  // Crear barra de b√∫squeda
  const buscador = document.createElement("input");
  buscador.type = "text";
  buscador.placeholder = "Buscar cultivo...";
  buscador.style.width = "100%";
  buscador.style.padding = "10px";
  buscador.style.marginBottom = "12px";
  buscador.style.borderRadius = "12px";
  buscador.style.border = "1px solid rgba(148,163,184,0.4)";
  buscador.style.background = "rgba(15,23,42,0.95)";
  buscador.style.color = "white";
  buscador.style.fontSize = "0.9rem";

  contenedor.appendChild(buscador);

  // Crear contenedor de tarjetas
  const lista = document.createElement("div");
  lista.style.display = "flex";
  lista.style.flexDirection = "column";
  lista.style.gap = "14px";
  contenedor.appendChild(lista);

  function dibujarTarjetas(filtro = "") {
    lista.innerHTML = "";

    const data = CULTIVOS.filter(c =>
      c.nombre.toLowerCase().includes(filtro.toLowerCase())
    );

    if (data.length === 0) {
      lista.innerHTML = `<p class="muted">No se encontraron cultivos con ese nombre.</p>`;
      return;
    }

    data.forEach(c => {
      const card = document.createElement("div");
      card.style.border = "1px solid rgba(148,163,184,0.3)";
      card.style.borderRadius = "18px";
      card.style.padding = "14px";
      card.style.background = "rgba(15,23,42,0.9)";
      card.style.display = "flex";
      card.style.flexDirection = "column";
      card.style.gap = "10px";

      // Imagen
      const img = document.createElement("img");
      img.src = c.imagen || "img/placeholder.jpg";
      img.onerror = () => { img.src = "img/placeholder.jpg"; };
      img.style.width = "100%";
      img.style.height = "170px";
      img.style.objectFit = "cover";
      img.style.borderRadius = "14px";
      img.style.border = "1px solid rgba(148,163,184,0.3)";

      // T√≠tulo
      const titulo = document.createElement("h3");
      titulo.textContent = c.nombre.charAt(0).toUpperCase() + c.nombre.slice(1);
      titulo.style.margin = "0";
      titulo.style.fontSize = "1.05rem";

      // Info compacta
      const info = document.createElement("div");
      info.style.fontSize = "0.85rem";
      info.style.color = "#cbd5e1";
      info.innerHTML = `
        <strong>Tipo:</strong> ${c.tipo}<br>
        <strong>Sol:</strong> ${c.sol}<br>
        <strong>Profundidad:</strong> ${c.profundidad}<br>
        <strong>Distancia:</strong> ${c.distancia}<br>
        <strong>Meses recomendados:</strong> ${c.meses.map(m => m+1).join(", ")}
      `;

      // Plagas
      const plagas = document.createElement("div");
      plagas.style.fontSize = "0.82rem";
      plagas.innerHTML = `
        <strong>Plagas comunes:</strong> 
        ${c.plagas.length ? c.plagas.join(", ") : "Ninguna registrada"}
      `;

      // Notas
      const notas = document.createElement("div");
      notas.style.fontSize = "0.82rem";
      notas.innerHTML = `
        <strong>Notas:</strong> ${c.notas}
      `;


    /*********************
     * Eventos y navegaci√≥n
     *********************/
    function setupNavigation() {
      const navButtons = document.querySelectorAll(".nav-btn");
      navButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const section = btn.getAttribute("data-section");
          if (!section) return;
          // botones activos
          navButtons.forEach(b => b.classList.toggle("nav-btn--active", b === btn));
          // secciones
          document.querySelectorAll(".section").forEach(sec => {
            sec.classList.toggle("section--active", sec.id === `section-${section}`);
          });
        });
      });

      document.getElementById("btnIrMiHuerto").addEventListener("click", () => {
        document.querySelector('.nav-btn[data-section="huerto"]').click();
      });
      document.getElementById("btnIrDiario").addEventListener("click", () => {
        document.querySelector('.nav-btn[data-section="diario"]').click();
      });
      document.getElementById("btnIrClima").addEventListener("click", () => {
        document.querySelector('.nav-btn[data-section="opciones"]').click();
      });
      document.getElementById("btnVerCalendario").addEventListener("click", () => {
        document.querySelector('.nav-btn[data-section="calendario"]').click();
      });
    }

    function setupMesesPills() {
      const pills = document.querySelectorAll("#mesesPills .pill");
      pills.forEach(p => {
        p.addEventListener("click", () => {
          pills.forEach(other => other.classList.toggle("pill--active", other === p));
          const month = parseInt(p.getAttribute("data-mes"), 10);
          renderCalendario(month);
        });
      });

      // seleccionar mes actual por defecto
      const now = new Date();
      const currentMonth = now.getMonth();
      const target = Array.from(pills).find(p => parseInt(p.dataset.mes,10) === currentMonth);
      if (target) target.click();
      else renderCalendario(5);
    }

    function setupMiHuertoForm() {
      const btn = document.getElementById("btnAgregarCultivo");
      btn.addEventListener("click", () => {
        const nombre = document.getElementById("cultivoNombre").value.trim();
        const variedad = document.getElementById("cultivoVariedad").value.trim();
        const tipo = document.getElementById("cultivoTipo").value || "otro";
        const fechaSiembra = document.getElementById("cultivoFecha").value || todayISO();
        const notas = document.getElementById("cultivoNotas").value.trim();

        if (!nombre) {
          alert("Por favor escribe al menos el nombre del cultivo.");
          return;
        }

        const nuevo = {
          id: Date.now().toString(36),
          nombre,
          variedad,
          tipo,
          fechaSiembra,
          notas,
          creadoEl: todayISO()
        };

        stateCultivos.push(nuevo);
        saveCultivos(stateCultivos);

        document.getElementById("cultivoNombre").value = "";
        document.getElementById("cultivoVariedad").value = "";
        document.getElementById("cultivoFecha").value = "";
        document.getElementById("cultivoNotas").value = "";

        renderCultivos();
        renderInicio();
        alert("Cultivo guardado.");
      });

      // Delegaci√≥n para botones de cada tarjeta
      document.getElementById("cultivosList").addEventListener("click", (ev) => {
        const btn = ev.target.closest("button[data-id]");
        if (!btn) return;
        const id = btn.getAttribute("data-id");
        const action = btn.getAttribute("data-action");
        const cultivo = stateCultivos.find(c => c.id === id);
        if (!cultivo) return;

        if (action === "borrar") {
          if (confirm(`¬øEliminar el cultivo "${cultivo.nombre}"?`)) {
            stateCultivos = stateCultivos.filter(c => c.id !== id);
            saveCultivos(stateCultivos);
            renderCultivos();
            renderInicio();
          }
        } else if (action === "nota") {
          document.querySelector('.nav-btn[data-section="diario"]').click();
          const campo = document.getElementById("diarioTexto");
          campo.value = `Cultivo: ${cultivo.nombre} (${cultivo.variedad || "sin variedad"}). `;
          campo.focus();
        }
      });
    }

    function setupDiario() {
      document.getElementById("btnGuardarDiario").addEventListener("click", () => {
        const texto = document.getElementById("diarioTexto").value.trim();
        if (!texto) {
          alert("Escribe algo antes de guardar.");
          return;
        }

        const entrada = {
          fecha: todayISO(),
          texto,
          tipo: "General"
        };
        stateDiario.push(entrada);
        saveDiario(stateDiario);
        document.getElementById("diarioTexto").value = "";
        renderDiario();
        renderInicio();
        alert("Entrada guardada en el diario.");
      });
    }

    function setupOpciones() {
      const nombreInput = document.getElementById("nombreHuerto");
      const climaSelect = document.getElementById("climaSelect");
      const hemisSelect = document.getElementById("hemisferioSelect");

      // Inicializar valores
      nombreInput.value = stateSettings.nombreHuerto || "";
      climaSelect.value = stateSettings.clima || "tropical";
      hemisSelect.value = stateSettings.hemisferio || "norte";

      document.getElementById("btnGuardarConfig").addEventListener("click", () => {
        const nuevoNombre = nombreInput.value.trim() || "Mi huerto";
        const nuevoClima = climaSelect.value || "tropical";
        const nuevoHemis = hemisSelect.value || "norte";

        stateSettings = {
          ...stateSettings,
          nombreHuerto: nuevoNombre,
          clima: nuevoClima,
          hemisferio: nuevoHemis
        };
        saveSettings(stateSettings);
        updateHeader();
        updateSettingsContexts();
        renderInicio();
        renderCalendario(new Date().getMonth());
        alert("Configuraci√≥n guardada.");
      });

      // Exportar/importar/borrar
      document.getElementById("btnExportar").addEventListener("click", () => {
        const exportObj = {
          settings: stateSettings,
          cultivos: stateCultivos,
          diario: stateDiario
        };
        const texto = JSON.stringify(exportObj, null, 2);
        prompt("Copia este texto para guardar una copia de seguridad:", texto);
      });

      document.getElementById("btnImportar").addEventListener("click", () => {
        const texto = prompt("Pega aqu√≠ un backup exportado previamente:");
        if (!texto) return;
        try {
          const data = JSON.parse(texto);
          if (data.settings) {
            stateSettings = { ...DEFAULT_SETTINGS, ...data.settings };
            saveSettings(stateSettings);
          }
          if (Array.isArray(data.cultivos)) {
            stateCultivos = data.cultivos;
            saveCultivos(stateCultivos);
          }
          if (Array.isArray(data.diario)) {
            stateDiario = data.diario;
            saveDiario(stateDiario);
          }
          // Re-render
          nombreInput.value = stateSettings.nombreHuerto || "";
          climaSelect.value = stateSettings.clima || "tropical";
          hemisSelect.value = stateSettings.hemisferio || "norte";
          updateHeader();
          updateSettingsContexts();
          renderCultivos();
          renderDiario();
          renderInicio();
          renderCalendario(new Date().getMonth());
          alert("Datos importados correctamente.");
        } catch (e) {
          alert("El texto no parece un backup v√°lido.");
        }
      });

      document.getElementById("btnBorrarTodo").addEventListener("click", () => {
        if (!confirm("Esto borrar√° todos los datos del huerto en este dispositivo. ¬øContinuar?")) return;
        localStorage.removeItem(STORAGE_KEYS.settings);
        localStorage.removeItem(STORAGE_KEYS.cultivos);
        localStorage.removeItem(STORAGE_KEYS.diario);
        stateSettings = { ...DEFAULT_SETTINGS };
        stateCultivos = [];
        stateDiario = [];
        // Re-render complet
        nombreInput.value = stateSettings.nombreHuerto;
        climaSelect.value = stateSettings.clima;
        hemisSelect.value = stateSettings.hemisferio;
        updateHeader();
        updateSettingsContexts();
        renderCultivos();
        renderDiario();
        renderInicio();
        renderCalendario(new Date().getMonth());
        alert("Datos borrados. Empezar√°s de cero.");
      });
    }

    /*********************
     * PWA: service worker + instalar
     *********************/
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("sw.js")
          .catch(err => console.error("Error registrando SW:", err));
      });
    }

    let deferredPrompt = null;
    const installBanner = document.getElementById("installBanner");
    const installBtn = document.getElementById("btnInstalarPwa");

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBanner.classList.remove("hidden");
    });

    installBtn.addEventListener("click", async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
      installBanner.classList.add("hidden");
    });

    /*********************
     * Inicio de la app
     *********************/
    document.addEventListener("DOMContentLoaded", () => {
      updateHeader();
      updateSettingsContexts();
      renderCultivos();
      renderDiario();
      renderInicio();
      renderCalendario(new Date().getMonth());
      renderPlagas();
      renderPesticidas();

      setupNavigation();
      setupMesesPills();
      setupMiHuertoForm();
      setupDiario();
      setupOpciones();
    });
  </script>
</body>
</html>
