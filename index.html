<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mi Siembra Inteligente (v15)</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#22c55e" />
  <style>
    :root {
      color-scheme: dark;
      --bg: #020617;
      --bg-elevated: #02081f;
      --card: #02081f;
      --card-soft: #030919;
      --accent: #22c55e;
      --accent-soft: rgba(34,197,94,0.12);
      --accent-strong: rgba(34,197,94,0.4);
      --text-main: #f9fafb;
      --text-soft: #9ca3af;
      --border-subtle: rgba(148,163,184,0.35);
      --danger: #f97373;
      --danger-soft: rgba(248,113,113,0.1);
      --shadow-soft: 0 12px 30px rgba(15,23,42,0.7);
      --radius-lg: 18px;
      --radius-pill: 999px;
      --transition-fast: 0.18s ease-out;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background: radial-gradient(circle at top, #0b1120 0, #020617 50%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    .app {
      max-width: 960px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 12px 10px 20px;
    }

    @media (min-width: 640px) {
      .app {
        padding: 18px 20px 28px;
      }
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 10px 14px;
      border-radius: var(--radius-lg);
      background: linear-gradient(135deg, rgba(15,23,42,0.9), rgba(6,78,59,0.8));
      box-shadow: var(--shadow-soft);
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(18px);
    }

    .top-title {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }

    .logo-pill {
      width: 38px;
      height: 38px;
      border-radius: 14px;
      background: radial-gradient(circle at 30% 20%, #4ade80, #16a34a 55%, #166534 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      box-shadow: 0 0 0 1px rgba(22,163,74,0.4), 0 8px 22px rgba(21,128,61,0.8);
    }

    .title-text h1 {
      font-size: 17px;
      margin: 0 0 2px;
      font-weight: 630;
      letter-spacing: 0.01em;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .badge-version {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15,23,42,0.8);
      border: 1px solid rgba(148,163,184,0.45);
      color: var(--text-soft);
    }

    #subtitle {
      margin: 0;
      font-size: 12px;
      color: var(--text-soft);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .pill-btn {
      border-radius: var(--radius-pill);
      border: none;
      padding: 7px 14px;
      font-size: 12px;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      background: rgba(15,23,42,0.9);
      color: var(--text-main);
      border: 1px solid rgba(148,163,184,0.5);
      box-shadow: 0 0 0 1px rgba(15,23,42,0.9);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
      white-space: nowrap;
    }

    .pill-btn span {
      font-size: 15px;
    }

    .pill-btn:hover {
      transform: translateY(-1px);
      background: rgba(15,23,42,1);
      box-shadow: 0 12px 22px rgba(15,23,42,0.85);
    }

    .pill-btn:active {
      transform: translateY(0);
      box-shadow: 0 4px 12px rgba(15,23,42,0.7);
    }

    .hidden {
      display: none !important;
    }

    .nav-tabs {
      display: grid;
      grid-template-columns: repeat(4,1fr);
      gap: 6px;
      margin: 12px 4px 10px;
      background: radial-gradient(circle at top, rgba(15,23,42,0.9), rgba(15,23,42,0.7));
      border-radius: 999px;
      padding: 4px;
      border: 1px solid rgba(30,64,175,0.55);
      box-shadow: 0 10px 20px rgba(15,23,42,0.8);
    }

    @media (max-width: 480px) {
      .nav-tabs {
        grid-template-columns: repeat(3,1fr);
        border-radius: 18px;
      }
    }

    .nav-tabs button {
      border-radius: 999px;
      border: none;
      padding: 5px 4px;
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      background: transparent;
      color: var(--text-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
      min-height: 30px;
      white-space: nowrap;
    }

    .nav-tabs button span.icon {
      font-size: 14px;
    }

    .nav-tabs button.active {
      background: linear-gradient(135deg, var(--accent), #16a34a);
      color: #022c22;
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(22,163,74,0.7);
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 4px;
    }

    section.screen {
      display: none;
      background: radial-gradient(circle at top left, rgba(15,23,42,0.95), rgba(15,23,42,0.95));
      border-radius: 20px;
      padding: 14px 14px 18px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(30,64,175,0.4);
    }

    section.screen.active {
      display: block;
    }

    .screen-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .screen-header h2 {
      margin: 0;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .screen-header h2 span {
      font-size: 18px;
    }

    .screen-subtitle {
      margin: 4px 0 0;
      font-size: 12px;
      color: var(--text-soft);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 4px 0 10px;
    }

    .chip {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.8);
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .chip strong {
      color: var(--accent);
      font-weight: 600;
    }

    .card {
      border-radius: 16px;
      background: radial-gradient(circle at top left, var(--card), var(--card-soft));
      border: 1px solid var(--border-subtle);
      padding: 10px 10px 11px;
      margin-bottom: 10px;
    }

    .card.tight {
      padding: 8px 9px;
    }

    .card h3 {
      margin: 0 0 4px;
      font-size: 14px;
    }

    .card p {
      margin: 2px 0;
      font-size: 12px;
      color: var(--text-soft);
    }

    label {
      display: block;
      font-size: 12px;
      margin-bottom: 1px;
      color: var(--text-soft);
    }

    input[type="text"],
    input[type="date"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      background: rgba(15,23,42,0.9);
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      padding: 7px 9px;
      color: var(--text-main);
      font-size: 13px;
      outline: none;
      transition: border var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
    }

    textarea {
      resize: vertical;
      min-height: 60px;
      max-height: 140px;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34,197,94,0.6);
      background: rgba(15,23,42,1);
    }

    .btn-main {
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent), #22c55e);
      color: #022c22;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 10px 24px rgba(22,163,74,0.7);
      margin-top: 6px;
    }

    .btn-main:active {
      box-shadow: 0 6px 16px rgba(22,163,74,0.8);
      transform: translateY(1px);
    }

    .btn-secondary {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      padding: 6px 10px;
      font-size: 11px;
      cursor: pointer;
      background: rgba(15,23,42,0.9);
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-danger {
      border-radius: 999px;
      border: 1px solid rgba(248,113,113,0.6);
      padding: 5px 9px;
      font-size: 11px;
      cursor: pointer;
      background: var(--danger-soft);
      color: #fecaca;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .flex-row {
      display: flex;
      gap: 8px;
    }

    .flex-1 {
      flex: 1;
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(15,23,42,0.85);
      overflow: hidden;
      border: 1px solid rgba(30,64,175,0.6);
      margin-top: 4px;
    }

    .progress-inner {
      height: 100%;
      border-radius: inherit;
      background: linear-gradient(90deg, #22c55e, #22d3ee);
      width: 0%;
      transition: width 0.3s ease-out;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.4);
      color: var(--text-soft);
    }

    .pill.green {
      background: rgba(22,163,74,0.18);
      border-color: rgba(34,197,94,0.7);
      color: #bbf7d0;
    }

    .pill.red {
      background: rgba(220,38,38,0.18);
      border-color: rgba(248,113,113,0.7);
      color: #fecaca;
    }

    .tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
    }

    .tag {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      color: var(--text-soft);
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2,minmax(0,1fr));
      gap: 8px;
    }

    @media (max-width: 640px) {
      .grid-2 {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .search-input {
      position: relative;
      margin-bottom: 8px;
    }

    .search-input input {
      padding-left: 26px;
      font-size: 12px;
    }

    .search-input span.icon {
      position: absolute;
      left: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 13px;
      color: var(--text-soft);
    }

    .calendar-month {
      border-radius: 14px;
      padding: 8px 9px;
      margin-bottom: 8px;
      background: radial-gradient(circle at top left, rgba(15,23,42,0.96), rgba(15,23,42,0.96));
      border: 1px solid rgba(30,64,175,0.55);
    }

    .calendar-month-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      margin-bottom: 5px;
    }

    .calendar-month-title {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .calendar-month-title span.icon {
      font-size: 16px;
    }

    .calendar-list {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .calendar-pill {
      font-size: 11px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(34,197,94,0.65);
      background: rgba(22,163,74,0.15);
      color: #bbf7d0;
    }

    .calendar-empty {
      font-size: 11px;
      color: var(--text-soft);
      font-style: italic;
    }

    .small {
      font-size: 11px;
    }

    footer {
      margin-top: 10px;
      opacity: 0.8;
      font-size: 10px;
      text-align: center;
      color: var(--text-soft);
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="top-bar">
      <div class="top-title">
        <div class="logo-pill">üå±</div>
        <div class="title-text">
          <h1>Mi Siembra Inteligente <span class="badge-version">v15</span></h1>
          <p id="subtitle">Organiza tu huerto seg√∫n tu clima</p>
        </div>
      </div>
      <button id="btnInstall" class="pill-btn hidden" type="button">
        <span>‚¨áÔ∏è</span> Instalar app
      </button>
    </header>

    <nav class="nav-tabs" aria-label="Secciones principales">
      <button data-section="inicio" class="active"><span class="icon">üè†</span>Inicio</button>
      <button data-section="calendario"><span class="icon">üìÖ</span>Calendario</button>
      <button data-section="mi-huerto"><span class="icon">ü™¥</span>Mi huerto</button>
      <button data-section="diario"><span class="icon">üìì</span>Diario</button>
      <button data-section="plagas"><span class="icon">üêõ</span>Plagas</button>
      <button data-section="pesticidas"><span class="icon">üß™</span>Pesticidas</button>
      <button data-section="opciones"><span class="icon">‚öôÔ∏è</span>Opciones</button>
      <button data-section="info"><span class="icon">‚ÑπÔ∏è</span>Gu√≠as</button>
    </nav>

    <main>
      <!-- INICIO -->
      <section id="inicio" class="screen active">
        <div class="screen-header">
          <div>
            <h2><span>üè†</span> Inicio</h2>
            <p class="screen-subtitle">
              Resumen r√°pido de tu huerto y acceso a las funciones principales.
            </p>
          </div>
        </div>

        <div class="card">
          <h3>Estado r√°pido</h3>
          <p id="resumenHuerto" class="small">
            Carga inicial...
          </p>
          <div class="chip-row" id="chipsEstado"></div>
        </div>

        <div class="grid-2">
          <div class="card tight">
            <h3>Hoy en el calendario</h3>
            <p class="small" id="hoyCalendario">
              Revisa qu√© puedes sembrar este mes seg√∫n tu clima.
            </p>
            <button class="btn-main" type="button" data-nav="calendario">
              <span>üìÖ</span> Ver calendario
            </button>
          </div>

          <div class="card tight">
            <h3>Accesos r√°pidos</h3>
            <div class="tag-row">
              <button class="btn-secondary" type="button" data-nav="mi-huerto">ü™¥ Registrar cultivo</button>
              <button class="btn-secondary" type="button" data-nav="diario">‚úèÔ∏è Nueva nota</button>
              <button class="btn-secondary" type="button" data-nav="plagas">üêõ Buscar plaga</button>
              <button class="btn-secondary" type="button" data-nav="opciones">‚öôÔ∏è Ajustar clima</button>
            </div>
          </div>
        </div>
      </section>

      <!-- CALENDARIO -->
      <section id="calendario" class="screen">
        <div class="screen-header">
          <div>
            <h2><span>üìÖ</span> Calendario de siembra</h2>
            <p class="screen-subtitle">
              Qu√© sembrar seg√∫n tu clima y hemisferio. Los datos son orientativos.
            </p>
          </div>
        </div>

        <div class="chip-row" id="chipsClima"></div>

        <div id="calendarContainer"></div>

        <div class="card small">
          <strong>Nota:</strong>
          <p>
            Este calendario es una gu√≠a general. Ajusta siempre seg√∫n tu experiencia,
            microclima y variedad espec√≠fica. Tu amigo bi√≥logo manda. üòâ
          </p>
        </div>
      </section>

      <!-- MI HUERTO -->
      <section id="mi-huerto" class="screen">
        <div class="screen-header">
          <div>
            <h2><span>ü™¥</span> Mi huerto</h2>
            <p class="screen-subtitle">
              Registra cada cultivo con m√°s detalle: variedad, ubicaci√≥n, fecha y notas.
            </p>
          </div>
        </div>

        <div class="card">
          <h3>Nuevo cultivo</h3>
          <form id="formHuerto">
            <div class="flex-row">
              <div class="flex-1">
                <label for="cultivoNombre">Cultivo</label>
                <input id="cultivoNombre" type="text" placeholder="Tomate, lechuga, pl√°tano..." required />
              </div>
              <div class="flex-1">
                <label for="cultivoVariedad">Variedad (opcional)</label>
                <input id="cultivoVariedad" type="text" placeholder="Cherry, romana, etc." />
              </div>
            </div>

            <div class="flex-row" style="margin-top:6px;">
              <div class="flex-1">
                <label for="cultivoTipo">Tipo de siembra</label>
                <select id="cultivoTipo">
                  <option value="semilla">Semilla directa</option>
                  <option value="alm√°cigo">Alm√°cigo / bandeja</option>
                  <option value="pl√°ntula">Pl√°ntula trasplantada</option>
                  <option value="esqueje">Esqueje</option>
                  <option value="otro">Otro</option>
                </select>
              </div>
              <div class="flex-1">
                <label for="cultivoUbicacion">Ubicaci√≥n</label>
                <input id="cultivoUbicacion" type="text" placeholder="Cama 1, maceta, patio..." />
              </div>
            </div>

            <div class="flex-row" style="margin-top:6px;">
              <div class="flex-1">
                <label for="cultivoFecha">Fecha de siembra</label>
                <input id="cultivoFecha" type="date" />
              </div>
              <div class="flex-1">
                <label for="cultivoDias">D√≠as estimados a cosecha (opcional)</label>
                <input id="cultivoDias" type="number" min="1" max="730" placeholder="Ej. 90" />
              </div>
            </div>

            <div style="margin-top:6px;">
              <label for="cultivoNotas">Notas r√°pidas</label>
              <textarea id="cultivoNotas" placeholder="Riego, fertilizaci√≥n, exposici√≥n al sol, etc."></textarea>
            </div>

            <button class="btn-main" type="submit">
              <span>‚úÖ</span> Guardar cultivo
            </button>
          </form>
        </div>

        <div class="card">
          <div class="screen-header" style="margin-bottom:4px;">
            <div>
              <h3>Lista de cultivos</h3>
              <p class="screen-subtitle">Los datos se guardan en este dispositivo.</p>
            </div>
            <button id="btnBorrarHuerto" class="btn-danger" type="button">
              üßπ Vaciar lista
            </button>
          </div>

          <div id="listaHuertoVacia" class="small">
            A√∫n no has registrado cultivos. A√±ade el primero arriba. üå±
          </div>
          <div id="listaHuerto"></div>
        </div>
      </section>

      <!-- DIARIO -->
      <section id="diario" class="screen">
        <div class="screen-header">
          <div>
            <h2><span>üìì</span> Diario de huerto</h2>
            <p class="screen-subtitle">
              Registra riegos, fertilizaciones, podas, cosechas y observaciones.
            </p>
          </div>
        </div>

        <div class="card">
          <h3>Nueva entrada</h3>
          <form id="formDiario">
            <div class="flex-row">
              <div class="flex-1">
                <label for="diarioFecha">Fecha</label>
                <input id="diarioFecha" type="date" />
              </div>
              <div class="flex-1">
                <label for="diarioTitulo">Cultivo o tema</label>
                <input id="diarioTitulo" type="text" placeholder="Tomate, abonado, plagas..." />
              </div>
            </div>
            <div style="margin-top:6px;">
              <label for="diarioTexto">Descripci√≥n</label>
              <textarea id="diarioTexto" placeholder="¬øQu√© hiciste hoy en el huerto?"></textarea>
            </div>
            <button class="btn-main" type="submit">
              <span>‚úèÔ∏è</span> Guardar en el diario
            </button>
          </form>
        </div>

        <div class="card">
          <div class="screen-header" style="margin-bottom:4px;">
            <div>
              <h3>Entradas guardadas</h3>
              <p class="screen-subtitle">Ordenadas de la m√°s reciente a la m√°s antigua.</p>
            </div>
            <button id="btnBorrarDiario" class="btn-danger" type="button">
              üßπ Borrar diario
            </button>
          </div>

          <div id="listaDiarioVacia" class="small">
            Todav√≠a no has escrito nada en el diario. Empieza con lo que hiciste hoy. ‚úçÔ∏è
          </div>
          <div id="listaDiario"></div>
        </div>
      </section>

      <!-- PLAGAS -->
      <section id="plagas" class="screen">
        <div class="screen-header">
          <div>
            <h2><span>üêõ</span> Plagas comunes</h2>
            <p class="screen-subtitle">
              Identifica plagas frecuentes y medidas ecol√≥gicas de control.
            </p>
          </div>
        </div>

        <div class="search-input">
          <span class="icon">üîç</span>
          <input id="buscaPlaga" type="text" placeholder="Buscar por nombre de plaga o cultivo..." />
        </div>

        <div id="listaPlagas"></div>
      </section>

      <!-- PESTICIDAS -->
      <section id="pesticidas" class="screen">
        <div class="screen-header">
          <div>
            <h2><span>üß™</span> Preparaciones caseras</h2>
            <p class="screen-subtitle">
              Recetas sencillas para manejo ecol√≥gico. √ösalas siempre con precauci√≥n.
            </p>
          </div>
        </div>

        <div class="search-input">
          <span class="icon">üîç</span>
          <input id="buscaPesticida" type="text" placeholder="Buscar por ingrediente o plaga objetivo..." />
        </div>

        <div id="listaPesticidas"></div>
      </section>

      <!-- OPCIONES -->
      <section id="opciones" class="screen">
        <div class="screen-header">
          <div>
            <h2><span>‚öôÔ∏è</span> Opciones</h2>
            <p class="screen-subtitle">
              Ajusta tu clima, hemisferio y nombre del huerto. Afecta al calendario.
            </p>
          </div>
        </div>

        <div class="card">
          <h3>Datos generales</h3>
          <div class="flex-row">
            <div class="flex-1">
              <label for="optNombreHuerto">Nombre de tu huerto</label>
              <input id="optNombreHuerto" type="text" placeholder="Ej. Huerto RDG" />
            </div>
          </div>

          <div class="flex-row" style="margin-top:6px;">
            <div class="flex-1">
              <label for="optClima">Tipo de clima principal</label>
              <select id="optClima">
                <option value="tropical">Tropical (Caribe, PR, costas)</option>
                <option value="subtropical">Subtropical / templado (hemisferio norte)</option>
                <option value="templado">Templado (hemisferio sur)</option>
              </select>
            </div>
            <div class="flex-1">
              <label for="optHemisferio">Hemisferio</label>
              <select id="optHemisferio">
                <option value="norte">Hemisferio norte</option>
                <option value="sur">Hemisferio sur</option>
              </select>
            </div>
          </div>

          <p class="small" style="margin-top:8px;">
            <strong>C√≥mo funciona:</strong> el clima tropical usa un calendario propio (sin estaciones
            marcadas). Los climas templados ajustan las √©pocas de siembra y, si eliges hemisferio sur,
            se invierten las estaciones (verano/invierno).
          </p>
        </div>

        <div class="card tight">
          <h3>Preferencias guardadas</h3>
          <p id="textoResumenOpciones" class="small">
          </p>
        </div>
      </section>

      <!-- INFO -->
      <section id="info" class="screen">
        <div class="screen-header">
          <div>
            <h2><span>‚ÑπÔ∏è</span> Gu√≠as r√°pidas</h2>
            <p class="screen-subtitle">
              Consejos b√°sicos para arrancar con buen pie.
            </p>
          </div>
        </div>

        <div class="card">
          <h3>Pasos b√°sicos para comenzar</h3>
          <ol class="small">
            <li>Ajusta tu <strong>clima y hemisferio</strong> en la pesta√±a Opciones.</li>
            <li>Revisa el <strong>calendario</strong> de siembra de tu mes actual.</li>
            <li>Registra tus plantas en <strong>Mi huerto</strong>.</li>
            <li>Usa el <strong>diario</strong> para llevar control de riegos, abonado y plagas.</li>
            <li>Consulta <strong>Plagas</strong> y <strong>Pesticidas</strong> cuando veas problemas.</li>
          </ol>
        </div>

        <div class="card tight small">
          <strong>Descargo de responsabilidad:</strong>
          <p>
            La informaci√≥n de esta app es orientativa y puede no aplicar a todas las regiones
            o variedades. Verifica siempre con especialistas locales o tu agr√≥nomo de confianza,
            especialmente antes de usar cualquier producto fitosanitario.
          </p>
        </div>
      </section>
    </main>

    <footer>
      Mi Siembra Inteligente ¬∑ Datos guardados localmente en tu dispositivo üåø
    </footer>
  </div>

  <script>
    // --- PWA: service worker + bot√≥n de instalar ---
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js").catch(function (err) {
        console.warn("No se pudo registrar el service worker:", err);
      });
    }

    let deferredPrompt = null;
    const btnInstall = document.getElementById("btnInstall");

    window.addEventListener("beforeinstallprompt", function (e) {
      e.preventDefault();
      deferredPrompt = e;
      if (btnInstall) btnInstall.classList.remove("hidden");
    });

    if (btnInstall) {
      btnInstall.addEventListener("click", async function () {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
        btnInstall.classList.add("hidden");
      });
    }

    window.addEventListener("appinstalled", function () {
      if (btnInstall) btnInstall.classList.add("hidden");
    });

    // --- Estado global ---
    const SETTINGS_KEY = "msi_settings_v2";
    const HUERTO_KEY = "msi_huerto_v2";
    const DIARIO_KEY = "msi_diario_v2";

    const DEFAULT_SETTINGS = {
      nombreHuerto: "Mi huerto",
      clima: "tropical", // tropical | subtropical | templado
      hemisferio: "norte" // norte | sur
    };

    function loadSettings() {
      try {
        const raw = localStorage.getItem(SETTINGS_KEY);
        if (!raw) return { ...DEFAULT_SETTINGS };
        const data = JSON.parse(raw);
        return Object.assign({}, DEFAULT_SETTINGS, data || {});
      } catch (e) {
        console.warn("Error leyendo settings:", e);
        return { ...DEFAULT_SETTINGS };
      }
    }

    function saveSettings(settings) {
      try {
        localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
      } catch (e) {
        console.warn("Error guardando settings:", e);
      }
    }

    function loadArray(key) {
      try {
        const raw = localStorage.getItem(key);
        if (!raw) return [];
        const data = JSON.parse(raw);
        if (!Array.isArray(data)) return [];
        return data;
      } catch (e) {
        console.warn("Error leyendo", key, e);
        return [];
      }
    }

    function saveArray(key, arr) {
      try {
        localStorage.setItem(key, JSON.stringify(arr || []));
      } catch (e) {
        console.warn("Error guardando", key, e);
      }
    }

    let settings = loadSettings();
    let huerto = loadArray(HUERTO_KEY);
    let diario = loadArray(DIARIO_KEY);

    // --- Utilidades de fecha ---
    function todayISO() {
      const d = new Date();
      const iso = d.toISOString().slice(0, 10);
      return iso;
    }

    function diffDays(fromIso, toIso) {
      try {
        const from = new Date(fromIso);
        const to = new Date(toIso || todayISO());
        const ms = to - from;
        return Math.floor(ms / (1000 * 60 * 60 * 24));
      } catch {
        return 0;
      }
    }

    function clamp(v, min, max) {
      return v < min ? min : v > max ? max : v;
    }

    // --- Navegaci√≥n ---
    const navButtons = document.querySelectorAll(".nav-tabs button");
    const screens = document.querySelectorAll("section.screen");

    function setActiveSection(id) {
      screens.forEach(function (sec) {
        sec.classList.toggle("active", sec.id === id);
      });
      navButtons.forEach(function (btn) {
        btn.classList.toggle("active", btn.dataset.section === id);
      });
    }

    navButtons.forEach(function (btn) {
      btn.addEventListener("click", function () {
        const id = btn.dataset.section;
        setActiveSection(id);
      });
    });

    document.querySelectorAll("[data-nav]").forEach(function (btn) {
      btn.addEventListener("click", function () {
        const id = btn.getAttribute("data-nav");
        setActiveSection(id);
      });
    });

    // --- Datos de calendario por clima ---
    // Meses 1-12
    const MESES = [
      "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
      "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
    ];

    // Datos simplificados y orientativos.
    const CALENDARIO_POR_CLIMA = {
      tropical: [
        { nombre: "Tomate", meses: [1,2,3,8,9,10], notas: "Prefiere temporada fresca, proteger del exceso de lluvia." },
        { nombre: "Pimiento", meses: [1,2,3,8,9,10], notas: "Sol pleno, suelos bien drenados." },
        { nombre: "Lechuga", meses: [11,12,1,2,3], notas: "Mejor en meses menos calurosos." },
        { nombre: "Repollo", meses: [11,12,1,2], notas: "Buen desarrollo en clima fresco." },
        { nombre: "Habichuela tierna", meses: [2,3,4,8,9], notas: "Sembrar directo en el suelo." },
        { nombre: "Ma√≠z dulce", meses: [3,4,5,6,7,8], notas: "Necesita pleno sol y buena fertilizaci√≥n." },
        { nombre: "Calabac√≠n / zucchini", meses: [2,3,4,8,9,10], notas: "Sembrar directo, vigilar plagas." },
        { nombre: "Culantro / cilantro", meses: [10,11,12,1,2], notas: "Sombra parcial en clima muy caluroso." }
      ],
      subtropical: [
        { nombre: "Tomate", meses: [3,4,5], notas: "Siembra de primavera en hemisferio norte." },
        { nombre: "Lechuga", meses: [3,4,9,10], notas: "Oto√±o y primavera." },
        { nombre: "Zanahoria", meses: [3,4,5,8,9], notas: "Puede sembrarse casi todo el a√±o evitando heladas fuertes." },
        { nombre: "Papa", meses: [2,3,4], notas: "Siembra tardoinvernal/primaveral." },
        { nombre: "Cebolla", meses: [2,3,8,9], notas: "Depende mucho de la variedad (d√≠a corto/largo)." },
        { nombre: "Calabaza", meses: [4,5], notas: "Primavera para cosechar en verano/oto√±o." }
      ],
      templado: [
        // Usaremos la misma base que subtropical; luego
        // si hemisferio sur est√° activo, se ‚Äúrota‚Äù el mes.
      ]
    };
    CALENDARIO_POR_CLIMA.templado = CALENDARIO_POR_CLIMA.subtropical;

    function mesesParaClimaYHemisferio(mesesBase, clima, hemisferio) {
      // En tropical no rotamos.
      if (clima === "tropical" || hemisferio === "norte") {
        return mesesBase.slice();
      }
      // Hemisferio sur en climas templados/subtropicales: rotar 6 meses.
      return mesesBase.map(function (m) {
        return ((m + 5) % 12) + 1;
      });
    }

    function renderChipsClima() {
      var chipsClima = document.getElementById("chipsClima");
      if (!chipsClima) return;
      chipsClima.innerHTML = "";

      var chip1 = document.createElement("div");
      chip1.className = "chip";
      chip1.innerHTML = "<strong>Clima:</strong> " + (
        settings.clima === "tropical"
          ? "Tropical"
          : settings.clima === "subtropical"
          ? "Subtropical / templado (N)"
          : "Templado"
      );
      chipsClima.appendChild(chip1);

      var chip2 = document.createElement("div");
      chip2.className = "chip";
      chip2.innerHTML = "<strong>Hemisferio:</strong> " + (settings.hemisferio === "norte" ? "Norte" : "Sur");
      chipsClima.appendChild(chip2);

      var chip3 = document.createElement("div");
      chip3.className = "chip";
      chip3.innerHTML = "<strong>Huerto:</strong> " + settings.nombreHuerto;
      chipsClima.appendChild(chip3);
    }

    function renderCalendar() {
      var cont = document.getElementById("calendarContainer");
      if (!cont) return;
      cont.innerHTML = "";

      var climaKey = settings.clima || "tropical";
      var base = CALENDARIO_POR_CLIMA[climaKey] || CALENDARIO_POR_CLIMA.tropical;

      // Pre-calcular lista de cultivos con meses ya adaptados al hemisferio
      var cultivosAdaptados = base.map(function (c) {
        return {
          nombre: c.nombre,
          notas: c.notas,
          meses: mesesParaClimaYHemisferio(c.meses, climaKey, settings.hemisferio)
        };
      });

      var mesActual = new Date().getMonth() + 1;

      for (var i = 1; i <= 12; i++) {
        (function (mes) {
          var card = document.createElement("div");
          card.className = "calendar-month";

          var header = document.createElement("div");
          header.className = "calendar-month-header";

          var title = document.createElement("div");
          title.className = "calendar-month-title";
          var icon = mes === mesActual ? "‚≠ê" : "üìÜ";
          title.innerHTML = '<span class="icon">' + icon + "</span>" + MESES[mes - 1];

          header.appendChild(title);

          if (mes === mesActual) {
            var pill = document.createElement("div");
            pill.className = "pill green";
            pill.textContent = "Mes actual";
            header.appendChild(pill);
          }

          card.appendChild(header);

          var listaDiv = document.createElement("div");
          listaDiv.className = "calendar-list";

          var cultivosMes = cultivosAdaptados.filter(function (c) {
            return c.meses.indexOf(mes) !== -1;
          });

          if (cultivosMes.length === 0) {
            var vacio = document.createElement("div");
            vacio.className = "calendar-empty";
            vacio.textContent = "No hay recomendaciones espec√≠ficas para este mes.";
            listaDiv.appendChild(vacio);
          } else {
            cultivosMes.forEach(function (c) {
              var pillCultivo = document.createElement("div");
              pillCultivo.className = "calendar-pill";
              pillCultivo.textContent = c.nombre;
              pillCultivo.title = c.notas || "";
              listaDiv.appendChild(pillCultivo);
            });
          }

          card.appendChild(listaDiv);
          cont.appendChild(card);
        })(i);
      }
    }

    // --- Mi huerto ---
    function renderHuerto() {
      var cont = document.getElementById("listaHuerto");
      var vacio = document.getElementById("listaHuertoVacia");
      if (!cont || !vacio) return;

      cont.innerHTML = "";
      if (!huerto.length) {
        vacio.style.display = "block";
        return;
      }
      vacio.style.display = "none";

      huerto
        .slice()
        .sort(function (a, b) {
          // m√°s reciente primero
          return (b.fecha || "").localeCompare(a.fecha || "");
        })
        .forEach(function (item, idx) {
          var card = document.createElement("div");
          card.className = "card tight";

          var titulo = document.createElement("h3");
          var baseNombre = item.cultivo || "Cultivo sin nombre";
          var variedad = item.variedad ? " (" + item.variedad + ")" : "";
          titulo.textContent = baseNombre + variedad;
          card.appendChild(titulo);

          var fila1 = document.createElement("p");
          var fechaTxt = item.fecha ? item.fecha : "sin fecha";
          var ubicTxt = item.ubicacion ? item.ubicacion : "sin ubicaci√≥n";
          var tipoTxt = item.tipo ? item.tipo : "sin tipo";
          fila1.innerHTML =
            '<strong>Fecha:</strong> ' +
            fechaTxt +
            ' ¬∑ <strong>Ubicaci√≥n:</strong> ' +
            ubicTxt +
            ' ¬∑ <strong>Tipo:</strong> ' +
            tipoTxt;
          card.appendChild(fila1);

          var fila2 = document.createElement("p");
          if (item.diasCosecha) {
            var diasTrans = diffDays(item.fecha || todayISO());
            var progreso = clamp(
              (diasTrans / item.diasCosecha) * 100,
              0,
              120
            );
            fila2.innerHTML =
              "<strong>Progreso estimado:</strong> " +
              diasTrans +
              " d√≠as desde siembra ¬∑ objetivo ~" +
              item.diasCosecha +
              " d√≠as";
            card.appendChild(fila2);

            var bar = document.createElement("div");
            bar.className = "progress-bar";
            var inner = document.createElement("div");
            inner.className = "progress-inner";
            inner.style.width = progreso + "%";
            bar.appendChild(inner);
            card.appendChild(bar);
          } else {
            fila2.innerHTML = "<strong>Progreso:</strong> sin d√≠as de cosecha definidos.";
            card.appendChild(fila2);
          }

          if (item.notas) {
            var notas = document.createElement("p");
            notas.textContent = "Notas: " + item.notas;
            card.appendChild(notas);
          }

          var filaBotones = document.createElement("div");
          filaBotones.className = "tag-row";

          var pillIdx = document.createElement("div");
          pillIdx.className = "pill";
          pillIdx.textContent = "ID #" + (idx + 1);
          filaBotones.appendChild(pillIdx);

          var btnDel = document.createElement("button");
          btnDel.type = "button";
          btnDel.className = "btn-danger";
          btnDel.textContent = "Eliminar";
          btnDel.addEventListener("click", function () {
            if (!confirm("¬øEliminar este cultivo de tu lista?")) return;
            huerto.splice(idx, 1);
            saveArray(HUERTO_KEY, huerto);
            renderHuerto();
            renderResumenInicio();
          });
          filaBotones.appendChild(btnDel);

          card.appendChild(filaBotones);
          cont.appendChild(card);
        });
    }

    var formHuerto = document.getElementById("formHuerto");
    if (formHuerto) {
      formHuerto.addEventListener("submit", function (e) {
        e.preventDefault();
        var nombre = document.getElementById("cultivoNombre").value.trim();
        if (!nombre) {
          alert("Escribe al menos el nombre del cultivo.");
          return;
        }
        var nuevo = {
          id: Date.now(),
          cultivo: nombre,
          variedad: document.getElementById("cultivoVariedad").value.trim(),
          tipo: document.getElementById("cultivoTipo").value,
          ubicacion: document.getElementById("cultivoUbicacion").value.trim(),
          fecha: document.getElementById("cultivoFecha").value || todayISO(),
          diasCosecha: parseInt(document.getElementById("cultivoDias").value || "0", 10) || null,
          notas: document.getElementById("cultivoNotas").value.trim()
        };
        huerto.push(nuevo);
        saveArray(HUERTO_KEY, huerto);
        formHuerto.reset();
        document.getElementById("cultivoFecha").value = todayISO();
        renderHuerto();
        renderResumenInicio();
        alert("Cultivo guardado en tu huerto.");
      });
    }

    var btnBorrarHuerto = document.getElementById("btnBorrarHuerto");
    if (btnBorrarHuerto) {
      btnBorrarHuerto.addEventListener("click", function () {
        if (!huerto.length) return;
        if (!confirm("¬øSeguro que quieres borrar TODOS los cultivos registrados?")) return;
        huerto = [];
        saveArray(HUERTO_KEY, huerto);
        renderHuerto();
        renderResumenInicio();
      });
    }

    // --- Diario ---
    function renderDiario() {
      var cont = document.getElementById("listaDiario");
      var vacio = document.getElementById("listaDiarioVacia");
      if (!cont || !vacio) return;

      cont.innerHTML = "";
      if (!diario.length) {
        vacio.style.display = "block";
        return;
      }
      vacio.style.display = "none";

      diario
        .slice()
        .sort(function (a, b) {
          return (b.fecha || "").localeCompare(a.fecha || "");
        })
        .forEach(function (item, idx) {
          var card = document.createElement("div");
          card.className = "card tight";

          var titulo = document.createElement("h3");
          var label = item.titulo || "Actividad en el huerto";
          titulo.textContent = label;
          card.appendChild(titulo);

          var p1 = document.createElement("p");
          p1.innerHTML = "<strong>Fecha:</strong> " + (item.fecha || "sin fecha");
          card.appendChild(p1);

          if (item.texto) {
            var p2 = document.createElement("p");
            p2.textContent = item.texto;
            card.appendChild(p2);
          }

          var fila = document.createElement("div");
          fila.className = "tag-row";

          var pill = document.createElement("div");
          pill.className = "pill";
          pill.textContent = "Entrada #" + (idx + 1);
          fila.appendChild(pill);

          var btnDel = document.createElement("button");
          btnDel.type = "button";
          btnDel.className = "btn-danger";
          btnDel.textContent = "Eliminar";
          btnDel.addEventListener("click", function () {
            if (!confirm("¬øEliminar esta entrada del diario?")) return;
            diario.splice(idx, 1);
            saveArray(DIARIO_KEY, diario);
            renderDiario();
          });
          fila.appendChild(btnDel);

          card.appendChild(fila);
          cont.appendChild(card);
        });
    }

    var formDiario = document.getElementById("formDiario");
    if (formDiario) {
      formDiario.addEventListener("submit", function (e) {
        e.preventDefault();
        var entrada = {
          id: Date.now(),
          fecha: document.getElementById("diarioFecha").value || todayISO(),
          titulo: document.getElementById("diarioTitulo").value.trim(),
          texto: document.getElementById("diarioTexto").value.trim()
        };
        if (!entrada.titulo && !entrada.texto) {
          alert("Escribe al menos un t√≠tulo o una descripci√≥n.");
          return;
        }
        diario.push(entrada);
        saveArray(DIARIO_KEY, diario);
        formDiario.reset();
        document.getElementById("diarioFecha").value = todayISO();
        renderDiario();
      });
    }

    var btnBorrarDiario = document.getElementById("btnBorrarDiario");
    if (btnBorrarDiario) {
      btnBorrarDiario.addEventListener("click", function () {
        if (!diario.length) return;
        if (!confirm("¬øSeguro que quieres borrar TODO el diario?")) return;
        diario = [];
        saveArray(DIARIO_KEY, diario);
        renderDiario();
      });
    }

    // --- Plagas ---
    const PLAGAS = [
      {
        nombre: "Pulgones",
        cultivos: "Tomate, pimiento, hojas tiernas en general",
        sintomas: "Hojas rizadas, presencia de insectos peque√±os verdes/negros, melaza pegajosa.",
        manejo: "Rociar jab√≥n pot√°sico, extracto de ajo o aceite de neem. Fomentar mariquitas y crisopas."
      },
      {
        nombre: "Mosca blanca",
        cultivos: "Tomate, frijol, ornamentales",
        sintomas: "Peque√±as mosquitas al mover la planta, amarilleo y debilitamiento.",
        manejo: "Trampas amarillas, jab√≥n pot√°sico, extracto de neem y buen manejo de ventilaci√≥n."
      },
      {
        nombre: "Minadores de hoja",
        cultivos: "C√≠tricos, acelga, espinaca",
        sintomas: "Galer√≠as en forma de caminos blancos dentro de la hoja.",
        manejo: "Retirar hojas muy afectadas, favorecer enemigos naturales, extractos a base de neem."
      },
      {
        nombre: "Orugas defoliadoras",
        cultivos: "Repollo, lechuga, coles, ma√≠z",
        sintomas: "Hojas comidas, excretas negras, presencia de orugas.",
        manejo: "Revisi√≥n manual, Bacillus thuringiensis, atraer aves insect√≠voras."
      },
      {
        nombre: "Caracoles y babosas",
        cultivos: "Pl√°ntulas tiernas, lechugas, fresas",
        sintomas: "Hojas comidas con bordes irregulares y baba brillante.",
        manejo: "Recolecta manual, barreras f√≠sicas, trampas de cerveza."
      }
    ];

    function renderPlagas(filtro) {
      var cont = document.getElementById("listaPlagas");
      if (!cont) return;
      cont.innerHTML = "";

      var texto = (filtro || "").toLowerCase();

      var lista = PLAGAS.filter(function (p) {
        if (!texto) return true;
        return (
          p.nombre.toLowerCase().indexOf(texto) !== -1 ||
          p.cultivos.toLowerCase().indexOf(texto) !== -1
        );
      });

      if (!lista.length) {
        var vacio = document.createElement("div");
        vacio.className = "small";
        vacio.textContent = "No se encontraron plagas con ese criterio.";
        cont.appendChild(vacio);
        return;
      }

      lista.forEach(function (p) {
        var card = document.createElement("div");
        card.className = "card tight";

        var h3 = document.createElement("h3");
        h3.textContent = p.nombre;
        card.appendChild(h3);

        var cult = document.createElement("p");
        cult.innerHTML = "<strong>Cultivos afectados:</strong> " + p.cultivos;
        card.appendChild(cult);

        var sint = document.createElement("p");
        sint.innerHTML = "<strong>S√≠ntomas:</strong> " + p.sintomas;
        card.appendChild(sint);

        var man = document.createElement("p");
        man.innerHTML = "<strong>Manejo ecol√≥gico:</strong> " + p.manejo;
        card.appendChild(man);

        cont.appendChild(card);
      });
    }

    var buscaPlaga = document.getElementById("buscaPlaga");
    if (buscaPlaga) {
      buscaPlaga.addEventListener("input", function () {
        renderPlagas(buscaPlaga.value);
      });
    }

    // --- Pesticidas caseros ---
    const PESTICIDAS = [
      {
        nombre: "Jab√≥n pot√°sico",
        objetivo: "Pulgones, mosca blanca, cochinillas",
        modo: "Disolver 5‚Äì10 ml de jab√≥n pot√°sico por litro de agua. Rociar al atardecer mojando bien el env√©s de las hojas.",
        notas: "No aplicar en horas de sol fuerte ni mezclar con azufre o aceites minerales."
      },
      {
        nombre: "Extracto de ajo y chile",
        objetivo: "Chupadores y algunos masticadores",
        modo: "Licuar 3‚Äì4 dientes de ajo y un aj√≠ picante en 1 litro de agua. Colar, diluir 1:3 y aplicar en el follaje.",
        notas: "Probar primero en pocas hojas para descartar fitotoxicidad."
      },
      {
        nombre: "Infusi√≥n de manzanilla",
        objetivo: "Prevenci√≥n de hongos en semilleros",
        modo: "Preparar infusi√≥n suave y usarla para regar o rociar pl√°ntulas.",
        notas: "Act√∫a m√°s como preventivo que como curativo."
      },
      {
        nombre: "Soluci√≥n de bicarbonato",
        objetivo: "O√≠dio y hongos superficiales",
        modo: "1 cucharadita de bicarbonato en 1 litro de agua, m√°s unas gotas de jab√≥n neutro como adherente.",
        notas: "Aplicar cada 7‚Äì10 d√≠as en presencia de s√≠ntomas leves."
      },
      {
        nombre: "Aceite de neem",
        objetivo: "Amplio espectro de insectos",
        modo: "Seguir dosis del fabricante (suele ser 2‚Äì3 ml por litro de agua) y aplicar al atardecer.",
        notas: "Evitar mezclar con otros aceites o azufre. No usar en floraciones muy visitadas por abejas."
      }
    ];

    function renderPesticidas(filtro) {
      var cont = document.getElementById("listaPesticidas");
      if (!cont) return;
      cont.innerHTML = "";

      var texto = (filtro || "").toLowerCase();

      var lista = PESTICIDAS.filter(function (p) {
        if (!texto) return true;
        return (
          p.nombre.toLowerCase().indexOf(texto) !== -1 ||
          p.objetivo.toLowerCase().indexOf(texto) !== -1
        );
      });

      if (!lista.length) {
        var vacio = document.createElement("div");
        vacio.className = "small";
        vacio.textContent = "No se encontraron preparaciones con ese criterio.";
        cont.appendChild(vacio);
        return;
      }

      lista.forEach(function (p) {
        var card = document.createElement("div");
        card.className = "card tight";

        var h3 = document.createElement("h3");
        h3.textContent = p.nombre;
        card.appendChild(h3);

        var obj = document.createElement("p");
        obj.innerHTML = "<strong>Objetivo principal:</strong> " + p.objetivo;
        card.appendChild(obj);

        var modo = document.createElement("p");
        modo.innerHTML = "<strong>Modo de uso:</strong> " + p.modo;
        card.appendChild(modo);

        var notas = document.createElement("p");
        notas.innerHTML = "<strong>Notas:</strong> " + p.notas;
        card.appendChild(notas);

        cont.appendChild(card);
      });
    }

    var buscaPest = document.getElementById("buscaPesticida");
    if (buscaPest) {
      buscaPest.addEventListener("input", function () {
        renderPesticidas(buscaPest.value);
      });
    }

    // --- Opciones / clima ---
    function actualizarSubtitle() {
      var sub = document.getElementById("subtitle");
      if (!sub) return;
      var climaTxt =
        settings.clima === "tropical"
          ? "clima tropical"
          : settings.clima === "subtropical"
          ? "clima subtropical/templado"
          : "clima templado";
      var hemiTxt = settings.hemisferio === "norte" ? "hemisferio norte" : "hemisferio sur";
      sub.textContent =
        "Huerto \"" +
        settings.nombreHuerto +
        "\" ¬∑ " +
        climaTxt +
        " ¬∑ " +
        hemiTxt;
    }

    function renderOpciones() {
      var inputNombre = document.getElementById("optNombreHuerto");
      var selClima = document.getElementById("optClima");
      var selHem = document.getElementById("optHemisferio");
      var texto = document.getElementById("textoResumenOpciones");

      if (inputNombre) inputNombre.value = settings.nombreHuerto || "";
      if (selClima) selClima.value = settings.clima || "tropical";
      if (selHem) selHem.value = settings.hemisferio || "norte";

      if (texto) {
        texto.textContent =
          "Tu huerto se llama \"" +
          settings.nombreHuerto +
          "\" y el calendario est√° configurado para un clima " +
          (settings.clima === "tropical"
            ? "tropical (Caribe, PR)"
            : settings.clima === "subtropical"
            ? "subtropical/templado en hemisferio norte"
            : "templado") +
          " en el hemisferio " +
          (settings.hemisferio === "norte" ? "norte" : "sur") +
          ". Puedes cambiar estas opciones cuando quieras.";
      }
    }

    var inputNombreHuerto = document.getElementById("optNombreHuerto");
    if (inputNombreHuerto) {
      inputNombreHuerto.addEventListener("input", function () {
        var val = inputNombreHuerto.value.trim();
        settings.nombreHuerto = val || DEFAULT_SETTINGS.nombreHuerto;
        saveSettings(settings);
        actualizarSubtitle();
        renderResumenInicio();
        renderChipsClima();
        renderOpciones();
      });
    }

    var optClima = document.getElementById("optClima");
    if (optClima) {
      optClima.addEventListener("change", function () {
        settings.clima = optClima.value || "tropical";
        saveSettings(settings);
        actualizarSubtitle();
        renderChipsClima();
        renderCalendar();
        renderOpciones();
      });
    }

    var optHemisferio = document.getElementById("optHemisferio");
    if (optHemisferio) {
      optHemisferio.addEventListener("change", function () {
        settings.hemisferio = optHemisferio.value || "norte";
        saveSettings(settings);
        actualizarSubtitle();
        renderChipsClima();
        renderCalendar();
        renderOpciones();
      });
    }

    // --- Inicio / resumen ---
    function renderResumenInicio() {
      var texto = document.getElementById("resumenHuerto");
      var chips = document.getElementById("chipsEstado");
      if (!texto || !chips) return;

      var totalCultivos = huerto.length;
      var totalDiario = diario.length;
      var hoy = todayISO();

      var recientesHoy = diario.filter(function (e) {
        return e.fecha === hoy;
      }).length;

      texto.textContent =
        "Tienes " +
        totalCultivos +
        " cultivo(s) registrados y " +
        totalDiario +
        " entrada(s) en el diario. " +
        (recientesHoy
          ? "Hoy ya registraste " + recientesHoy + " actividad(es) en el huerto."
          : "A√∫n no has escrito nada hoy en el diario.");

      chips.innerHTML = "";

      var chipHuerto = document.createElement("div");
      chipHuerto.className = "chip";
      chipHuerto.innerHTML = "<strong>Cultivos:</strong> " + totalCultivos;
      chips.appendChild(chipHuerto);

      var chipDiario = document.createElement("div");
      chipDiario.className = "chip";
      chipDiario.innerHTML = "<strong>Entradas diario:</strong> " + totalDiario;
      chips.appendChild(chipDiario);

      var chipClima = document.createElement("div");
      chipClima.className = "chip";
      chipClima.innerHTML =
        "<strong>Clima:</strong> " +
        (settings.clima === "tropical"
          ? "Tropical"
          : settings.clima === "subtropical"
          ? "Subtropical/templado"
          : "Templado");
      chips.appendChild(chipClima);
    }

    function initFechasPorDefecto() {
      var fHuerto = document.getElementById("cultivoFecha");
      if (fHuerto && !fHuerto.value) fHuerto.value = todayISO();
      var fDiario = document.getElementById("diarioFecha");
      if (fDiario && !fDiario.value) fDiario.value = todayISO();
    }

    function renderHoyCalendario() {
      var p = document.getElementById("hoyCalendario");
      if (!p) return;

      var mes = new Date().getMonth() + 1;
      var climaKey = settings.clima || "tropical";
      var base = CALENDARIO_POR_CLIMA[climaKey] || CALENDARIO_POR_CLIMA.tropical;

      var cultivosMes = base
        .map(function (c) {
          return {
            nombre: c.nombre,
            meses: mesesParaClimaYHemisferio(c.meses, climaKey, settings.hemisferio)
          };
        })
        .filter(function (c) {
          return c.meses.indexOf(mes) !== -1;
        })
        .map(function (c) {
          return c.nombre;
        });

      if (!cultivosMes.length) {
        p.textContent =
          "En " +
          MESES[mes - 1] +
          " no hay recomendaciones espec√≠ficas, pero puedes usar el calendario para revisar otros meses.";
      } else {
        p.textContent =
          "En " +
          MESES[mes - 1] +
          " podr√≠as sembrar: " +
          cultivosMes.join(", ") +
          ". Revisa el calendario completo para m√°s detalles.";
      }
    }

    // --- Inicializaci√≥n ---
    function init() {
      actualizarSubtitle();
      renderChipsClima();
      renderCalendar();
      renderHuerto();
      renderDiario();
      renderPlagas("");
      renderPesticidas("");
      renderOpciones();
      renderResumenInicio();
      initFechasPorDefecto();
      renderHoyCalendario();
    }

    init();
  </script>
</body>
  </html>
