<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mi Siembra Inteligente (v12)</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#22c55e" />
  <style>
    :root {
      color-scheme: dark;
      --bg: #020617;
      --bg-elevated: #02081f;
      --card: #02081f;
      --card-soft: #030919;
      --accent: #22c55e;
      --accent-soft: rgba(34,197,94,0.12);
      --accent-strong: rgba(34,197,94,0.4);
      --text-main: #f9fafb;
      --text-soft: #9ca3af;
      --border-subtle: rgba(148,163,184,0.4);
      --chip-bg: rgba(15,23,42,0.9);
      --chip-border: rgba(148,163,184,0.7);
      --danger: #fb7185;
      --shadow-soft: 0 18px 45px rgba(15,23,42,0.85);
      --radius-xl: 20px;
      --radius-2xl: 26px;
      --transition-fast: 0.18s ease-out;
      --nav-h: 56px;
    }
    * {
      box-sizing: border-box;
    }
    html, body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      font-size: 16px;
      background: radial-gradient(circle at top left, #0f172a 0, #020617 50%, #000 100%);
      color: var(--text-main);
      min-height: 100%;
    }
    body {
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    .app-shell {
      min-height: 100vh;
      max-width: 960px;
      margin: 0 auto;
      padding: 16px 12px 24px;
    }
    header.app-header {
      position: sticky;
      top: 0;
      z-index: 20;
      padding: 4px 4px 10px;
      backdrop-filter: blur(26px);
      -webkit-backdrop-filter: blur(26px);
    }
    .header-inner {
      border-radius: 999px;
      padding: 10px 16px;
      background: radial-gradient(circle at top left, rgba(34,197,94,0.15) 0, rgba(15,23,42,0.9) 45%, rgba(15,23,42,0.96) 100%);
      box-shadow: 0 20px 60px rgba(15,23,42,0.9);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }
    .brand-icon {
      width: 32px;
      height: 32px;
      border-radius: 14px;
      background: radial-gradient(circle at 30% 0, #bbf7d0 0, #22c55e 30%, #15803d 70%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 1px rgba(34,197,94,0.9), 0 12px 30px rgba(34,197,94,0.55);
    }
    .brand-icon span {
      font-size: 18px;
    }
    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }
    .brand-title {
      font-weight: 650;
      letter-spacing: 0.01em;
      font-size: 17px;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }
    .brand-sub {
      font-size: 11px;
      color: var(--text-soft);
    }
    .pill-nav {
      display: flex;
      gap: 6px;
      padding: 2px;
      border-radius: 999px;
      background: rgba(15,23,42,0.85);
      border: 1px solid rgba(148,163,184,0.55);
    }
    .pill-nav button {
      border: none;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      background: transparent;
      color: var(--text-soft);
      display: flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
    }
    .pill-nav button span.emoji {
      font-size: 13px;
    }
    .pill-nav button.active {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      font-weight: 600;
      box-shadow: 0 8px 20px rgba(34,197,94,0.6);
      transform: translateY(-0.5px);
    }
    main {
      padding: 8px 2px 24px;
    }
    section.view {
      display: none;
      animation: fadeIn 0.2s ease-out;
    }
    section.view.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .section-card {
      background: radial-gradient(circle at top left, rgba(148,163,184,0.14) 0, var(--card-soft) 42%, #020617 100%);
      border-radius: var(--radius-2xl);
      padding: 18px 18px 18px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(51,65,85,0.9);
      margin-bottom: 18px;
    }
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .section-title {
      font-size: 21px;
      font-weight: 650;
    }
    .section-subtitle {
      font-size: 13px;
      color: var(--text-soft);
      margin-top: 4px;
    }
    .badge {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(34,197,94,0.18);
      border: 1px solid rgba(34,197,94,0.6);
      color: #bbf7d0;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .badge span.emoji {
      font-size: 12px;
    }
    .grid-cards {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 8px;
    }
    .home-card {
      background: radial-gradient(circle at 0 0, rgba(34,197,94,0.38) 0, rgba(15,23,42,0.98) 45%, rgba(15,23,42,1) 100%);
      border-radius: 20px;
      padding: 12px 12px 13px;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(34,197,94,0.62);
      box-shadow: 0 12px 32px rgba(22,163,74,0.7);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 5px;
      min-height: 90px;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
    }
    .home-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 18px 40px rgba(22,163,74,0.85);
      border-color: rgba(190,242,100,0.95);
    }
    .home-card-title {
      font-size: 15px;
      font-weight: 650;
    }
    .home-card-desc {
      font-size: 12px;
      color: #d1fae5;
      max-width: 85%;
    }
    .home-card-icon {
      position: absolute;
      right: -6px;
      bottom: -4px;
      font-size: 46px;
      opacity: 0.18;
      transform: rotate(-8deg);
    }
    .chips-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }
    .chip {
      font-size: 11px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.7);
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    .chip span.emoji {
      font-size: 12px;
    }
    .month-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 6px;
      margin-top: 8px;
      margin-bottom: 10px;
    }
    .month-btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: var(--chip-bg);
      color: var(--text-soft);
      font-size: 12px;
      padding: 6px 4px;
      text-align: center;
      cursor: pointer;
      transition: background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast);
    }
    .month-btn.active {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      font-weight: 600;
      border-color: rgba(190,242,100,0.95);
      box-shadow: 0 10px 28px rgba(34,197,94,0.85);
      transform: translateY(-1px);
    }
    .list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 4px;
    }
    .list-item {
      border-radius: 18px;
      padding: 10px 11px;
      background: linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,1));
      border: 1px solid rgba(51,65,85,0.95);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .list-main {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .list-title {
      font-size: 14px;
      font-weight: 600;
    }
    .list-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      font-size: 11px;
    }
    .meta-pill {
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.7);
      color: var(--text-soft);
    }
    .small-btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.9);
      background: rgba(15,23,42,0.95);
      color: var(--text-main);
      padding: 5px 8px;
      font-size: 11px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .small-btn span.emoji {
      font-size: 13px;
    }
    .catalog-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      margin-top: 10px;
    }
    .crop-card {
      border-radius: 22px;
      overflow: hidden;
      background: radial-gradient(circle at top, rgba(22,163,74,0.3) 0, #020617 55%);
      border: 1px solid rgba(51,65,85,0.95);
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      min-height: 190px;
    }
    .crop-photo {
      height: 90px;
      position: relative;
      overflow: hidden;
      background: radial-gradient(circle at 20% 0, #bbf7d0 0, #22c55e 35%, #15803d 70%, #166534 100%);
    }
    .crop-photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      opacity: 0.88;
    }
    .crop-photo::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom, rgba(0,0,0,0.05), rgba(2,6,23,0.82));
    }
    .crop-body {
      padding: 9px 10px 11px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }
    .crop-name {
      font-size: 14px;
      font-weight: 600;
    }
    .crop-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 4px;
    }
    .crop-tag {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(15,23,42,0.96);
      border: 1px solid rgba(148,163,184,0.7);
      color: var(--text-soft);
    }
    .empty-state {
      padding: 26px 18px;
      border-radius: var(--radius-2xl);
      border: 1px dashed rgba(148,163,184,0.7);
      background: rgba(15,23,42,0.8);
      text-align: center;
      font-size: 13px;
      color: var(--text-soft);
    }
    .empty-state span.emoji {
      display: block;
      font-size: 28px;
      margin-bottom: 6px;
    }
    .garden-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 6px;
      margin-top: 10px;
    }
    .garden-cell {
      border-radius: 14px;
      border: 1px solid rgba(51,65,85,0.9);
      background: radial-gradient(circle at top, rgba(34,197,94,0.25) 0, rgba(15,23,42,1) 60%);
      aspect-ratio: 1/1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: var(--text-soft);
      cursor: pointer;
      text-align: center;
      padding: 4px;
    }
    .garden-cell span {
      display: block;
    }
    .garden-cell-label {
      font-weight: 600;
      color: var(--text-main);
      font-size: 11px;
    }
    .garden-cell-plant {
      font-size: 10px;
      margin-top: 2px;
    }
    .dialog-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .dialog-backdrop.active {
      display: flex;
    }
    .dialog {
      width: min(360px, 100% - 32px);
      border-radius: 22px;
      padding: 16px 16px 14px;
      background: radial-gradient(circle at top left, rgba(34,197,94,0.2) 0, #020617 50%);
      border: 1px solid rgba(148,163,184,0.9);
      box-shadow: 0 24px 70px rgba(0,0,0,0.95);
    }
    .dialog h3 {
      margin: 0 0 8px;
      font-size: 16px;
    }
    .dialog label {
      font-size: 12px;
      color: var(--text-soft);
      display: block;
      margin-bottom: 5px;
    }
    .dialog select, .dialog input, .dialog textarea {
      width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.8);
      background: rgba(15,23,42,0.9);
      color: var(--text-main);
      font-size: 13px;
      padding: 7px 9px;
      margin-bottom: 10px;
      font-family: inherit;
      resize: vertical;
    }
    .dialog textarea {
      min-height: 60px;
    }
    .dialog-footer {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 6px;
    }
    .btn {
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid rgba(148,163,184,0.9);
      background: rgba(15,23,42,0.95);
      color: var(--text-main);
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      border-color: rgba(190,242,100,0.95);
      color: #022c22;
      font-weight: 600;
      box-shadow: 0 12px 32px rgba(34,197,94,0.8);
    }
    .btn-ghost {
      background: transparent;
    }
    .diary-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 2px;
    }
    .diary-entry {
      border-radius: 16px;
      padding: 8px 10px;
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(51,65,85,0.95);
      font-size: 12px;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }
    .diary-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .diary-type {
      font-weight: 600;
    }
    .diary-date {
      font-size: 11px;
      color: var(--text-soft);
    }
    .diary-notes {
      color: var(--text-soft);
      font-size: 12px;
    }
    footer {
      margin-top: 8px;
      padding: 6px 4px 2px;
      font-size: 10px;
      color: var(--text-soft);
      text-align: center;
    }
    footer a {
      color: var(--accent);
      text-decoration: none;
    }
    @media (min-width: 768px) {
      .app-shell {
        padding: 18px 8px 28px;
      }
      .section-card {
        padding: 20px 20px 20px;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="header-inner">
        <div class="brand">
          <div class="brand-icon"><span>üå±</span></div>
          <div class="brand-text">
            <div class="brand-title">Mi Siembra Inteligente</div>
            <div class="brand-sub">Planifica, registra y cuida tu huerto paso a paso.</div>
          </div>
        </div>
        <nav class="pill-nav" aria-label="Secciones principales">
          <button class="nav-btn active" data-view="homeView"><span class="emoji">üè†</span><span>Inicio</span></button>
          <button class="nav-btn" data-view="calendarView"><span class="emoji">üìÖ</span><span>Calendario</span></button>
          <button class="nav-btn" data-view="catalogView"><span class="emoji">üåø</span><span>Cat√°logo</span></button>
          <button class="nav-btn" data-view="moreView"><span class="emoji">‚ãØ</span><span>M√°s</span></button>
        </nav>
      </div>
    </header>

    <main>
      <!-- INICIO -->
      <section id="homeView" class="view active">
        <div class="section-card">
          <div class="section-header">
            <div>
              <div class="section-title">Inicio</div>
              <div class="section-subtitle">Elige qu√© quieres hacer hoy en tu siembra.</div>
            </div>
            <div class="badge"><span class="emoji">‚ö°</span><span>Modo r√°pido</span></div>
          </div>
          <div class="grid-cards">
            <article class="home-card" data-view-target="calendarView">
              <div class="home-card-title">Qu√© sembrar este mes</div>
              <div class="home-card-desc">Calendario sencillo por mes para saber qu√© cultivos van mejor ahora mismo.</div>
              <div class="home-card-icon">üìÖ</div>
            </article>
            <article class="home-card" data-view-target="catalogView">
              <div class="home-card-title">Cat√°logo de cultivos</div>
              <div class="home-card-desc">Explora fichas visuales con tiempo de cosecha, tipo de cultivo y sol recomendado.</div>
              <div class="home-card-icon">üåø</div>
            </article>
            <article class="home-card" data-view-target="gardenView">
              <div class="home-card-title">Mi huerto</div>
              <div class="home-card-desc">Dise√±a un peque√±o plano de 4√ó4 y marca qu√© hay sembrado en cada cuadro.</div>
              <div class="home-card-icon">üß©</div>
            </article>
            <article class="home-card" data-view-target="diaryView">
              <div class="home-card-title">Diario de siembra</div>
              <div class="home-card-desc">Registra siembras, riegos, abonos y cosechas para no olvidar ning√∫n detalle.</div>
              <div class="home-card-icon">üìì</div>
            </article>
            <article class="home-card" data-view-target="pestsView">
              <div class="home-card-title">Plagas y cuidados</div>
              <div class="home-card-desc">Identifica problemas comunes y qu√© hacer de forma sencilla.</div>
              <div class="home-card-icon">ü™≤</div>
            </article>
            <article class="home-card" data-view-target="fertView">
              <div class="home-card-title">Abonos y fertilizantes</div>
              <div class="home-card-desc">Ideas de compost, abonos caseros y cu√°ndo aplicarlos.</div>
              <div class="home-card-icon">üß™</div>
            </article>
          </div>
          <div class="chips-row">
            <span class="chip"><span class="emoji">üì±</span><span>PWA offline</span></span>
            <span class="chip"><span class="emoji">‚òï</span><span>Hecho para planificar tranquilo</span></span>
            <span class="chip"><span class="emoji">üáµüá∑</span><span>Clima tropical adaptable</span></span>
          </div>
        </div>
      </section>

      <!-- CALENDARIO / QU√â SEMBRAR -->
      <section id="calendarView" class="view">
        <div class="section-card">
          <div class="section-header">
            <div>
              <div class="section-title">¬øQu√© puedo sembrar este mes?</div>
              <div class="section-subtitle">Toca un mes para ver cultivos recomendados y tiempo aproximado de cosecha.</div>
            </div>
            <button class="small-btn" data-view-target="homeView"><span class="emoji">‚¨ÖÔ∏è</span><span>Volver</span></button>
          </div>
          <div class="month-grid" id="monthButtons"></div>
          <div class="list" id="monthResults"></div>
        </div>
      </section>

      <!-- CAT√ÅLOGO -->
      <section id="catalogView" class="view">
        <div class="section-card">
          <div class="section-header">
            <div>
              <div class="section-title">Cat√°logo visual de cultivos</div>
              <div class="section-subtitle">Primeros cultivos con fotos representativas y datos r√°pidos.</div>
            </div>
            <button class="small-btn" data-view-target="homeView"><span class="emoji">‚¨ÖÔ∏è</span><span>Volver</span></button>
          </div>
          <div class="chips-row" id="catalogFilters"></div>
          <div class="catalog-grid" id="catalogGrid"></div>
        </div>
      </section>

      <!-- MI HUERTO -->
      <section id="gardenView" class="view">
        <div class="section-card">
          <div class="section-header">
            <div>
              <div class="section-title">Mi huerto</div>
              <div class="section-subtitle">Toca un cuadro para asignar qu√© est√°s sembrando en esa √°rea.</div>
            </div>
            <button class="small-btn" id="resetGarden"><span class="emoji">üßπ</span><span>Limpiar</span></button>
          </div>
          <div class="garden-grid" id="gardenGrid"></div>
          <div class="section-subtitle" style="margin-top:10px;">Sugerencia: puedes usar el plano como referencia de tu cama de siembra real o de tiestos.</div>
        </div>
      </section>

      <!-- DIARIO -->
      <section id="diaryView" class="view">
        <div class="section-card">
          <div class="section-header">
            <div>
              <div class="section-title">Diario de siembra</div>
              <div class="section-subtitle">Registra actividades importantes para no perder el hilo de tu huerto.</div>
            </div>
            <button class="small-btn" id="addDiaryEntry"><span class="emoji">‚ûï</span><span>Nuevo</span></button>
          </div>
          <div class="diary-list" id="diaryList"></div>
          <div class="empty-state" id="diaryEmpty">
            <span class="emoji">üìù</span>
            A√∫n no has registrado actividades. Empieza a√±adiendo tu pr√≥xima siembra, riego, abono o cosecha.
          </div>
        </div>
      </section>

      <!-- PLAGAS -->
      <section id="pestsView" class="view">
        <div class="section-card">
          <div class="section-header">
            <div>
              <div class="section-title">Plagas y cuidados b√°sicos</div>
              <div class="section-subtitle">Gu√≠a r√°pida para problemas frecuentes y acciones sencillas.</div>
            </div>
            <button class="small-btn" data-view-target="homeView"><span class="emoji">‚¨ÖÔ∏è</span><span>Volver</span></button>
          </div>
          <div class="list">
            <div class="list-item">
              <div class="list-main">
                <div class="list-title">Pulgones</div>
                <div class="list-meta">
                  <span class="meta-pill">ü™≤ Chupan savia</span>
                  <span class="meta-pill">üåø Brotes tiernos</span>
                </div>
                <div class="section-subtitle">Soluci√≥n simple: rociar con agua jabonosa suave (jab√≥n pot√°sico o de lavar platos bien diluido) cada 2‚Äì3 d√≠as.</div>
              </div>
            </div>
            <div class="list-item">
              <div class="list-main">
                <div class="list-title">Hongos en hojas</div>
                <div class="list-meta">
                  <span class="meta-pill">üçÉ Manchas</span>
                  <span class="meta-pill">üíß Exceso de humedad</span>
                </div>
                <div class="section-subtitle">Mejora la ventilaci√≥n, evita mojar las hojas al regar y retira hojas muy afectadas.</div>
              </div>
            </div>
            <div class="list-item">
              <div class="list-main">
                <div class="list-title">Orugas y gusanos</div>
                <div class="list-meta">
                  <span class="meta-pill">ü™± Hojas comidas</span>
                  <span class="meta-pill">üå± Pl√°ntulas</span>
                </div>
                <div class="section-subtitle">Rev√≠salas a mano, especialmente por la tarde, y ret√≠ralas. Puedes proteger brotes con mallas ligeras.</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ABONOS -->
      <section id="fertView" class="view">
        <div class="section-card">
          <div class="section-header">
            <div>
              <div class="section-title">Abonos y fertilizantes</div>
              <div class="section-subtitle">Ideas pr√°cticas de abonos caseros y cu√°ndo aplicarlos.</div>
            </div>
            <button class="small-btn" data-view-target="homeView"><span class="emoji">‚¨ÖÔ∏è</span><span>Volver</span></button>
          </div>
          <div class="list">
            <div class="list-item">
              <div class="list-main">
                <div class="list-title">Compost maduro</div>
                <div class="list-meta">
                  <span class="meta-pill">üóëÔ∏è Restos de cocina</span>
                  <span class="meta-pill">üå± Aporta de todo un poco</span>
                </div>
                <div class="section-subtitle">Ideal para mezclar con la tierra antes de sembrar o para mejorar camas ya usadas.</div>
              </div>
            </div>
            <div class="list-item">
              <div class="list-main">
                <div class="list-title">T√© de compost o de humus</div>
                <div class="list-meta">
                  <span class="meta-pill">üíß L√≠quido</span>
                  <span class="meta-pill">üöø Se aplica al riego</span>
                </div>
                <div class="section-subtitle">√ötil para dar un empuj√≥n extra a plantas en crecimiento sin exagerar la dosis.</div>
              </div>
            </div>
            <div class="list-item">
              <div class="list-main">
                <div class="list-title">Abonos l√≠quidos concentrados</div>
                <div class="list-meta">
                  <span class="meta-pill">‚ö†Ô∏è Leer etiqueta</span>
                </div>
                <div class="section-subtitle">Siempre respeta las dosis indicadas. Es mejor menos cantidad y m√°s frecuente que pasarse.</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- M√ÅS (ATAJOS) -->
      <section id="moreView" class="view">
        <div class="section-card">
          <div class="section-header">
            <div>
              <div class="section-title">M√°s opciones</div>
              <div class="section-subtitle">Atajos a secciones clave de la app.</div>
            </div>
          </div>
          <div class="grid-cards">
            <article class="home-card" data-view-target="gardenView">
              <div class="home-card-title">Mi huerto</div>
              <div class="home-card-desc">Plano r√°pido 4√ó4 para visualizar tu siembra.</div>
              <div class="home-card-icon">üß©</div>
            </article>
            <article class="home-card" data-view-target="diaryView">
              <div class="home-card-title">Diario</div>
              <div class="home-card-desc">Historial de tareas y cosechas.</div>
              <div class="home-card-icon">üìì</div>
            </article>
            <article class="home-card" data-view-target="pestsView">
              <div class="home-card-title">Plagas</div>
              <div class="home-card-desc">Problemas frecuentes y soluciones b√°sicas.</div>
              <div class="home-card-icon">ü™≤</div>
            </article>
            <article class="home-card" data-view-target="fertView">
              <div class="home-card-title">Abonos</div>
              <div class="home-card-desc">Cu√°ndo y c√≥mo abonar sin excesos.</div>
              <div class="home-card-icon">üß™</div>
            </article>
          </div>
        </div>
      </section>
    </main>

    <footer>
      Mi Siembra Inteligente (v12) ¬∑ Guarda datos solo en este dispositivo ¬∑ Puedes instalarla como app desde el navegador.
    </footer>
  </div>

  <!-- Di√°logo para huerto -->
  <div class="dialog-backdrop" id="gardenDialog">
    <div class="dialog">
      <h3>Asignar cultivo</h3>
      <div id="gardenDialogPosition" class="section-subtitle" style="margin-bottom:8px;"></div>
      <label for="gardenCropSelect">Cultivo</label>
      <select id="gardenCropSelect"></select>
      <div class="dialog-footer">
        <button class="btn btn-ghost" type="button" data-dialog-close>Cancelar</button>
        <button class="btn btn-primary" type="button" id="gardenSave">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Di√°logo para diario -->
  <div class="dialog-backdrop" id="diaryDialog">
    <div class="dialog">
      <h3>Nueva entrada</h3>
      <label for="diaryType">Tipo de actividad</label>
      <select id="diaryType">
        <option value="Siembra">Siembra</option>
        <option value="Riego">Riego</option>
        <option value="Abono">Abono</option>
        <option value="Cosecha">Cosecha</option>
        <option value="Otro">Otro</option>
      </select>
      <label for="diaryDate">Fecha</label>
      <input id="diaryDate" type="date" />
      <label for="diaryNotes">Notas</label>
      <textarea id="diaryNotes" placeholder="Ej. Sembr√© 4 plantas de tomate en tiestos de 5 galones."></textarea>
      <div class="dialog-footer">
        <button class="btn btn-ghost" type="button" data-dialog-close>Cancelar</button>
        <button class="btn btn-primary" type="button" id="diarySave">Guardar</button>
      </div>
    </div>
  </div>

  <script>
    const VIEWS = ['homeView','calendarView','catalogView','gardenView','diaryView','pestsView','fertView','moreView'];

    // Ruta fija a las im√°genes en GitHub Pages
    const IMAGE_BASE = 'https://eldespertarpr.github.io/MI-Siembra-Inteligente/img/';

    // Cultivos (id = nombre del archivo sin .jpg)
    const crops = [
      { id:'aji',       nombre:'Aj√≠es',    tipo:'Fruto', sol:'Sol pleno',    dias:'90-120 d√≠as', meses:['Enero','Febrero','Marzo','Septiembre','Octubre','Noviembre'] },
      { id:'pimiento',  nombre:'Pimiento', tipo:'Fruto', sol:'Sol pleno',    dias:'90 d√≠as',     meses:['Enero','Febrero','Marzo','Septiembre','Octubre','Noviembre'] },
      { id:'cilantro',  nombre:'Cilantro', tipo:'Hoja',  sol:'Media sombra', dias:'30-45 d√≠as',  meses:['Todo el a√±o'] },
      { id:'recao',     nombre:'Recao',    tipo:'Hoja',  sol:'Media sombra', dias:'8-10 semanas',meses:['Todo el a√±o'] },
      { id:'tomate',    nombre:'Tomate',   tipo:'Fruto', sol:'Sol pleno',    dias:'75 d√≠as',     meses:['Enero','Febrero','Marzo','Agosto','Septiembre'] },
      { id:'lechuga',   nombre:'Lechuga',  tipo:'Hoja',  sol:'Sol suave',    dias:'45 d√≠as',     meses:['Enero','Febrero','Noviembre','Diciembre'] },
      { id:'cebolla',   nombre:'Cebolla',  tipo:'Bulbo', sol:'Sol pleno',    dias:'110 d√≠as',    meses:['Enero','Febrero','Marzo','Agosto','Septiembre','Octubre'] },
      { id:'menta',     nombre:'Menta',    tipo:'Hoja',  sol:'Media sombra', dias:'60-90 d√≠as',  meses:['Todo el a√±o'] }
    ];

    const months = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];

    function showView(id) {
      VIEWS.forEach(v => {
        const el = document.getElementById(v);
        if (!el) return;
        el.classList.toggle('active', v === id);
      });
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.view === id || (id === 'homeView' && btn.dataset.view === 'homeView'));
      });
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    document.querySelectorAll('[data-view-target]').forEach(el => {
      el.addEventListener('click', () => {
        const id = el.dataset.viewTarget;
        if (id) showView(id);
      });
    });
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.view;
        if (id) showView(id);
      });
    });

    // --- Calendario ---
    const monthButtonsContainer = document.getElementById('monthButtons');
    const monthResultsContainer = document.getElementById('monthResults');
    let activeMonth = null;

    function renderMonthButtons() {
      monthButtonsContainer.innerHTML = '';
      months.forEach(m => {
        const btn = document.createElement('button');
        btn.className = 'month-btn';
        btn.textContent = m;
        btn.addEventListener('click', () => {
          activeMonth = m;
          updateMonthButtons();
          renderMonthResults();
        });
        monthButtonsContainer.appendChild(btn);
      });
      const now = new Date();
      activeMonth = months[now.getMonth()];
      updateMonthButtons();
      renderMonthResults();
    }

    function updateMonthButtons() {
      const nodes = monthButtonsContainer.querySelectorAll('.month-btn');
      nodes.forEach(btn => {
        btn.classList.toggle('active', btn.textContent === activeMonth);
      });
    }

    function renderMonthResults() {
      monthResultsContainer.innerHTML = '';
      if (!activeMonth) return;
      const filtered = crops.filter(c => c.meses.includes(activeMonth) || c.meses.includes('Todo el a√±o'));
      if (!filtered.length) {
        const div = document.createElement('div');
        div.className = 'empty-state';
        div.innerHTML = '<span class="emoji">ü§î</span>No hay cultivos configurados para este mes a√∫n.';
        monthResultsContainer.appendChild(div);
        return;
      }
      filtered.forEach(c => {
        const item = document.createElement('div');
        item.className = 'list-item';
        const main = document.createElement('div');
        main.className = 'list-main';
        const title = document.createElement('div');
        title.className = 'list-title';
        title.textContent = c.nombre;
        const meta = document.createElement('div');
        meta.className = 'list-meta';
        const pillDias = document.createElement('span');
        pillDias.className = 'meta-pill';
        pillDias.textContent = c.dias;
        meta.appendChild(pillDias);
        const pillTipo = document.createElement('span');
        pillTipo.className = 'meta-pill';
        pillTipo.textContent = c.tipo;
        meta.appendChild(pillTipo);
        const pillSol = document.createElement('span');
        pillSol.className = 'meta-pill';
        pillSol.textContent = c.sol;
        meta.appendChild(pillSol);
        const subt = document.createElement('div');
        subt.className = 'section-subtitle';
        subt.textContent = 'Mes recomendado: ' + activeMonth;
        main.appendChild(title);
        main.appendChild(meta);
        main.appendChild(subt);
        item.appendChild(main);
        monthResultsContainer.appendChild(item);
      });
    }

    // --- Cat√°logo ---
    const catalogGrid = document.getElementById('catalogGrid');
    const catalogFilters = document.getElementById('catalogFilters');
    let activeTypeFilter = 'Todos';

    function renderCatalogFilters() {
      const tipos = Array.from(new Set(crops.map(c => c.tipo)));
      const all = ['Todos', ...tipos];
      catalogFilters.innerHTML = '';
      all.forEach(t => {
        const chip = document.createElement('button');
        chip.type = 'button';
        chip.className = 'chip';
        chip.innerHTML = '<span class="emoji">' + (t === 'Todos' ? '‚ú®' : 'ü•¨') + '</span><span>' + t + '</span>';
        chip.addEventListener('click', () => {
          activeTypeFilter = t;
          renderCatalog();
        });
        catalogFilters.appendChild(chip);
      });
    }

    function renderCatalog() {
      catalogGrid.innerHTML = '';
      const filtered = crops.filter(c => activeTypeFilter === 'Todos' || c.tipo === activeTypeFilter);
      filtered.forEach(c => {
        const card = document.createElement('article');
        card.className = 'crop-card';

        const photo = document.createElement('div');
        photo.className = 'crop-photo';
        const img = document.createElement('img');
        img.src = IMAGE_BASE + c.id + '.jpg';
        img.alt = c.nombre;
        photo.appendChild(img);

        const body = document.createElement('div');
        body.className = 'crop-body';

        const name = document.createElement('div');
        name.className = 'crop-name';
        name.textContent = c.nombre;

        const tags = document.createElement('div');
        tags.className = 'crop-tags';
        const tagDias = document.createElement('span');
        tagDias.className = 'crop-tag';
        tagDias.textContent = c.dias;
        tags.appendChild(tagDias);
        const tagSol = document.createElement('span');
        tagSol.className = 'crop-tag';
        tagSol.textContent = c.sol;
        tags.appendChild(tagSol);
        const tagTipo = document.createElement('span');
        tagTipo.className = 'crop-tag';
        tagTipo.textContent = c.tipo;
        tags.appendChild(tagTipo);

        body.appendChild(name);
        body.appendChild(tags);

        card.appendChild(photo);
        card.appendChild(body);
        catalogGrid.appendChild(card);
      });
    }

    // --- Mi huerto ---
    const gardenSize = 4;
    const gardenGridEl = document.getElementById('gardenGrid');
    const gardenDialog = document.getElementById('gardenDialog');
    const gardenCropSelect = document.getElementById('gardenCropSelect');
    const gardenDialogPosition = document.getElementById('gardenDialogPosition');
    let gardenSelectedCell = null;
    const GARDEN_KEY = 'mi_siembra_garden_v12';

    function loadGarden() {
      const raw = localStorage.getItem(GARDEN_KEY);
      if (!raw) return Array(gardenSize * gardenSize).fill(null);
      try {
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed) && parsed.length === gardenSize * gardenSize) return parsed;
      } catch (e) {}
      return Array(gardenSize * gardenSize).fill(null);
    }

    let gardenState = loadGarden();

    function saveGarden() {
      localStorage.setItem(GARDEN_KEY, JSON.stringify(gardenState));
    }

    function renderGardenGrid() {
      gardenGridEl.innerHTML = '';
      for (let i = 0; i < gardenSize * gardenSize; i++) {
        const cell = document.createElement('button');
        cell.type = 'button';
        cell.className = 'garden-cell';
        const row = Math.floor(i / gardenSize) + 1;
        const col = (i % gardenSize) + 1;

        const label = document.createElement('span');
        label.className = 'garden-cell-label';
        label.textContent = row + '√ó' + col;

        const plantName = document.createElement('span');
        plantName.className = 'garden-cell-plant';
        plantName.textContent = gardenState[i] ? gardenState[i] : 'Vac√≠o';

        cell.appendChild(label);
        cell.appendChild(plantName);

        cell.addEventListener('click', () => openGardenDialog(i, row, col));
        gardenGridEl.appendChild(cell);
      }
    }

    function openGardenDialog(index, row, col) {
      gardenSelectedCell = index;
      gardenDialogPosition.textContent = 'Cuadro fila ' + row + ', columna ' + col + '.';
      gardenCropSelect.innerHTML = '';
      const emptyOpt = document.createElement('option');
      emptyOpt.value = '';
      emptyOpt.textContent = 'Vac√≠o';
      gardenCropSelect.appendChild(emptyOpt);
      crops.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c.nombre;
        opt.textContent = c.nombre;
        gardenCropSelect.appendChild(opt);
      });
      gardenCropSelect.value = gardenState[index] || '';
      gardenDialog.classList.add('active');
    }

    function closeDialogs() {
      document.querySelectorAll('.dialog-backdrop').forEach(d => d.classList.remove('active'));
    }

    document.querySelectorAll('[data-dialog-close]').forEach(btn => {
      btn.addEventListener('click', closeDialogs);
    });

    document.getElementById('gardenSave').addEventListener('click', () => {
      if (gardenSelectedCell == null) return;
      const value = gardenCropSelect.value || null;
      gardenState[gardenSelectedCell] = value;
      saveGarden();
      renderGardenGrid();
      closeDialogs();
    });

    document.getElementById('resetGarden').addEventListener('click', () => {
      if (!confirm('¬øLimpiar todo el plano del huerto?')) return;
      gardenState = Array(gardenSize * gardenSize).fill(null);
      saveGarden();
      renderGardenGrid();
    });

    // --- Diario ---
    const diaryListEl = document.getElementById('diaryList');
    const diaryEmptyEl = document.getElementById('diaryEmpty');
    const diaryDialog = document.getElementById('diaryDialog');
    const diaryType = document.getElementById('diaryType');
    const diaryDate = document.getElementById('diaryDate');
    const diaryNotes = document.getElementById('diaryNotes');
    const DIARY_KEY = 'mi_siembra_diary_v12';
    let diaryEntries = [];

    function loadDiary() {
      const raw = localStorage.getItem(DIARY_KEY);
      if (!raw) return [];
      try {
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed)) return parsed;
      } catch (e) {}
      return [];
    }

    function saveDiary() {
      localStorage.setItem(DIARY_KEY, JSON.stringify(diaryEntries));
    }

    function renderDiary() {
      diaryListEl.innerHTML = '';
      if (!diaryEntries.length) {
        diaryEmptyEl.style.display = 'block';
        return;
      }
      diaryEmptyEl.style.display = 'none';
      diaryEntries.slice().reverse().forEach(entry => {
        const div = document.createElement('div');
        div.className = 'diary-entry';
        const meta = document.createElement('div');
        meta.className = 'diary-meta';
        const typeSpan = document.createElement('span');
        typeSpan.className = 'diary-type';
        typeSpan.textContent = entry.type;
        const dateSpan = document.createElement('span');
        dateSpan.className = 'diary-date';
        dateSpan.textContent = entry.date || '';
        meta.appendChild(typeSpan);
        meta.appendChild(dateSpan);
        const notes = document.createElement('div');
        notes.className = 'diary-notes';
        notes.textContent = entry.notes || '';
        div.appendChild(meta);
        div.appendChild(notes);
        diaryListEl.appendChild(div);
      });
    }

    document.getElementById('addDiaryEntry').addEventListener('click', () => {
      diaryDate.valueAsDate = new Date();
      diaryNotes.value = '';
      diaryDialog.classList.add('active');
    });

    document.getElementById('diarySave').addEventListener('click', () => {
      const entry = {
        type: diaryType.value,
        date: diaryDate.value,
        notes: diaryNotes.value.trim()
      };
      diaryEntries.push(entry);
      saveDiary();
      renderDiary();
      closeDialogs();
    });

    // Inicializar todo
    function init() {
      renderMonthButtons();
      renderCatalogFilters();
      renderCatalog();
      gardenState = loadGarden();
      renderGardenGrid();
      diaryEntries = loadDiary();
      renderDiary();
    }
    init();

    // Registrar service worker PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(() => {});
      });
    }
  </script>
</body>
</html>
