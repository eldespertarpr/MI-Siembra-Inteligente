<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mi Siembra Inteligente (v18)</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f2817">

<style>

/* ---------------- GLOBAL COLORS (VERDE OSCURO PREMIUM) ---------------- */

:root {
  --bg: #0f1b12;
  --bg-soft: #1a2a1c;
  --card: #122017;
  --card-soft: #1e3523;
  --accent: #22c55e;
  --accent-strong: #16a34a;
  --text-main: #e8f5e9;
  --text-soft: #9fb8a8;
  --border: #2f4a32;
  --radius: 16px;
  --shadow: 0 6px 14px rgba(0,0,0,0.35);
  --shadow-strong: 0 10px 28px rgba(0,0,0,0.5);
}

/* ---------------- RESET ---------------- */

html, body {
  margin: 0;
  padding: 0;
  background: var(--bg);
  color: var(--text-main);
  font-family: system-ui, sans-serif;
}

/* ---------------- SPLASH SCREEN ---------------- */

#splash {
  position: fixed;
  inset: 0;
  background: #0f1b12;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 1;
  transition: opacity 0.8s ease;
}

#splash.fade-out {
  opacity: 0;
  pointer-events: none;
}

#splash h1 {
  font-size: 28px;
  margin-top: 12px;
  font-weight: 700;
}

#splash p {
  font-size: 16px;
  color: var(--text-soft);
}

/* ---------------- HEADER ---------------- */

.app-header {
  position: sticky;
  top: 0;
  background: #0f1b12dd;
  backdrop-filter: blur(14px);
  border-bottom: 1px solid var(--border);
  z-index: 20;
}

.header-inner {
  max-width: 900px;
  margin: 0 auto;
  padding: 14px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.brand {
  display: flex;
  gap: 10px;
  align-items: center;
}

.brand-icon {
  width: 40px;
  height: 40px;
  border-radius: 12px;
  background: #1e3523;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
}

.brand-title {
  font-size: 18px;
  font-weight: 700;
}

.brand-sub {
  font-size: 13px;
  color: var(--text-soft);
}

/* ---------------- NAV BAR ---------------- */

.pill-nav {
  display: flex;
  gap: 6px;
  background: #1e3523;
  padding: 4px;
  border-radius: 999px;
  border: 1px solid var(--border);
}

.pill-nav button {
  border: none;
  border-radius: 999px;
  padding: 7px 14px;
  font-size: 13px;
  background: transparent;
  cursor: pointer;
  color: var(--text-soft);
  transition: background 0.2s;
}

.pill-nav .active {
  background: var(--accent);
  color: #0f2817;
  font-weight: 700;
}

/* ---------------- VIEWS ---------------- */

.view {
  display: none;
  max-width: 900px;
  margin: 0 auto;
  padding: 18px;
}

.view.active {
  display: block;
}

/* ---------------- HOME BUTTONS ---------------- */

.home-buttons button {
  width: 100%;
  margin-bottom: 12px;
  background: var(--card);
  color: var(--text-main);
  padding: 16px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  font-size: 16px;
  font-weight: 600;
  text-align: left;
  display: flex;
  gap: 10px;
  align-items: center;
  box-shadow: var(--shadow);
  transition: 0.2s;
}

.home-buttons button:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-strong);
}

/* ---------------- CATALOG B1 (COMPACTO HORIZONTAL) ---------------- */

.catalog-item {
  background: var(--card);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
  display: flex;
  gap: 10px;
  padding: 10px;
  align-items: center;
}

.catalog-photo {
  width: 80px;
  height: 80px;
  border-radius: var(--radius);
  overflow: hidden;
  flex-shrink: 0;
}

.catalog-photo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.catalog-info {
  flex: 1;
}

.catalog-info h3 {
  margin: 0;
  font-size: 16px;
  font-weight: 700;
}

.catalog-info .sub {
  font-size: 13px;
  color: var(--text-soft);
}

.catalog-info .plagas {
  font-size: 12px;
  margin-top: 4px;
  color: #e2ffdf;
}

.catalog-info .more {
  margin-top: 6px;
  font-size: 13px;
  color: var(--accent);
  cursor: pointer;
}

/* ---------------- DETAIL MODAL ---------------- */

.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 8000;
}

.modal {
  width: 90%;
  max-width: 500px;
  background: var(--card-soft);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  padding: 16px;
  box-shadow: var(--shadow-strong);
}

.modal h2 {
  margin-top: 0;
}

.modal-close {
  float: right;
  font-size: 20px;
  cursor: pointer;
}

</style>
</head>

<body>

<!-- ------------ SPLASH SCREEN ------------- -->
<div id="splash">
  <div style="font-size:70px;">üå±</div>
  <h1>Mi Siembra Inteligente</h1>
  <p>El huerto en tus manos</p>
</div>

<!-- ------------ APP ------------- -->
<div id="app" style="display:none;">
<!-- ---------------- HEADER ---------------- -->
<header class="app-header">
  <div class="header-inner">
    <div class="brand">
      <div class="brand-icon">üå±</div>
      <div>
        <div class="brand-title">Mi Siembra Inteligente</div>
        <div class="brand-sub">Planifica, cuida y cosecha mejor</div>
      </div>
    </div>

    <nav class="pill-nav">
      <button class="nav-btn active" data-view="homeView">üè† Inicio</button>
      <button class="nav-btn" data-view="calendarView">üìÖ Calendario</button>
      <button class="nav-btn" data-view="catalogView">üåø Cat√°logo</button>
      <button class="nav-btn" data-view="moreView">‚ãØ M√°s</button>
    </nav>
  </div>
</header>

<main>

<!-- ---------------- üè† INICIO ---------------- -->
<section id="homeView" class="view active">
  <h2>Inicio</h2>
  <p>¬øQu√© deseas hacer hoy?</p>

  <div class="home-buttons">
    <button data-view-target="calendarView">üìÖ Qu√© sembrar este mes</button>
    <button data-view-target="catalogView">üåø Cat√°logo de cultivos</button>
    <button data-view-target="gardenView">üß© Mi huerto</button>
    <button data-view-target="diaryView">üìì Diario</button>
    <button data-view-target="pestsView">ü™≤ Plagas y cuidados</button>
    <button data-view-target="fertView">üß™ Abonos y fertilizantes</button>
    <button data-view-target="optionsView">üåç Opciones y clima</button>
  </div>
</section>

<!-- ---------------- üìÖ CALENDARIO ---------------- -->
<section id="calendarView" class="view">
  <h2>¬øQu√© puedo sembrar este mes?</h2>
  <p>Elige un mes para ver cultivos recomendados seg√∫n tu clima.</p>

  <div id="monthButtons" style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:12px;"></div>

  <div id="monthResults" style="margin-top:16px;"></div>
</section>

<!-- ---------------- üåø CAT√ÅLOGO DE CULTIVOS ---------------- -->
<section id="catalogView" class="view">
  <h2>Cat√°logo de cultivos</h2>

  <input id="catalogSearch" placeholder="Buscar cultivo..." style="width:100%;padding:12px;border-radius:var(--radius);border:1px solid var(--border);background:var(--card-soft);color:var(--text-main);margin-bottom:12px;">

  <div id="catalogList" style="display:flex;flex-direction:column;gap:10px;"></div>
</section>

<!-- ---------------- üß© MI HUERTO ---------------- -->
<section id="gardenView" class="view">
  <h2>Mi huerto</h2>
  <p>Toca un cuadro para asignar un cultivo.</p>

  <div id="gardenGrid" style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:12px;"></div>
</section>

<!-- ---------------- üìì DIARIO ---------------- -->
<section id="diaryView" class="view">
  <h2>Diario de siembra</h2>

  <button id="addDiaryEntry" style="padding:10px 14px;border-radius:var(--radius);border:1px solid var(--border);background:var(--accent);color:#0f2817;font-weight:700;margin-bottom:12px;">
    ‚ûï Nuevo registro
  </button>

  <div id="diaryList" style="display:flex;flex-direction:column;gap:12px;"></div>
</section>

<!-- ---------------- ü™≤ PLAGAS ---------------- -->
<section id="pestsView" class="view">
  <h2>Plagas y cuidados</h2>

  <button data-view-target="pestsCatalogView" style="padding:10px 14px;border-radius:var(--radius);border:1px solid var(--border);background:var(--card-soft);color:var(--text-main);margin-bottom:12px;">
    üìö Ver cat√°logo de plagas
  </button>

  <button data-view-target="pesticidesView" style="padding:10px 14px;border-radius:var(--radius);border:1px solid var(--border);background:var(--card-soft);color:var(--text-main);">
    üß¥ Pesticidas caseros
  </button>
</section>

<!-- ---------------- üìö CAT√ÅLOGO DE PLAGAS ---------------- -->
<section id="pestsCatalogView" class="view">
  <h2>Cat√°logo de plagas</h2>

  <input id="pestSearch" placeholder="Buscar plaga..." style="width:100%;padding:12px;border-radius:var(--radius);border:1px solid var(--border);background:var(--card-soft);color:var(--text-main);margin-bottom:12px;">

  <div id="pestsList" style="display:flex;flex-direction:column;gap:12px;"></div>
</section>

<!-- ---------------- üß¥ PESTICIDAS ---------------- -->
<section id="pesticidesView" class="view">
  <h2>Pesticidas caseros</h2>

  <input id="pesticideSearch" placeholder="Buscar pesticida..." style="width:100%;padding:12px;border-radius:var(--radius);border:1px solid var(--border);background:var(--card-soft);color:var(--text-main);margin-bottom:12px;">

  <div id="pesticidesList" style="display:flex;flex-direction:column;gap:12px;"></div>
</section>

<!-- ---------------- üß™ ABONOS ---------------- -->
<section id="fertView" class="view">
  <h2>Abonos y fertilizantes</h2>

  <div id="fertList" style="display:flex;flex-direction:column;gap:12px;"></div>
</section>

<!-- ---------------- ‚öôÔ∏è OPCIONES ---------------- -->
<section id="optionsView" class="view">
  <h2>Opciones y clima</h2>

  <p>Selecciona el clima para adaptar las plagas y recomendaciones:</p>

  <div id="climateOptions" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;">
    <button class="climate-btn" data-climate="tropical" style="padding:10px 14px;border-radius:var(--radius);border:1px solid var(--border);background:var(--card-soft);color:var(--text-main);">üå¥ Tropical</button>
    <button class="climate-btn" data-climate="templado" style="padding:10px 14px;border-radius:var(--radius);border:1px solid var(--border);background:var(--card-soft);color:var(--text-main);">üå§Ô∏è Templado</button>
    <button class="climate-btn" data-climate="frio" style="padding:10px 14px;border-radius:var(--radius);border:1px solid var(--border);background:var(--card-soft);color:var(--text-main);">‚ùÑÔ∏è Fr√≠o</button>
  </div>

  <p style="margin-top:12px;">Clima actual: <strong id="currentClimate">Tropical</strong></p>
</section>

<!-- -------------- ‚ãØ M√ÅS -------------- -->
<section id="moreView" class="view">
  <h2>M√°s opciones</h2>

  <button data-view-target="gardenView" class="home-btn">üß© Mi huerto</button>
  <button data-view-target="diaryView" class="home-btn">üìì Diario</button>
  <button data-view-target="pestsView" class="home-btn">ü™≤ Plagas</button>
  <button data-view-target="fertView" class="home-btn">üß™ Abonos</button>

  <button id="backupExport" class="home-btn">üíæ Guardar copia</button>
  <button id="backupImport" class="home-btn">üìÇ Restaurar copia</button>
  <input type="file" id="backupFile" hidden accept="application/json">
</section>

</main>

<footer style="text-align:center;padding:14px;color:var(--text-soft);font-size:13px;">
  Mi Siembra Inteligente ¬∑ Datos guardados solo en este dispositivo
</footer>
<script>
// =====================================
// MI SIEMBRA INTELIGENTE - v18 PREMIUM
// =====================================

document.addEventListener("DOMContentLoaded", () => {

    /* ---------------- SPLASH ---------------- */
    const splash = document.getElementById("splash");
    setTimeout(() => {
        splash.classList.add("fade-out");
        setTimeout(() => splash.remove(), 700);
    }, 900);


    /* ---------------- NAVEGACI√ìN ---------------- */
    const views = document.querySelectorAll(".view");

    function showView(id) {
        views.forEach(v => v.classList.remove("active"));
        document.getElementById(id).classList.add("active");
        window.scrollTo(0, 0);
    }

    document.querySelectorAll(".nav-btn").forEach(btn => {
        btn.addEventListener("click", () => showView(btn.dataset.view));
        document.querySelectorAll(".nav-btn").forEach(x => x.classList.remove("active"));
        btn.classList.add("active");
    });

    document.querySelectorAll("[data-view-target]").forEach(btn => {
        btn.addEventListener("click", () => showView(btn.dataset.viewTarget));
    });


    /* ---------------- BASE DE DATOS GLOBAL ---------------- */

    const IMAGENES = {
        acelga: "acelga.jpg",
        ajo: "ajo.jpg",
        ajoporro: "ajoporro.jpg",
        albahaca: "albahaca.jpg",
        apio: "apio.jpg",
        berenjena: "berenjena.jpg",
        berenjena_china: "berenjena_china.jpg",
        brocoli: "brocoli.jpg",
        calabacin: "calabacin.jpg",
        calabaza: "calabaza.jpg",
        cebolla: "cebolla.jpg",
        cebolla_verde: "cebolla_verde.jpg",
        cilantro: "cilantro.jpg",
        col: "col.jpg",
        coliflor: "coliflor.jpg",
        col_risada: "col_risada.jpg",
        espinaca: "espinaca.jpg",
        gandules: "gandules.jpg",
        habichuelas: "habichuelas.jpg",
        jengibre: "jengibre.jpg",
        lechuga: "lechuga.jpg",
        limon: "limon.jpg",
        lima: "lima.jpg",
        mango: "mango.jpg",
        melon: "melon.jpg",
        menta: "menta.jpg",
        oregano: "oregano.jpg",
        papa: "papa.jpg",
        papaya: "papaya.jpg",
        pepinillo: "pepinillo.jpg",
        perejil: "perejil.jpg",
        pimiento: "pimiento.jpg",
        pimiento_cubanelle: "pimiento_cubanelle.jpg",
        pimiento_morron: "pimiento_morron.jpg",
        platano: "platano.jpg",
        rabano: "rabano.jpg",
        remolacha: "remolacha.jpg",
        sandia: "sandia.jpg",
        tomate: "tomate.jpg",
        zanahoria: "zanahoria.jpg"
    };

    const CULTIVOS = Object.keys(IMAGENES).map(id => ({
        id,
        nombre: id.replace(/_/g, " ").replace(/\b\w/g, l => l.toUpperCase()),
        imagen: `img/${IMAGENES[id]}`,
        dias: "60-90 d√≠as",
        tipo: "Vegetal",
        sol: "Sol directo",
        riego: "Moderado",
        plagas: {
            tropical: ["Mosca blanca", "Pulg√≥n"],
            templado: ["√Åcaros", "Oruga verde"],
            frio: ["Babosas", "Hongos"]
        }
    }));


    /* ---------------- CALENDARIO ---------------- */

    const cultivosPorMes = {
        enero:["lechuga","rabano","cilantro"],
        febrero:["tomate","pimiento","cebolla"],
        marzo:["calabaza","maiz","melon"],
        abril:["pepinillo","sandia","ajo"],
        mayo:["platano","gandules","habichuelas"],
        junio:["pepinillo","calabacin"],
        julio:["tomate","pimiento"],
        agosto:["lechuga","cilantro"],
        septiembre:["rabano","cebolla"],
        octubre:["ajo","brocoli"],
        noviembre:["coliflor","zanahoria"],
        diciembre:["lechuga","cilantro","rabano"]
    };

    const monthButtons = document.getElementById("monthButtons");
    const monthResults = document.getElementById("monthResults");

    const meses = Object.keys(cultivosPorMes);
    meses.forEach(m => {
        const b = document.createElement("button");
        b.className = "month-btn";
        b.textContent = m.toUpperCase();
        b.onclick = () => mostrarMes(m);
        monthButtons.appendChild(b);
    });

    function mostrarMes(mes) {
        monthResults.innerHTML = "";
        const lista = cultivosPorMes[mes] || [];

        if (lista.length === 0) {
            monthResults.innerHTML = "<p>No hay cultivos registrados para este mes.</p>";
            return;
        }

        lista.forEach(id => {
            const c = CULTIVOS.find(x => x.id === id);
            if (!c) return;

            const card = document.createElement("div");
            card.className = "card";
            card.innerHTML = `
                <div class="card-header">
                    <img src="${c.imagen}" class="card-img">
                </div>
                <div class="card-body">
                    <h3>${c.nombre}</h3>
                    <p>${c.dias}</p>
                </div>`;
            monthResults.appendChild(card);
        });
    }


    /* ---------------- CAT√ÅLOGO B1 ---------------- */

    const catalogList = document.getElementById("catalogList");
    const catalogSearch = document.getElementById("catalogSearch");

    function renderCatalogo(filtro = "") {
        catalogList.innerHTML = "";

        CULTIVOS
            .filter(c => c.nombre.toLowerCase().includes(filtro.toLowerCase()))
            .forEach(c => {
                const card = document.createElement("div");
                card.className = "catalog-card";
                card.innerHTML = `
                    <div class="catalog-img">
                        <img src="${c.imagen}">
                    </div>
                    <div class="catalog-info">
                        <h3>${c.nombre}</h3>
                        <p>D√≠as: ${c.dias}</p>
                        <p>Plagas comunes: ${c.plagas.tropical[0]}, ${c.plagas.tropical[1]}</p>
                    </div>`;
                catalogList.appendChild(card);
            });
    }

    renderCatalogo();
    catalogSearch.addEventListener("input", e => renderCatalogo(e.target.value));


    /* ---------------- PLAGAS ---------------- */

    const pestsList = document.getElementById("pestsList");
    const pestSearch = document.getElementById("pestSearch");

    const PLAGAS = [
        { nombre:"Mosca blanca", descripcion:"Chupa savia. Control: jab√≥n pot√°sico o neem." },
        { nombre:"Pulgones", descripcion:"Colonias grandes. Control: agua jabonosa." },
        { nombre:"√Åcaros", descripcion:"Puntos amarillos. Control: neem." },
        { nombre:"Orugas", descripcion:"Hojas comidas. Control: BT o retiro manual." },
        { nombre:"Hongos", descripcion:"Manchas. Control: bicarbonato." }
    ];

    function renderPlagas(filtro="") {
        pestsList.innerHTML = "";
        PLAGAS.filter(p => p.nombre.toLowerCase().includes(filtro.toLowerCase()))
            .forEach(p => {
                const card = document.createElement("div");
                card.className = "card";
                card.innerHTML = `<h3>${p.nombre}</h3><p>${p.descripcion}</p>`;
                pestsList.appendChild(card);
            });
    }

    renderPlagas();
    pestSearch.oninput = e => renderPlagas(e.target.value);


    /* ---------------- PESTICIDAS ---------------- */

    const pesticidesList = document.getElementById("pesticidesList");
    const pesticideSearch = document.getElementById("pesticideSearch");

    const PESTICIDAS = [
        { nombre:"Aceite de neem", uso:"Control general natural" },
        { nombre:"Jab√≥n pot√°sico", uso:"Pulgones, mosca blanca" },
        { nombre:"Agua jabonosa", uso:"Control r√°pido de plagas suaves" },
        { nombre:"Bicarbonato", uso:"Hongos del follaje" }
    ];

    function renderPesticidas(filtro="") {
        pesticidesList.innerHTML = "";
        PESTICIDAS.filter(x => x.nombre.toLowerCase().includes(filtro.toLowerCase()))
            .forEach(p => {
                const card = document.createElement("div");
                card.className = "card";
                card.innerHTML = `<h3>${p.nombre}</h3><p>${p.uso}</p>`;
                pesticidesList.appendChild(card);
            });
    }

    renderPesticidas();
    pesticideSearch.oninput = e => renderPesticidas(e.target.value);


    /* ---------------- ABONOS ---------------- */

    const fertList = document.getElementById("fertList");
    fertList.innerHTML = `
        <div class="card"><h3>Compost</h3><p>Mejora estructura del suelo y retenci√≥n de agua.</p></div>
        <div class="card"><h3>Humus</h3><p>Aporta microorganismos y nutrientes disponibles.</p></div>
        <div class="card"><h3>Abono 10-10-10</h3><p>Equilibrado para la mayor√≠a de cultivos.</p></div>
    `;


    /* ---------------- DIARIO ---------------- */

    const diaryList = document.getElementById("diaryList");
    const addDiaryEntry = document.getElementById("addDiaryEntry");

    addDiaryEntry.onclick = () => {
        const texto = prompt("Escribe el registro:");
        if (!texto) return;

        const item = document.createElement("div");
        item.className = "card";
        item.innerHTML = `${texto} <button class="delete-btn">‚ùå</button>`;
        diaryList.appendChild(item);

        item.querySelector(".delete-btn").onclick = () => item.remove();
    };


    /* ---------------- MI HUERTO ---------------- */

    const gardenGrid = document.getElementById("gardenGrid");

    // Crear 12 espacios
    for (let i = 0; i < 12; i++) {
        const cell = document.createElement("div");
        cell.className = "garden-cell";
        cell.innerHTML = "<span style='color:#64748b;'>Vac√≠o</span>";
        cell.onclick = () => asignarCultivo(cell);
        gardenGrid.appendChild(cell);
    }

    function asignarCultivo(cell) {
        const nombre = prompt("¬øQu√© cultivo deseas asignar?");
        if (!nombre) return;
        cell.textContent = nombre;
    }


    /* ---------------- CLIMA ---------------- */

    let climaActual = "tropical";
    const currentClimate = document.getElementById("currentClimate");

    document.querySelectorAll(".climate-btn").forEach(btn => {
        btn.onclick = () => {
            climaActual = btn.dataset.climate;
            currentClimate.textContent = climaActual.charAt(0).toUpperCase() + climaActual.slice(1);
        };
    });


    /* ---------------- BACKUP ---------------- */

    const backupExport = document.getElementById("backupExport");
    const backupImport = document.getElementById("backupImport");
    const backupFile = document.getElementById("backupFile");

    backupExport.onclick = () => {
        const data = {
            diario: diaryList.innerHTML,
            huerto: gardenGrid.innerHTML,
            clima: climaActual
        };
        const blob = new Blob([JSON.stringify(data)], { type: "application/json" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "mis-siembra-backup.json";
        a.click();
    };

    backupImport.onclick = () => backupFile.click();
    backupFile.onchange = e => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = () => {
            const data = JSON.parse(reader.result);

            diaryList.innerHTML = data.diario || "";
            gardenGrid.innerHTML = data.huerto || "";
            climaActual = data.clima || "tropical";
            currentClimate.textContent = climaActual;
        };
        reader.readAsText(file);
    };

});
      </script>
